jQuery(document).ready(function(){if(typeof TableFilterSortTableList!=="undefined"){var a=0;for(a=0;a<TableFilterSortTableList.length;a++){TableFilterSortTableList[a]=jQuery(TableFilterSortTableList[a]).tableFilterSort()}}});(function(a){a.fn.tableFilterSort=function(c){var e=0;var b=this;var d={debug:false,baseURL:"",favouritesURL:"/tfs/favourites/",filtersURL:"/tfs/filters/",filtersParentPageID:"",favouritesParentPageID:"",useBackAndForwardButtons:false,holderNumber:0,myTableHolder:b,myFilterFormHolder:null,myTable:null,myTableHead:null,myTableBody:null,myRows:null,dataDictionary:[],currentFilter:{},currentSorter:{},showFromRow:0,visibleRowCount:50,totalRowCount:0,maximumNumberOfFilterOptions:30,intervalForFilterCheck:1000,hasFixedTableHeader:true,hasKeywords:true,hasFavourites:false,hasFilterSaving:false,millisecondsBetweenActions:10,validDataTypes:["number","string","date"],maxNumberOfValuesToCheck:500,favouritesStore:[],startRowFX1:null,startRowFX2:null,endRowFX1:null,endRowFX2:null,filterTitle:"Filter Table",noFilterSelectedText:"No filter selected",closeAndApplyFilterText:"Close and Apply Filter",currentFilterText:"Current Filter",greaterThanLabel:"&gt; ",lowerThanLabel:"&lt; ",keywordsCategoryTitle:"Keywords",favouritesCategoryTitle:"Favourites",filtersTitle:"Filter",tableSelector:"table.tableFilterSortTable",rowSelector:"tr.tfsRow",filterItemSelector:"span[data-filter]",showMoreDetailsSelector:".more",moreDetailsSelector:".hidden",filterFormHolderSelector:".tableFilterSortFilterFormHolder",sortLinkSelector:"a.sortable",favouriteLinkSelector:"a.addFav",moreRowEntriesSelector:".tableFilterSortMoreEntries",matchRowCountSelector:".match-row-number",minRowSelector:".min-row-number",maxRowSelector:".max-row-number",totalRowCountSelector:".total-row-number",visibleRowCountSelector:".total-showing-row-number",paginationSelector:".pagination",saveAndLoadSelector:".saveAndLoad",loadingClass:"loading",showClass:"show",hideClass:"hide",matchClass:"match",notMatchClass:"no-match",openedClass:"opened",filterIsOpenClass:"filterIsOpen",sectionFilterClassAppendix:"Filter",commonContentHolderClass:"tableFilterSortCommonContentHolder",currentSearchFilterClass:"tableFilterSortCurrentSearchHolder",openAndCloseFilterFormClass:"tableFilterSortOpenFilterForm",filterOptionsHolderClass:"tableFilterSortFilterFormOptions",filterGroupClass:"filterColumn",groupLabelClass:"groupLabel",applyFilterClass:"applyFilter",filterInUseClass:"tableFilterSortFilterInUse",filterNotInUseClass:"tableFilterSortFilterNotInUse",noMatchMessageClass:"no-matches-message",sortAscClass:"sort-asc",sortDescClass:"sort-desc",directLinkClass:"dl",favouriteClass:"fav",init:function(f){d.holderNumber=f;d.myTableHolder=b;d.myFilterFormHolder=d.myTableHolder.find(d.filterFormHolderSelector).first();d.myTable=d.myTableHolder.find(d.tableSelector).first();d.myTableHead=d.myTableHolder.find("table thead");d.myTableBody=d.myTable.find(" > tbody");d.favouritesParentPageID=d.myFilterFormHolder.attr("data-favourites-page-id");if(typeof d.favouritesParentPageID==="string"&&d.favouritesParentPageID.length>0){d.hasFavourites=true}d.filtersParentPageID=d.myFilterFormHolder.attr("data-filter-page-id");if(typeof d.filtersParentPageID==="string"&&d.filtersParentPageID.length>0){d.hasFilterSaving=true}d.baseURL=location.protocol+"//"+location.host+location.pathname;d.resetObjects();if(d.myRows.length>1){d.myTableHolder.addClass(d.loadingClass);window.setTimeout(function(){if(d.debug){console.profileEnd();console.profile("filterItemCollector")}d.filterItemCollector();if(d.debug){console.profileEnd();console.profile("tableHideColsWhichAreAllTheSame")}d.tableHideColsWhichAreAllTheSame();if(d.debug){console.profileEnd();console.profile("dataDictionaryCollector")}d.dataDictionaryCollector();if(d.debug){console.profileEnd();console.profile("setupFilterFormListeners")}d.setupFilterFormListeners();if(d.debug){console.profileEnd();console.profile("setupSortListeners")}d.setupSortListeners();if(d.debug){console.profileEnd();console.profile("paginationListeners")}d.paginationListeners();if(d.debug){console.profile("setupMoreDetailsListener")}d.setupMoreDetailsListener();if(d.debug){console.profile("addURLChangeListener")}d.addURLChangeListener();if(d.debug){console.profileEnd();console.profile("retrieveServerDataListener")}d.retrieveServerDataListener();if(d.debug){console.profileEnd();console.profile("favouriteLinkListener")}d.favouriteLinkListener();if(d.debug){console.profileEnd();console.profile("directFilterLinkListener")}d.directFilterLinkListener();if(d.debug){console.profileEnd();console.profile("createFilterForm")}d.createFilterForm();if(d.debug){console.profileEnd()}d.myTableHolder.removeClass(d.loadingClass);if(d.debug){console.profile("runCurrentSort")}d.runCurrentSort();if(d.debug){console.profileEnd();console.profile("retrieveCookieData")}d.retrieveCookieData();if(d.debug){console.profileEnd();console.profile("fixTableHeader")}d.fixTableHeader();if(d.debug){console.profileEnd()}},d.millisecondsBetweenActions)}},resetObjects:function(){d.myRows=d.myTable.find(d.rowSelector)},filterItemCollector:function(){var g="";var f="";d.myRows.each(function(h,j){jQuery(j).find(d.filterItemSelector).each(function(i,k){k=jQuery(k);g=k.text();f=k.attr("data-filter");if(g.trim().length>0){if(d.debug){console.debug("adding "+g+" to "+f)}if(typeof d.dataDictionary[f]==="undefined"){d.dataDictionary[f]={}}if(typeof d.dataDictionary[f]["Options"]==="undefined"){d.dataDictionary[f]["Options"]=[]}if(d.dataDictionary[f]["Options"].indexOf(g)===-1){d.dataDictionary[f]["Options"].push(g)}}})})},tableHideColsWhichAreAllTheSame:function(){var g=d.myTableHolder.find("."+d.commonContentHolderClass).attr("data-title");if(typeof g!=="undefined"){g="<h3>"+g+"</h3>"}else{g=""}var h='<div class="'+d.commonContentHolderClass+'-inner">'+g+"<ul>";var f=false;Object.keys(d.dataDictionary).forEach(function(j,k){if(d.dataDictionary[j]["Options"].length===1){delete d.dataDictionary[j];if(d.debug){console.debug("tableHideColsWhichAreAllTheSame: checking category: "+j)}f=true;var i=false;jQuery('span[data-filter="'+j+'"]').each(function(m,n){n=jQuery(n);if(!i){if(n.html()!==""){h+="<li><strong>"+j+":</strong> <span>"+n.html()+"</span></li>";i=true}}var o=n.parent();n.remove();if(o.is("li")){o.hide()}else{if(o.is("td")){if(o.children().length===0){if(m===0){var l=o.parent("tr").children("td").index(o);d.myTable.find("th").eq(l).remove()}o.remove()}}}})}});h+="</ul></div>";if(f){d.myTableHolder.find("."+d.commonContentHolderClass).html(h)}else{d.myTableHolder.find("."+d.commonContentHolderClass).remove()}},dataDictionaryCollector:function(){Object.keys(d.dataDictionary).forEach(function(j,k){if(typeof d.dataDictionary[j]["Options"]==="undefined"){d.dataDictionary[j]["Options"]=[]}var n=d.myTable.find(d.sortLinkSelector+'[data-sort-field="'+j+'"]').first();if(typeof d.dataDictionary[j]["CanFilter"]==="undefined"){if(n&&n.attr("data-sort-only")=="true"){d.dataDictionary[j]["CanFilter"]=false}else{d.dataDictionary[j]["CanFilter"]=d.dataDictionary[j]["Options"].length>1}}if(typeof d.dataDictionary[j]["CanSort"]==="undefined"){d.dataDictionary[j]["CanSort"]=n.length>0}if(typeof d.dataDictionary[j]["DataType"]==="undefined"){if(d.dataDictionary[j]["CanSort"]){var l=n.attr("data-sort-type");d.dataDictionary[j]["DataType"]=l}}if(typeof d.dataDictionary[j]["DataType"]==="undefined"){var h="number";var m=false;var g=0;var f=d.dataDictionary[j]["Options"].length<d.maxNumberOfValuesToCheck?d.dataDictionary[j]["Options"].length:500;for(g=0;g<f;g++){m=jQuery.isNumeric(d.dataDictionary[j]["Options"][g]);if(m===false){h="string";break}}d.dataDictionary[j]["DataType"]=h}if(jQuery.inArray(d.dataDictionary[j]["DataType"],d.validDataTypes)===false){console.debug("ERROR: invalid DataType for"+j+": "+d.dataDictionary[j]["DataType"])}switch(d.dataDictionary[j]["DataType"]){case"number":d.dataDictionary[j]["Options"].sort(function(o,i){o=parseFloat(o.replace(/[^0-9.]/g,""));i=parseFloat(i.replace(/[^0-9.]/g,""));return o-i});break;case"string":default:d.dataDictionary[j]["Options"].sort()}})},setupFilterFormListeners:function(){d.myFilterFormHolder.on("click","."+d.openAndCloseFilterFormClass,function(f){f.preventDefault();d.myFilterFormHolder.find("."+d.filterOptionsHolderClass).toggleClass(d.openedClass).slideToggle("fast");d.myTableHolder.toggleClass(d.filterIsOpenClass);if(d.myTableHolder.hasClass(d.filterIsOpenClass)){}else{d.applyFilter()}return false});d.myFilterFormHolder.on("change","input",function(f){d.applyFilter()})},setupSortListeners:function(){d.myTableHolder.on("click",d.sortLinkSelector,function(f){f.preventDefault();var g=jQuery(this);d.showFromRow=0;d.startRowManipulation();d.myTableHead.find(d.sortLinkSelector).removeClass(d.sortAscClass).removeClass(d.sortDescClass);window.setTimeout(function(){d.currentSorter.category=g.attr("data-sort-field");d.currentSorter.direction=g.attr("data-sort-direction");d.currentSorter.sortType=g.attr("data-sort-type");if(typeof d.currentSorter.sortType==="undefined"){d.currentSorter.sortType=d.dataDictionary[d.currentSorter.category]["DataType"]}var h=[];d.myRows.each(function(k,l){var n=jQuery(l);var m=n.find('[data-filter="'+d.currentSorter.category+'"]').text();if(d.currentSorter.sortType==="number"){m=m.replace(/[^\d.-]/g,"");m=parseFloat(m)}else{}var j=new Array(m,k);h.push(j)});d.myTableBody.empty();h.sort(d.sortMultiDimensionalArray);var i=d.myTableHead.find(d.sortLinkSelector+'[data-sort-field="'+d.currentSorter.category+'"]');if(d.currentSorter.direction==="desc"){h.reverse();i.attr("data-sort-direction","asc").addClass(d.sortDescClass)}else{i.attr("data-sort-direction","desc").addClass(d.sortAscClass)}h.forEach(function(j){d.myTableBody.append(d.myRows[j[1]])});d.endRowManipulation()},d.millisecondsBetweenActions)})},paginationListeners:function(){d.myTableHolder.on("click",d.paginationSelector+" a",function(g){g.preventDefault();var f=jQuery(this).attr("data-page");d.gotoPage(f);return false})},setupMoreDetailsListener:function(){d.myTableHolder.on("click",d.showMoreDetailsSelector,function(f){f.preventDefault();var h=jQuery(this);var g=h.closest("tr");g.toggleClass(d.openedClass).find(d.moreDetailsSelector).each(function(k,j){j=jQuery(j);j.slideToggle();j.toggleClass(d.openedClass)});h.toggleClass(d.openedClass)})},addURLChangeListener:function(){if(d.useBackAndForwardButtons){window.addEventListener("popstate",function(f){d.findAndApplyGetVariables()})}},directFilterLinkListener:function(){d.myTableBody.on("click","span[data-filter]."+d.directLinkClass,function(i){i.preventDefault();var l=jQuery(this);var h=l.attr("data-filter");var k=l.text().trim();var j=d.myFilterFormHolder.find("."+d.filterGroupClass+'[data-to-filter="'+h+'"]');var g=j.attr("field-type");var f=j.find('input[value="'+k+'"].checkbox').first();if(f&&f.length>0){if(f.is(":checkbox")){if(f.prop("checked")===true){f.prop("checked",false).trigger("change")}else{f.prop("checked",true).trigger("change")}}}else{if(g==="tag"){d.makeCheckboxSection(j.find("input.awesomplete").first(),k)}}d.applyFilter();return false})},favouriteLinkListener:function(){if(d.myTableBody.find(d.favouriteLinkSelector).length>0){d.myTableHolder.on("click",d.favouriteLinkSelector,function(g){g.preventDefault();var i=jQuery(this).closest("tr");i.toggleClass(d.favouriteClass);var h=i.attr("id");if(h&&typeof h!=="undefined"&&h!==""){if(i.hasClass(d.favouriteClass)){d.favouritesStore.push(h)}else{var f=d.favouritesStore.indexOf(h);if(f>-1){d.favouritesStore.splice(f,1)}}Cookies.set("favouritesStore",d.favouritesStore,{path:d.baseURL,expires:180})}return false})}},retrieveServerDataListener:function(){d.myTableHolder.on("click",d.saveAndLoadSelector+" a",function(h){h.preventDefault();var l=jQuery(this);var f=l.attr("href");var k=false;var j=false;var g=d.favouritesParentPageID;var i={};if(l.hasClass("save")){j=true}if(l.hasClass("filters")){k=true;var g=d.filtersParentPageID}if(j){if(k){i={f:d.currentFilter,s:d.currentSorter}}else{i={f:d.favouritesStore}}}g=g.split("/").join("--");dataAsString=JSON.stringify(i);fullURL=f+encodeURI(g)+"/?data="+encodeURI(dataAsString);jQuery.modal('<iframe src="'+fullURL+'" height="450" width="830" style="border:0">',{closeHTML:"",containerCss:{backgroundColor:"#fff",borderColor:"#fff",height:450,padding:0,width:830},overlayClose:true});l.modal();return false})},createFilterForm:function(){if(d.myFilterFormHolder.length>0){var n="";var g=d.myFilterFormHolder.attr("data-title");if(typeof g==="undefined"){g=d.filterTitle}if(d.myTableHolder.find("."+d.currentSearchFilterClass).length===0){var n='<div class="'+d.currentSearchFilterClass+'"></div>'}var h=1;var p=[];var k="<form>"+n+'<a href="#" class="'+d.openAndCloseFilterFormClass+' button closed">'+g+'</a><div style="display: none;" class="'+d.filterOptionsHolderClass+'">';if(d.hasKeywords){k+=d.makeSectionHeaderForForm("keyword",d.keywordsCategoryTitle);k+=d.makeFieldForForm("keyword",d.keywordsCategoryTitle,h,0);k+=d.makeSectionFooterForForm()}Object.keys(d.dataDictionary).forEach(function(t,u){if(d.dataDictionary[t]["CanFilter"]){h++;var r="";var i=[];var s=0;var w=d.dataDictionary[t]["Options"].length;if(w>1&&w<=d.maximumNumberOfFilterOptions){k+=d.makeSectionHeaderForForm("checkbox",t);s=0;for(s=0;s<w;s++){var v=d.dataDictionary[t]["Options"][s];k+=d.makeFieldForForm("checkbox",t,h,v)}k+=d.makeSectionFooterForForm()}else{if(w>d.maximumNumberOfFilterOptions){var q=d.dataDictionary[t]["DataType"];if(d.dataDictionary[t]["DataType"]==="string"){p.push(t);q="tag"}k+=d.makeSectionHeaderForForm(q,t);k+=d.makeFieldForForm(q,t,h,0);k+=d.makeSectionFooterForForm()}}}});if(d.hasFavourites){k+=d.makeSectionHeaderForForm("favourites",d.favouritesCategoryTitle);k+=d.makeFieldForForm("favourites",d.favouritesCategoryTitle,h,0);k+=d.makeSectionFooterForForm();h++}var m=d.myFilterFormHolder.attr("data-title-close-and-apply");if(typeof m==="undefined"){m=d.closeAndApplyFilterText}k+='<div class="'+d.applyFilterClass+'"><a href="#" class="'+d.openAndCloseFilterFormClass+' button closed">'+m+"</a></div></div></form>";d.myFilterFormHolder.html(k);var j=0;var o;for(j=0;j<p.length;j++){category=p[j];var l=d.myFilterFormHolder.find('input[name="'+category+'"].awesomplete').first();var f=jQuery(l).attr("id");var o=document.getElementById(f);new Awesomplete(o,{list:d.dataDictionary[category]["Options"],autoFirst:true,replace:function(q){d.makeCheckboxSection(this.input,q.value);this.input.value="";var i=this._list.indexOf(q.value);if(i>-1){this._list.splice(i,1)}d.applyFilter()}})}}},makeSectionHeaderForForm:function(g,i){var f=g+d.sectionFilterClassAppendix;var h=i.replace(/\W/g,"");return'<div class="'+d.filterGroupClass+" "+f+'" field-type="'+g+'" data-to-filter="'+i.raw2attr()+'"><label class="'+d.groupLabelClass+'">'+d.replaceAll(i,"-"," ")+"</label><ul>"},makeFieldForForm:function(k,f,g,l){var i=f.replace(/\W/g,"");var h=l.toString();var j=("TFS_"+i+"_"+h).replace(/[^a-zA-Z0-9]+/g,"_");if(d.myFilterFormHolder.find("input#"+j).length===0){var m='<li class="'+k+'Field">';var p="</li>";switch(k){case"favourites":return m+'<input class="favourites" type="checkbox" name="'+f.raw2attr()+'" id="'+j+'" tabindex="'+g+'" /><label for="'+j+'">♥ ♥ ♥</label>'+p;break;case"keyword":case"tag":var r="";if(typeof d.currentFilter[f]!=="undefined"){if(typeof d.currentFilter[f][0]!=="undefined"){r=d.currentFilter[f][0];r=r.raw2attr()}}if(k==="keyword"){extraClass="keyword"}else{if(k==="tag"){extraClass="awesomplete"}}return m+'<input class="text '+extraClass+'" type="text" name="'+f.raw2attr()+'" id="'+j+'" tabindex="'+g+'" />'+p;case"checkbox":var o="";if(typeof d.currentFilter[f]!=="undefined"){var n=jQuery.inArray(l,d.currentFilter[f]);if(n>-1){o='checked="checked"'}}return m+'<input class="checkbox" type="checkbox" name="'+j+'" id="'+j+'" value="'+l.raw2attr()+'" '+o+' " tabindex="'+g+'" /><label for="'+j+'">'+l+"</label>"+p;case"number":case"date":var r=["",""];if(typeof d.currentFilter[f]!=="undefined"){r=d.currentFilter[f]}var q=m+'<span class="gt"> <label for="'+j+'_gt">'+d.greaterThanLabel+'</label> <input data-dir="gt" data-label="'+d.greaterThanLabel.raw2attr()+'" class="number" step="any" type="number" name="'+i+'[]" id="'+j+'" tabindex="'+g+'" value="'+r[0].raw2attr()+'" /> </span><span class="lt"> <label for="'+j+'_lt">'+d.lowerThanLabel+'</label> <input data-dir="lt" data-label="'+d.lowerThanLabel.raw2attr()+'"  class="number" step="any" type="number" name="'+i+'[]" id="'+j+'_lt" tabindex="'+g+'" value="'+r[1].raw2attr()+'" /> </span>'+p;if(k==="date"){q=d.replaceAll(q,"number","datetime-local");q=d.replaceAll(q,"step","86400")}return q}}},makeSectionFooterForForm:function(){return"</ul></div>"},makeCheckboxSection:function(f,i){f=jQuery(f);var h=f.attr("name");tabIndex=f.attr("tabindex");var g=d.makeFieldForForm("checkbox",h,tabIndex,i);if(g.length>5){g=g.replace("<input ",'<input checked="checked" ');f.closest("ul").append(g)}},runCurrentSort:function(){var f="."+d.sortDescClass+", ."+d.sortAscClass;var g=d.myTableHolder.find(f).first();if(g&&g.length>0){}else{g=d.myTableHolder.find(d.sortLinkSelector+"[data-sort-default=true]").first()}if(g&&g.length>0){}else{g=d.myTableHolder.find(d.sortLinkSelector).first()}if(g&&g.length>0){g.click()}},applyFilter:function(){d.showFromRow=0;d.workOutCurrentFilter();d.startRowManipulation();window.setTimeout(function(){if(d.debug){console.debug("==============");console.debug(d.currentFilter)}d.myRows.each(function(g,h){var k=jQuery(h);if(d.debug){console.log("===")}var j=true;var f=true;Object.keys(d.currentFilter).forEach(function(n,m){if(f){var l=false;var o=true;for(var p=0;p<d.currentFilter[n].length;p++){var u=d.currentFilter[n][p];if(o){if(n===d.favouritesCategoryTitle){var v=k.attr("id");if(typeof v!=="undefined"&&v.length>0){if(d.favouritesStore.indexOf(v)>-1){l=true}}}else{if(n===d.keywordsCategoryTitle){var w=u.valueToMatch;var x=k.text().toLowerCase();var s=w.split(" ");var r=true;for(var q=0;q<s.length;q++){var t=s[q].trim();if(x.indexOf(t)===-1){r=false;break}}if(r===true){l=true}}else{k.find('span[data-filter="'+n+'"]').each(function(D,C){C=jQuery(C);var B=C.text().toLowerCase().trim();switch(d.dataDictionary[n]["DataType"]){case"date":break;case"number":if(typeof u.valueToMatch!=="undefined"){var A=u.valueToMatch;if(B==A){l=true}}else{B=parseFloat(B.replace(/[^0-9.]/g,""));var i=u.lt;var z=true;if(jQuery.isNumeric(i)&&i!==0){if(i<B){z=false}}if(z){var y=u.gt;if(jQuery.isNumeric(y)&&y!==0){if(y>B){z=false}}}if(z){l=true}break}case"string":default:var A=u.valueToMatch;if(B===A){l=true}}if(l){if(d.debug){console.log("FILTER - MATCH: '"+A+"' in '"+n+"'")}return false}else{if(d.debug){console.log("FILTER - NO MATCH: '"+A+"' in '"+n+"'")}}})}}if(l){o=false}}}if(!l){j=false;f=false}}});if(j){k.addClass(d.matchClass).removeClass(d.notMatchClass)}else{k.addClass(d.notMatchClass).removeClass(d.matchClass)}});d.endRowManipulation();if(d.debug){console.debug(d.currentFilter);console.debug("==============")}},d.millisecondsBetweenActions)},gotoPage:function(f){d.showFromRow=f*d.visibleRowCount;d.startRowManipulation();d.endRowManipulation()},fixTableHeader:function(){var f=this;var g=false;if(f.hasFixedTableHeader){jQuery(window).bind("load resize scroll",function(j){if(f.myTableHolder.isOnScreen()||f.myTableHolder.hasClass(f.filterIsOpenClass)){f.myTableHolder.addClass(f.filterInUseClass);f.myTableHolder.removeClass(f.filterNotInUseClass)}else{f.myTableHolder.addClass(f.filterNotInUseClass);f.myTableHolder.removeClass(f.filterInUseClass)}if(j.type==="resize"){g=false}var i=f.myTableBody.offset().top;var k=jQuery(this).scrollTop();if(k>i){f.myTableHolder.addClass("fixed-header");f.myTableHead.css("top",f.myFilterFormHolder.outerHeight())}else{if(k<=i){f.myTableHolder.removeClass("fixed-header");if(!g){if(j.type!=="load"){g=true;var h=f.myTableHolder.width();f.myFilterFormHolder.width(h);f.myTable.find("tbody tr:first td, tbody tr:first th").each(function(n,l){var l=jQuery(l);var m=l.width();l.width(m);jQuery("thead tr").each(function(o,p){jQuery(p).children().eq(n).width(m)})})}}}}})}},startRowManipulation:function(){if(typeof d.startRowFX1==="function"){d.startRowFX1(d)}d.resetObjects();d.myTable.addClass(d.loadingClass).find(d.moreRowEntriesSelector).hide();d.myTable.hide();d.myRows.each(function(f,g){jQuery(g).addClass(d.hideClass).removeClass(d.showClass)});if(typeof d.startRowFX2==="function"){d.startRowFX2(d)}},endRowManipulation:function(){if(typeof d.endRowFX1==="function"){d.endRowFX1(d)}d.resetObjects();var p=d.showFromRow;var j=0;var t=0;var g=0;var u=d.myTableBody.find("tr."+d.notMatchClass).length===0?true:false;var m=false;d.myRows.each(function(w,x){x=jQuery(x);j++;m=false;if(u||x.hasClass(d.matchClass)){m=true;t++}if(m){if(t>p&&g<d.visibleRowCount){g++;x.removeClass(d.hideClass).addClass(d.showClass)}}});if(t>0){jQuery("."+d.noMatchMessageClass).hide()}else{jQuery("."+d.noMatchMessageClass).show()}var s=p+g;var h=Math.ceil(t/d.visibleRowCount);var n=Math.floor(d.showFromRow/d.visibleRowCount);var r="";if(h>1){var l=0;var f=0;var o=n-2;var k=n+2;for(l=0;l<h;l++){if(n===l){f=0;r+="<span>["+(l+1)+"]</span>"}else{test1=(l>o&&l<k);test2=(l>=(h-3));test3=(l<(0+3));if(test1||test2||test3){f=0;r+='<a href="#" data-page="'+l+'">'+(l+1)+"</a> "}else{if(f<3){f++;r+=" . "}}}r+=" "}d.myTableHolder.find(d.moreRowEntriesSelector).show()}else{d.myTableHolder.find(d.moreRowEntriesSelector).not(".alwaysShow").hide()}p++;d.myTableHolder.find(d.matchRowCountSelector).text(t);d.myTableHolder.find(d.minRowSelector).text(p);d.myTableHolder.find(d.maxRowSelector).text(s);d.myTableHolder.find(d.totalRowCountSelector).text(j);d.myTableHolder.find(d.visibleRowCountSelector).text(g);d.myTableHolder.find(d.paginationSelector).html(r);d.myTable.show();var q=[];if(d.hasFavourites){q.push(d.makeRetrieveButtons(d.favouritesStore.length>0,"favourites"))}if(d.hasFilterSaving){q.push(d.makeRetrieveButtons(d.currentFilter.length>0,"filters"))}if(q.length>0){var v="<ul>"+q.join("</li><li>")+"</ul>";d.myTableHolder.find(d.saveAndLoadSelector).html(v)}d.myTable.removeClass(d.loadingClass);if(!d.myTableHolder.hasClass(d.filterIsOpenClass)){window.setTimeout(function(){jQuery("html, body").animate({scrollTop:d.myTableHolder.position().top},200)},100)}if(d.useBackAndForwardButtons){history.pushState(null,null,d.currentURL())}d.resetObjects();if(typeof d.endRowFX2==="function"){d.endRowFX2(d)}},currentURL:function(){var g={};g.f=d.currentFilter;g.s=d.currentSorter;var f="tfs="+encodeURI(JSON.stringify(g));return d.baseURL+"?"+f},makeRetrieveButtons:function(f,h){var i=[];switch(h){case"favourites":var g=d.favouritesURL;var j=d.favouritesCategoryTitle;break;case"filters":var g=d.filtersURL;var j=d.filtersTitle;break}if(f){i.push('<a href="'+g+'save/" class="save '+h+'">Save '+j+"</a>")}i.push('<a href="'+g+'index/" class="load '+h+'">Load '+j+"</a>");return buttonHTML="<li>"+i.join(" | ")+"</li>"},workOutCurrentFilter:function(){var h="";var n;var g="";var i="";var f="";var j="";var m=[];d.currentFilter={};d.myFilterFormHolder.find(" ."+d.filterGroupClass).each(function(q,s){n=jQuery(s);g=n.attr("data-to-filter");var o=n.attr("field-type");if(o==="keyword"){var p="keyword"}else{if(o==="favourites"){var p="favourites"}else{var p=d.dataDictionary[g]["DataType"]}}var t=[];n.find("input").each(function(z,w){w=jQuery(w);var y=w.val();var x=y.toLowerCase().trim();switch(o){case"keyword":if(x.length>1){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}if(i==="keyword"){d.currentFilter[g].push({valueToMatch:x,inputVal:y});t.push(x)}else{var A=x.split(",");var z=0;var u=A.length;var v="";for(z=0;z<u;z++){innerInputVal=A[z].trim();innerValueToMatch=innerInputVal;if(innerValueToMatch.length>1){d.currentFilter[g].push({valueToMatch:innerValueToMatch,inputVal:innerInputVal});t.push(innerValueToMatch);if(d.debug){console.log("... adding '"+innerValueToMatch+"' to '"+g+"'")}}}}}break;case"tag":case"checkbox":if(w.is(":checked")){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}t.push(x);d.currentFilter[g].push({valueToMatch:x,inputVal:y});if(d.debug){console.log("... adding '"+g+"' to '"+x+"'")}}break;case"favourites":if(w.is(":checked")){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}d.currentFilter[g].push({valueToMatch:x,inputVal:y});t.push(x);if(d.debug){console.log("... adding '"+g+"' to '"+x+"'")}}break;case"number":var B=parseFloat(w.val());if(jQuery.isNumeric(B)&&B!==0){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}t.push(w.attr("data-label")+B+" ");if(typeof d.currentFilter[g][0]==="undefined"){d.currentFilter[g][0]={}}d.currentFilter[g][0][w.attr("data-dir")]=B}break;case"date":var B=w.val().trim();if(B!=="0"&&B!==""){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]={}}t.push(w.attr("data-label")+B);d.currentFilter[g][0][w.attr("data-dir")]=B}break}});if(typeof d.currentFilter[g]!=="undefined"){var r=n.find("label."+d.groupLabelClass).text();h+="<li><strong>"+r+":</strong> <span>"+t.join("</span><span>")+"</span></li>"}});if(h.length===0){h=d.noFilterSelectedText}var l=d.myTableHolder.find("."+d.currentSearchFilterClass);var k=l.attr("data-title");if(typeof k==="undefined"){k=d.currentFilterText}h="<div><h3>"+k+"</h3><ul>"+h+"</ul></div>";l.html(h);if(d.myTableHolder.hasClass(d.filterIsOpenClass)){l.hide()}else{l.show()}},retrieveCookieData:function(){d.myTableBody.find("tr."+d.favouriteClass).each(function(h,j){jQuery(j).removeClass(d.favouriteClass)});d.favouritesStore=Cookies.getJSON("favouritesStore");if(typeof d.favouritesStore==="undefined"){d.favouritesStore=[]}else{for(var f in d.favouritesStore){if(d.favouritesStore.hasOwnProperty(f)){var g=d.favouritesStore[f];d.myTableBody.find("#"+g).toggleClass(d.favouriteClass)}}}},findAndApplyGetVariables:function(){var g={};location.search.substr(1).split("&").forEach(function(l){var j=l.split("="),i=j[0],h=j[1]&&decodeURIComponent(j[1]);(g[i]=g[i]||[]).push(h)});if(typeof g.tfs!=="undefined"){var f=JSON.parse(g.tfs);d.currentFilter=f.f;d.currentSorter=f.s}},replaceAll:function(f,g,h){f.split(g).join(h);return f},objectSize:function(f){var h=0;var g;if(typeof f==="undefined"){return 0}for(g in f){if(f.hasOwnProperty(g)){h++}}return h},objectSort:function(h){var g=[];for(var f in h){if(h.hasOwnProperty(f)){g.push([f,h[f]])}}g.sort(function(l,i){l=l[1];i=i[1];return l<i?-1:(l>i?1:0)});var k={};var j=0;for(j=0;j<g.length;j++){if((typeof g[j][1])==="string"){k[g[j][0]]=g[j][1]}}return k},makeID:function(){var h="";var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var g=0;g<9;g++){h+=f.charAt(Math.floor(Math.random()*f.length))}return h},sortMultiDimensionalArray:function(h,g){var f=h[0];if(typeof f==="string"){f=f.toLowerCase()}var i=g[0];if(typeof i==="string"){i=i.toLowerCase()}if(f===i){return 0}else{return(f<i)?-1:1}}};TableFilterSort=jQuery.extend(d,c);this.each(function(f,g){d.init(e);e++});return{getVar:function(f){if(d.hasOwnProperty(f)){return d[f]}},setVar:function(g,f){d[g]=f;return this},gotoPage:function(f){d.gotoPage(f);return this}}}}(jQuery));String.prototype.raw2attr=function(){return(""+this).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"&#13;").replace(/[\r\n]/g,"&#13;")};String.prototype.attr2raw=function(){var a=(""+this);a=a.replace(/\r\n/g,"\n").replace(/[\r\n]/,"\n").replace(/&#13;&#10;/g,"\n").replace(/&#1[03];/g,"\n").replace(/&#9;/g,"\t").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'");var b=/&[^;]*;?/.match(a);if(b.length>0&&b[0]!=="&amp;"){throw"unsafe entity found in the attribute literal content"}a=a.replace(/&amp;/g,"&");return a};jQuery.fn.isOnScreen=function(){var a={};a.top=jQuery(window).scrollTop();a.bottom=a.top+jQuery(window).height();var b={};b.top=this.offset().top;b.bottom=b.top+this.outerHeight();return((b.top<=a.bottom)&&(b.bottom>=a.top))};