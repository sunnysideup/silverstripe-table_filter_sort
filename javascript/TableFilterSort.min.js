/*
 jquery.unevent.js 0.2
 https://github.com/yckart/jquery.unevent.js
 use jquery.on with timeout

 Copyright (c) 2013 Yannick Albert (http://yckart.com)
 Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php).
 2013/07/26
*/
var $jscomp={scope:{},findInternal:function(e,m,l){e instanceof String&&(e=String(e));for(var h=e.length,a=0;a<h;a++){var b=e[a];if(m.call(l,b,a,e))return{i:a,v:b}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,m,l){if(l.get||l.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[m]=l.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,m,l,h){if(m){l=$jscomp.global;e=e.split(".");for(h=0;h<e.length-1;h++){var a=e[h];a in l||(l[a]={});l=l[a]}e=e[e.length-1];h=l[e];m=m(h);m!=h&&null!=m&&$jscomp.defineProperty(l,e,{configurable:!0,writable:!0,value:m})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,l){return $jscomp.findInternal(this,e,l).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var m=0;return $jscomp.iteratorPrototype(function(){return m<e.length?{done:!1,value:e[m++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(e,m){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var l=0,h={next:function(){if(l<e.length){var a=l++;return{value:m(a,e[a]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};
$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3");if("undefined"===typeof window.JSURL)var JSURL=require("jsurl");if("undefined"===typeof window.doT)var doT=require("dot");jQuery(document).ready(function(){if("undefined"!==typeof TableFilterSortVars&&Array.isArray(TableFilterSortVars))for(var e=0;e<TableFilterSortVars.length;e++){var m=TableFilterSortVars[e];TableFilterSortVars[e].myObject=jQuery(m.mySelector).tableFilterSort(m)}});
(function(e){e.fn.tableFilterSort=function(e){var l=0,h=this,a={debug:!1,profile:!1,useJSON:!1,rowRawData:null,rawDataFieldKey:null,templateRow:"",templateRowCompiled:null,placeholderValue:"N/A",baseURL:"",serverConnectionURL:"/tfs/",urlToLoad:"",serverDataToApply:{cfi:!0,csr:!0,mfv:!0},filtersParentPageID:"",favouritesParentPageID:"",canPushState:!1,holderNumber:0,sizeOfFixedHeader:0,maximumNumberOfFilterOptions:12,maximumNumberOfNumericFilterOptions:5,scrollToTopAtPageOpening:!0,startWithOpenFilter:!1,
millisecondsBetweenActionsShort:20,millisecondsBetweenActionsLong:300,validDataTypes:["date","number","boolean","string"],maximumRowsForHideIdentical:5E3,includeInFilter:[],excludeFromFilter:[],myTableHolder:h,myFilterFormHolder:null,myFilterFormInner:null,myTable:null,myTableHead:null,myTableBody:null,myRows:null,myFloatingTable:null,dataDictionary:{},hasFixedTableHeader:!0,fixedTableHeaderIsOn:null,hasKeywordSearch:!0,keywordToFilterFieldArray:[],hasFavourites:null,hasFormElements:!1,hasFavouritesSaving:!1,
hasFilterSaving:!1,myRowsTotalCount:0,myRowsSorted:[],myRowsMatching:[],myRowsVisible:[],filterAndSortVariables:["cfi","cfc","cfx","csr","pge"],favouritesVariables:["mfv"],cfi:{},cfc:[],cfx:{},csr:{},sfr:0,pge:0,visibleRowCount:10,mfv:[],windowTimeoutStore:{},initFX1:null,initFX2:null,startRowFX1:null,startRowFX2:null,endRowFX1:null,endRowFX2:null,moreDetailsFX:null,greaterThanLabel:"&gt; ",lowerThanLabel:"&lt; ",matchRowCountSelector:".match-row-number",minRowSelector:".min-row-number",maxRowSelector:".max-row-number",
totalRowCountSelector:".total-row-number",visibleRowCountSelector:".total-showing-row-number select",paginationSelector:".pagination",filteredCountHolder:".tfs-match-count-holder",unfilteredCountHolder:".tfs-no-match-count-holder",loadingClass:"loading",fixedHeaderClass:"fixed-header",filterInUseClass:"tfs-filter-in-use",filterNotInUseClass:"tfs-filter-not-in-use",filterIsOpenClass:"filter-is-open",hasFilterClass:"tfs-has-filter",doesNotHaveFilterClass:"tfs-does-not-have-filter",hasFavouritesClass:"tfs-has-favourites",
hasFavouritesInFilterClass:"tfs-has-favourites-in-filter",moreRowEntriesSelector:".tfs-more-entries",commonContentHolderClass:"tfs-common-content-holder",noMatchMessageClass:"no-matches-message",filterFormHolderSelector:".tfs-filter-form-holder",filterFormInnerSelector:".tfs-filter-form-inner",tableSelector:"table.tfs-table",rowSelector:"tbody > tr.tfstr",filterItemAttribute:"data-filter",inputValueDataAttribute:"data-tfsvalue",showMoreDetailsSelector:".more",moreDetailsSelector:".hidden",favouriteLinkSelector:"a.adf",
showClass:"show",hideClass:"hide",matchClass:"match",notMatchClass:"no-match",openedClass:"opened",directLinkClass:"dl",selectedFilterItem:"dl-on",favouriteClass:"fav",currentSearchFilterClass:"tfs-current-search-holder",openAndCloseFilterFormClass:"tfs-open-filter-form",saveAndLoadClass:"tfs-save-and-load",clearFilterClass:"tfs-clear",showFavouritesSelector:".filter-for-favourites a",sectionFilterClassAppendix:"Filter",filterOptionsHolderClass:"tfs-filter-form-options",filterGroupClass:"tfs-filter-column",
groupLabelClass:"tfs-group-label",quickKeywordFilterSelector:'input[name="QuickKeyword"]',inverseSelectionFilterClass:"inverse-selection",sortLinkSelector:"a.sortable",sortAscClass:"sort-asc",sortDescClass:"sort-desc",init:function(b){a.holderNumber=b;a.myTableHolder=h;a.myTableHolder.addClass(a.loadingClass);a.setHTMLAndTemplateRow();a.setRowsWithDetails(!0);a.whatIsIncluded();0<a.myRowsTotalCount?("function"===typeof a.initFX1&&a.initFX1(),a.myTableHolder.find(a.matchRowCountSelector).html("..."),
window.setTimeout(function(){a.turnHTMLIntoJSON();a.dataSampling();a.filterItemCollector();a.dataDictionaryCollector();a.hideIdenticalCols();a.findDefaultSort();a.buildFloatingHeaderTable();a.fixTableHeaderListener();a.setupFilterFormListeners();a.setupSortListeners();a.paginationListeners();a.setupMoreDetailsListener();a.openServerModalWindowListener();a.favouriteLinkListener();a.directFilterLinkListener();a.formElementsListener();a.addURLChangeListener();a.retrieveLocalCookie();a.retrieveDataFromFragment();
a.retrieveDataFromGetVar();a.retrieveDataFromServer();a.myTableHolder.removeClass(a.loadingClass);jQuery("body").scroll();"function"===typeof a.initFX2&&a.initFX2();a.canPushState=!0;a.startWithOpenFilter&&window.setTimeout(function(){a.myFilterFormHolder.find("."+a.openAndCloseFilterFormClass).first().click()},300);window.setTimeout(function(){a.scrollToTopAtPageOpening=!0},1E3)},a.millisecondsBetweenActionsShort)):a.myTableHolder.removeClass(a.loadingClass)},setHTMLAndTemplateRow:function(){a.profileStarter("setHTMLAndTemplateRow");
null!==a.rowRawData&&(a.useJSON=!0);a.myFilterFormHolder=a.myTableHolder.find(a.filterFormHolderSelector).first();a.myFilterFormInner=a.myFilterFormHolder.find(a.filterFormInnerSelector).first();a.myTable=a.myTableHolder.find(a.tableSelector).first();a.myTableHead=a.myTable.find(" > thead");a.myTableBody=a.myTable.find(" > tbody");a.useJSON&&0===a.templateRow.length&&1===a.myTable.find(a.rowSelector).length&&a.buildTemplateRow();a.myTable.css("table-layout","fixed");a.baseURL=location.protocol+"//"+
location.host+location.pathname+location.search;a.profileEnder("setHTMLAndTemplateRow")},buildFloatingHeaderTable:function(){a.profileStarter("buildFloatingHeaderTable");a.myFloatingTable=a.myTable.clone();a.myFloatingTable.appendTo(a.myTableHolder);a.myFloatingTable.addClass("floating-table");a.profileEnder("buildFloatingHeaderTable")},setRows:function(){a.profileStarter("setRows");a.useJSON?null===a.myRows&&(a.myRows=jQuery(a.templateRow)):a.myRows=a.myTable.find(a.rowSelector);a.profileEnder("setRows")},
setRowsWithDetails:function(b,c){a.profileStarter("setRowsWithDetails");a.setRows();"undefined"===typeof c&&(c=!1);0===a.myRowsSorted.length&&(c=!0);c&&(a.myRowsSorted.length=0,a.myRowsSorted=[]);if(a.useJSON){if(b&&a.myTableBody.empty(),c)for(d in a.rowRawData)a.rowRawData.hasOwnProperty(d)&&a.myRowsSorted.push(d)}else if(c||b){var d="";a.myRows.each(function(d,f){f=jQuery(f);if(c){var g=f.attr("id");a.myRowsSorted.push(g)}!0===b&&f.addClass(a.hideClass).removeClass(a.showClass)})}0===a.myRowsTotalCount&&
(a.myRowsTotalCount=a.myRowsSorted.length);a.profileEnder("setRowsWithDetails")},whatIsIncluded:function(){"string"===typeof a.favouritesParentPageID&&0<a.favouritesParentPageID.length?a.hasFavouritesSaving=!0:(a.hasFavouritesSaving=!1,jQuery("."+a.saveAndLoadClass).each(function(a,c){c=jQuery(c);c.hasClass("favourites")&&c.remove()}));"string"===typeof a.filtersParentPageID&&0<a.filtersParentPageID.length?a.hasFilterSaving=!0:(a.hasFilterSaving=!1,jQuery("."+a.saveAndLoadClass).each(function(a,c){c=
jQuery(c);c.hasClass("filters")&&c.remove()}));null===a.hasFavourites&&(a.hasFavourites=0<a.myRows.find(a.favouriteLinkSelector).length?!0:!1);a.hasKeywordSearch&&a.dataDictionaryBuildCategory("Keyword");a.hasFavourites&&a.dataDictionaryBuildCategory("Favourites")},turnHTMLIntoJSON:function(){a.profileStarter("turnHTMLIntoJSON");a.useJSON||(a.setRows(),a.rowRawData={},a.myRows.each(function(b,c){c=jQuery(c);var d=c.attr("id");"string"===typeof d&&0<d.length||(d="tfs-row-"+b,c.attr("id",d));a.rowRawData[d]=
{ID:d};c.find("["+a.filterItemAttribute+"]").each(function(b,c){c=jQuery(c);value=a.findValueOfObject(c);category=c.attr(a.filterItemAttribute);a.dataDictionaryBuildCategory(category);0<value.length&&("undefined"===typeof a.rowRawData[d][category]?a.rowRawData[d][category]=value:!1===Array.isArray(a.rowRawData[d][category])&&(a.rowRawData[d][category]=[a.rowRawData[d][category]],a.rowRawData[d][category].push(value)))})}));a.profileEnder("turnHTMLIntoJSON")},dataSampling:function(){a.profileStarter("dataSampling");
var b=!0;for(rowID in a.rowRawData)if(a.rowRawData.hasOwnProperty(rowID)){for(category in a.rowRawData[rowID])if(a.rowRawData[rowID].hasOwnProperty(category)){if(null!==a.rawDataFieldKey&&a.rawDataFieldKey.hasOwnProperty(category)){var c=a.rawDataFieldKey[category];a.rowRawData[rowID][c]=a.rowRawData[rowID][category];delete a.rowRawData[rowID][category];category=c}!0===b&&a.dataDictionaryBuildCategory(category);c=a.rowRawData[rowID][category];if(null===a.dataDictionary[category].IsEditable){var d=
a.useJSON?jQuery(a.templateRow):a.myTableBody.find("tr").first(),g="["+a.filterItemAttribute+'="'+category+'"]';a.dataDictionary[category].IsEditable=0<d.find("input"+g+", select"+g+", textarea"+g).length?!0:!1}if(""===a.dataDictionary[category].DataType){"keyword"===category?(a.dataDictionary[category].DataType="string",a.dataDictionary[category].CanFilter=!0,a.dataDictionary[category].CanSort=!1,a.dataDictionary[category].IsEditable=!1):"favourites"===category&&(a.dataDictionary[category].DataType=
"boolean",a.dataDictionary[category].CanFilter=!0);for(stillLookingForTypes=!0;Array.isArray(c);)c=c[0],a.dataDictionary[category].CanSort=!1;d=a.findDataTypeOfValue(c);"object"===d&&(a.dataDictionary[category].CanFilter=!1,a.dataDictionary[category].CanSort=!1,a.dataDictionary[category].IsEditable=!1);"array"===d&&(console.log("ERROR: object can not be an array "+d+""),console.log(c));a.dataDictionary[category].DataType=d}}b=!1}a.profileEnder("dataSampling")},filterItemCollector:function(){a.profileStarter("filterItemCollector");
var b,c="",d="";for(d in a.rowRawData)if(a.rowRawData.hasOwnProperty(d)){var g=a.rowRawData[d],f="";for(c in g)if(g.hasOwnProperty(c)){a.dataDictionaryBuildCategory(c);var e=g[c];!1===Array.isArray(e)&&(e=[e]);for(var k=0;k<e.length;k++)b=e[k],a.addValueToRow(c,d,b),f+=" "+a.joinRecursively(b," ").trim()+" "}f=f.replace(/  +/g," ").trim();a.addValueToRow("Keyword",d,f)}a.profileEnder("filterItemCollector")},dataDictionaryCollector:function(){a.profileStarter("dataDictionaryCollector");Object.keys(a.dataDictionary).forEach(function(b,
c){a.dataDictionaryBuildCategory(b);var d=a.myTable.find(a.sortLinkSelector+'[data-sort-field="'+b+'"]').first();if("undefined"===typeof a.dataDictionary[b].CanSort||null===a.dataDictionary[b].CanSort)a.dataDictionary[b].CanSort=0<d.length?!0:!1;a.dataDictionarySorter(b);if("undefined"===typeof a.dataDictionary[b].CanFilter||null===a.dataDictionary[b].CanFilter)"Keyword"===b||"ID"===b?a.dataDictionary[b].CanFilter=!1:0<a.includeInFilter.length&&-1===a.includeInFilter.indexOf(b)?a.dataDictionary[b].CanFilter=
!1:0<a.excludeFromFilter.length&&-1<a.excludeFromFilter.indexOf(b)?a.dataDictionary[b].CanFilter=!1:d&&"true"==d.attr("data-sort-only")?a.dataDictionary[b].CanFilter=!1:a.dataDictionary[b].CanFilter=1<a.dataDictionary[b].Options.length||a.dataDictionary[b].IsEditable?!0:!1});0===a.includeInFilter.length&&(a.includeInFilter=Object.keys(a.dataDictionary).filter(function(b){return a.dataDictionary[b].CanFilter}));a.profileEnder("dataDictionaryCollector")},dataDictionaryBuildCategory:function(b){"undefined"===
typeof a.dataDictionary[b]&&(a.dataDictionary[b]={});"undefined"===typeof a.dataDictionary[b].Built&&("undefined"===typeof a.dataDictionary[b].Label&&(a.dataDictionary[b].Label=a.replaceAll(b,"-"," ")),"undefined"===typeof a.dataDictionary[b].CanFilter&&(a.dataDictionary[b].CanFilter=null),"undefined"===typeof a.dataDictionary[b].CanSort&&(a.dataDictionary[b].CanSort=null),"undefined"===typeof a.dataDictionary[b].DataType&&(a.dataDictionary[b].DataType=""),"undefined"===typeof a.dataDictionary[b].Options&&
(a.dataDictionary[b].Options=[]),"undefined"===typeof a.dataDictionary[b].Values&&(a.dataDictionary[b].Values={}),"undefined"===typeof a.dataDictionary[b].IsEditable&&(a.dataDictionary[b].IsEditable=null),a.dataDictionary[b].Built=!0)},updateMatchingRowsInDataDictionary:function(b,c){for(var d=0;d<a.myRowsMatching.length;d++)a.replaceRowValue(b,a.myRowsMatching[d],c)},setCategoryLabel:function(b,c){a.dataDictionary[b].Label=c;return a},getCategoryLabel:function(b){if("undefined"===typeof a.dataDictionary[b])return b;
a.dataDictionaryBuildCategory(b);return a.dataDictionary[b].Label},replaceRowValue:function(b,c,d){a.dataDictionaryBuildCategory(b);Array.isArray(a.dataDictionary[b].Values[c])&&(a.dataDictionary[b].Values[c].length=0);a.dataDictionary[b].Values[c]=[];a.addValueToRow(b,c,d)},replaceValueInRow:function(b,c,d,g){a.removeValueFromRow(b,c,d);a.addValueToRow(b,c,g);a.standardiseEmptyRows(b,c)},addValueToRow:function(b,c,d){a.dataDictionaryBuildCategory(b);!1===Array.isArray(a.dataDictionary[b].Values[c])&&
(a.dataDictionary[b].Values[c]=[]);a.dataDictionary[b].Values[c].push(d);a.addOptionToCategory(b,d);a.standardiseEmptyRows(b,c)},removeValueFromRow:function(b,c,d){a.dataDictionaryBuildCategory(b);if(!1!==a.dataDictionary[b].Values[c]){if(d!==Object(d)){d=a.dataDictionary[b].Values[c].indexOf(d);if(-1===d)return;a.dataDictionary[b].Values[c].splice(d,1)}else console.log("ERROR: can only remove primitive values from rows!");a.standardiseEmptyRows(b,c)}},standardiseEmptyRows:function(b,c){if(a.isEmptyValue(a.dataDictionary[b].Values[c])){var d=
a.validateValue(b,a.dataDictionary[b].Values[c]);a.dataDictionary[b].Values[c]=d}},replaceOptionInCategory:function(b,c,d){a.addOptionToCategory(b,d)},addOptionToCategory:function(b,c){c=a.validateValue(b,c);if(!a.isEmptyValue(c)){if(Array.isArray(c))for(;0<c.length;)return a.addOptionToCategory(b,c[0]);else if("object"===typeof c)return;-1===a.dataDictionary[b].Options.indexOf(c)&&a.dataDictionary[b].Options.push(c)}},removeOptionFromCategory:function(b,c){c=a.validateValue(b,c);if(!a.isEmptyValue(c)){if(Array.isArray(c))for(;0<
c.length;)return a.removeOptionFromCategory(b,c[0]);else if("object"===typeof c)return;var d=a.dataDictionary[b].Options.indexOf(c);-1<d&&a.dataDictionary[b].Options.splice(d,1)}},findDataTypeOfValue:function(b){return a.isEmptyValue(b)?"":Array.isArray(b)?"array":"object"===typeof b?"object":!0===b?"boolean":isNaN(b)?"string":"number"},isEmptyValue:function(a){return"undefined"===typeof a||""===a||!1===a||0===a||"0"===a||null===a||Array.isArray(a)&&0===a.length||"object"===typeof a&&JSON.stringify(a)===
JSON.stringify({})?!0:!1},validateValue:function(b,c,d){"undefined"===typeof d&&(d=a.dataDictionary[b].DataType);if(a.isEmptyValue(c))switch(d){case "date":return"";case "number":return 0;case "boolean":return!1;case "object":return null;case "string":case "":return"";default:console.log("ERROR: unknown data type."+d+" for "+c)}else if(Array.isArray(c))for(var g=0;g<c.length;g++)c[g]=a.validateValue(b,c[g],d);else if("object"!==typeof c)switch(d){case "date":!1===a.isDate(c)&&(c="");break;case "number":isNaN(c)&&
(c=parseFloat(c.replace(/[^0-9.]/g,""))-0,isNaN(c)&&(c=0));break;case "boolean":!0!==c&&!1!==c&&(c=!1);break;case "string":"string"!==typeof c&&(c="");case "":c=(String(c)+"").trim();break;default:console.log("ERROR: unknown data type."+d+" for "+c)}return c},hideIdenticalCols:function(){a.profileStarter("hideIdenticalCols");if(a.myRowsTotalCount>a.maximumRowsForHideIdentical)a.myTableHolder.find("."+a.commonContentHolderClass).remove();else{var b=!1,c="";Object.keys(a.dataDictionary).forEach(function(d,
e){if(1===a.dataDictionary[d].Options.length&&!0!==a.dataDictionary[d].IsEditable){b=!0;var g=!1;if(a.useJSON){a.myTableBody.empty();a.myTableBody.append(a.templateRow);var f=a.myTableBody.find("["+a.filterItemAttribute+'="'+d+'"]')}else f=a.myRows.find("["+a.filterItemAttribute+'="'+d+'"]');f.each(function(b,e){e=jQuery(e);if(!1===g){var f=e.html();if(a.useJSON)var k=a.dataDictionary[d].Options[0],f=f.split(f).join(k);""===f||e.hasClass("ignore-content")||(c+='<li class="tfs-filter-column"><strong>'+
a.getCategoryLabel(d)+":</strong> <span>"+f+"</span></li>",g=!0)}e.is(":input")||(f=e.parent(),e.remove(),f.is("li")?f.hide():f.is("td")&&0===f.children().length&&(0===b&&(k=f.parent("tr").children("td").index(f),a.myTable.find("thead tr td").eq(k).remove(),a.myTable.find("thead tr th").eq(k).remove()),f.remove(),a.useJSON&&a.buildTemplateRow()))})}});if(b&&10<c.length){var d=a.myTableHolder.find("."+a.commonContentHolderClass).attr("data-title"),c='<div class="'+a.commonContentHolderClass+'-inner">'+
("undefined"!==typeof d?"<h3>"+d+"</h3>":"")+"<ul>"+c,c=c+"</ul></div>";a.myTableHolder.find("."+a.commonContentHolderClass).html(c)}else a.myTableHolder.find("."+a.commonContentHolderClass).remove();a.profileEnder("hideIdenticalCols")}},dataDictionarySorter:function(b){if(Array.isArray(a.dataDictionary[b].Options))switch(a.dataDictionary[b].DataType){case "number":a.dataDictionary[b].Options.sort(function(a,b){"number"!==typeof a&&(a=parseFloat(a.replace(/[^0-9.]/g,"")));"number"!==typeof b&&(b=
parseFloat(b.replace(/[^0-9.]/g,"")));return a-b});break;default:a.dataDictionary[b].Options.sort()}},findDefaultSort:function(){var b=a.myTableHead.find("."+a.sortDescClass+", ."+a.sortAscClass).first();b&&0<b.length||(b=a.myTableHead.find(a.sortLinkSelector+"[data-sort-default=true]").first())&&0<b.length||(b=a.myTableHead.find(a.sortLinkSelector).first());b&&0<b.length&&(a.csr.sdi=b.attr("data-sort-direction"),a.csr.sct=b.attr("data-sort-field"))},fixTableHeaderListener:function(){a.profileStarter("fixTableHeaderListener");
a.hasFixedTableHeader&&(jQuery(window).delayedOn("load resize",function(b){a.fixedTableHeaderIsOn=null},a.millisecondsBetweenActionsShort),jQuery(window).delayedOn("load scroll resize",function(b){a.fixTableHeader()},a.millisecondsBetweenActionsShort));a.profileEnder("fixTableHeaderListener")},setupFilterFormListeners:function(){a.profileStarter("setupFilterFormListeners");a.myFilterFormInner.hide();a.myFilterFormHolder.on("click","."+a.openAndCloseFilterFormClass,function(b){b.preventDefault();a.myFilterFormInner.slideToggle(function(){a.myTableHolder.toggleClass(a.filterIsOpenClass);
a.myTableHolder.hasClass(a.filterIsOpenClass)&&a.scrollToTopOfHolder()});return!1});a.myFilterFormHolder.on("click","."+a.clearFilterClass+" a",function(b){b.preventDefault();a.resetAll();return!1});a.myFilterFormInner.on("change","input",function(b){a.windowTimeoutStoreSetter("runCurrentFilter",function(){a.runCurrentFilter()},a.millisecondsBetweenActionsShort)});a.myFilterFormHolder.on("input paste change",a.quickKeywordFilterSelector,function(b){b=jQuery(this).val();a.myFilterFormInner.find('input[name="Keyword"]').val(b);
a.runCurrentFilter()});a.myFilterFormInner.on("input paste change",'input[name="Keyword"]',function(b){b=jQuery(this).val();a.myFilterFormHolder.find(a.quickKeywordFilterSelector).val(b);a.runCurrentFilter()});a.myFilterFormInner.on("click","."+a.inverseSelectionFilterClass,function(a,c){jQuery(this).toggleClass("flipped");jQuery(this).parent().find('input[type="checkbox"]').each(function(a,b){b=jQuery(b);!0===b[0].checked?b.prop("checked",!1):b.prop("checked",!0);b.change()})});a.profileEnder("setupFilterFormListeners")},
setupSortListeners:function(){a.myTableHolder.on("click",a.sortLinkSelector,function(b){b.preventDefault();b=jQuery(this);a.csr.sdi=b.attr("data-sort-direction");a.csr.sct=b.attr("data-sort-field");a.runCurrentSort()})},paginationListeners:function(){a.myTableHolder.on("click",a.paginationSelector+" a",function(b){b.preventDefault();b=jQuery(this).attr("data-page");a.gotoPage(b);return!1});a.myTableHolder.on("input paste change",a.visibleRowCountSelector,function(){a.windowTimeoutStoreSetter("visibleRowCount",
function(){var b=a.myTableHolder.find(a.visibleRowCountSelector).val(),b=a.visibleRowCountValidator(b);!1!==b&&a.visibleRowCount!==b&&(a.visibleRowCount=b,"undefined"!==typeof Cookies&&Cookies.set("visibleRowCount",a.visibleRowCount,{path:a.baseURL,expires:180}),a.gotoPage(0,!0))},a.millisecondsBetweenActionsLong)})},setupMoreDetailsListener:function(){a.myTableHolder.on("click",a.showMoreDetailsSelector,function(b){b.preventDefault();b=jQuery(this);b.toggleClass(a.openedClass);b.closest("tr").toggleClass(a.openedClass).find(a.moreDetailsSelector).each(function(b,
d){d=jQuery(d);d.slideToggle();d.toggleClass(a.openedClass)});"function"===typeof a.moreDetailsFX&&a.moreDetailsFX(a)})},addURLChangeListener:function(){window.addEventListener("popstate",function(b){a.canPushState=!1;a.retrieveDataFromFragment();a.retrieveDataFromGetVar();a.retrieveDataFromServer();a.canPushState=!0})},directFilterLinkListener:function(){a.myTableBody.on("click","["+a.filterItemAttribute+"]."+a.directLinkClass,function(b){b.preventDefault();var c=jQuery(this);b=c.attr(a.filterItemAttribute);
c=a.findValueOfObject(c).toLowerCase();a.addDirectlyToFilter(b,c);a.runCurrentFilter();return!1})},addDirectlyToFilter:function(b,c,d){if("boolean"!==typeof d||!0!==d)d=!1;b=a.myFilterFormInner.find("."+a.filterGroupClass+'[data-to-filter="'+b+'"]');var g=b.attr("field-type"),f=b.find('input[value="'+c+'"].checkbox').first();f&&0<f.length?f.is(":checkbox")&&(!0===f.prop("checked")&&!1===d?f.prop("checked",!1).trigger("change"):f.prop("checked",!0).trigger("change")):"tag"===g&&a.makeCheckboxSection(b.find("input.awesomplete").first(),
c)},formElementsListener:function(){a.profileStarter("formElementsListener");if(a.hasFormElements)a.myTableBody.on("change","input["+a.filterItemAttribute+"], select["+a.filterItemAttribute+"], textarea["+a.filterItemAttribute+"]",function(b){b=jQuery(this);var c=b.attr(a.filterItemAttribute);if("undefined"!==typeof c&&"object"===typeof a.dataDictionary[c]){var d=b.attr(a.inputValueDataAttribute),g=a.findCurrentValueOfInputObject(b),f=b.closest("tr").attr("id");a.replaceOptionInCategory(c,d,g);a.replaceRowValue(c,
f,g)}b.removeAttr(a.inputValueDataAttribute);a.findValueOfObject(b)});a.profileEnder("formElementsListener")},favouriteLinkListener:function(){a.hasFavourites&&(a.myTableBody.on("click",a.favouriteLinkSelector,function(b){b.preventDefault();b=jQuery(this).closest("td, th").closest("tr");b.toggleClass(a.favouriteClass);b=b.attr("id");"string"===typeof b&&""!==b&&(a.toggleIdInFavourites(b),a.checkAndSaveFavourites());0<a.mfv.length?a.myTableHolder.addClass(a.hasFavouritesClass):a.myTableHolder.removeClass(a.hasFavouritesClass);
return!1}),a.myTableHolder.on("click",a.showFavouritesSelector,function(b){b.preventDefault();b=a.myFilterFormInner.find('input[name="Favourites"]').first();!0===b.prop("checked")?b.prop("checked",!1).trigger("change"):(a.myFilterFormHolder.find("."+a.clearFilterClass+" a").click(),b=a.myFilterFormInner.find('input[name="Favourites"]').first(),b.prop("checked",!0).trigger("change"))}))},checkAndSaveFavourites:function(){for(var b=0;b<a.mfv.length;b++)-1===jQuery.inArray(a.mfv[b],a.myRowsSorted)&&
a.mfv.splice(b,1);"undefined"!==typeof Cookies&&Cookies.set("mfv",a.mfv,{path:a.baseURL,expires:180})},toggleIdInFavourites:function(b){var c=a.mfv.indexOf(b);-1===c?a.mfv.push(b):a.mfv.splice(c,1)},openServerModalWindowListener:function(){if(a.hasFilterSaving||a.hasFavouritesSaving)a.myTableHolder.on("click","."+a.saveAndLoadClass+" a",function(b){b.preventDefault();var c=jQuery(this).closest("."+a.saveAndLoadClass);b=a.serverConnectionURL;var d=!1,g=a.filtersParentPageID,f=a.filterAndSortVariables;
!c.hasClass("filters")&&c.hasClass("favourites")&&(g=a.favouritesParentPageID,f=a.favouritesVariables);c.hasClass("save")?(d=!0,b+="start/"):b+="index/";c={};if(!0===d)for(d=0;d<f.length;d++)c[f[d]]=a[f[d]];c.ParentPageID=g;jQuery.post(b,c,function(b){var c=Math.round(.95*jQuery(window).width())-40,d=Math.round(.95*jQuery(window).height())-40;jQuery.modal('<iframe src="'+b+'" width="'+c+'"height="'+d+'" style="border:0" id="tfs-pop-up-i-frame" name="tfs-pop-up-i-frame">',{closeHTML:"close",containerCss:{backgroundColor:"#fff",
borderColor:"#fff",padding:0,width:c,height:d},opacity:75,overlayClose:!0,onClose:function(){jQuery.modal.close();a.retrieveDataFromGetVar();a.retrieveDataFromServer()}});return!1}).fail(function(){alert("ERROR!")});return!1})},createFilterForm:function(){a.profileStarter("createFilterForm");if(0<a.myFilterFormInner.length){a.myFilterFormInner.html("");for(var b=0,c=[],d='<form class="'+a.filterOptionsHolderClass+'">',g=0;g<a.includeInFilter.length;g++){var f=a.includeInFilter[g];if(a.dataDictionary[f].CanFilter){var b=
g+2,e=0,k=a.dataDictionary[f].Options.length;if("number"!==a.dataDictionary[f].DataType&&k<=a.maximumNumberOfFilterOptions||"number"===a.dataDictionary[f].DataType&&k<=a.maximumNumberOfNumericFilterOptions)for(d+=a.makeSectionHeaderForForm("checkbox",f),e=0;e<k;e++)d+=a.makeFieldForForm("checkbox",f,b,a.dataDictionary[f].Options[e]);else e=a.dataDictionary[f].DataType,"string"===a.dataDictionary[f].DataType&&(c.push(f),e="tag"),d+=a.makeSectionHeaderForForm(e,f),d+=a.makeFieldForForm(e,f,b,0);d+=
a.makeSectionFooterForForm()}}a.hasFavourites&&(d+=a.makeSectionHeaderForForm("Favourites","Favourites"),d+=a.makeFieldForForm("favourites","Favourites",b,0),d+=a.makeSectionFooterForForm(),b++);a.hasKeywordSearch&&(d+=a.makeSectionHeaderForForm("Keyword","Keyword"),d+=a.makeFieldForForm("keyword","Keyword",b,0),d+=a.makeSectionFooterForForm("keyword"));a.myFilterFormInner.html(d+"</form>");a.hasKeywordSearch&&(f=a.myFilterFormInner.find('input[name="Keyword"]').val(),a.myFilterFormHolder.find(a.quickKeywordFilterSelector).val(f));
for(b=b=0;b<c.length;b++)f=c[b],d=a.myFilterFormInner.find('input[name="'+f+'"].awesomplete').first(),d=jQuery(d).attr("id"),d=document.getElementById(d),new Awesomplete(d,{list:a.dataDictionary[f].Options,autoFirst:!0,filter:function(a,b){return Awesomplete.FILTER_CONTAINS(a,b)&&-1===Awesomplete.blackList.indexOf(a.value)},replace:function(b){a.makeCheckboxSection(this.input,b.value);this.input.value="";Awesomplete.blackList.push(b.value);a.runCurrentFilter()}}),d.addEventListener("awesomplete-close",
function(a){"nomatches"===a.reason&&(jQuery(a.srcElement).val(),jQuery(a.srcElement).val(""))}),Awesomplete.blackList=[]}a.profileEnder("createFilterForm")},makeSectionHeaderForForm:function(b,c){var d=b+a.sectionFilterClassAppendix;c.replace(/\W/g,"");d='<div class="'+a.filterGroupClass+" "+d+'" field-type="'+b+'" data-to-filter="'+c.raw2attr()+'">';"checkbox"===b&&(d+='<span class="'+a.inverseSelectionFilterClass+'"><i class="material-icons">flip</i></span>');d+='<label class="'+a.groupLabelClass+
'">'+a.getCategoryLabel(c)+"</label>";return d+"<ul>"},makeFieldForForm:function(b,c,d,g){if(null!==g){var e=c.replace(/\W/g,""),n=g.toString().raw2safe().toLowerCase(),k=("TFS_"+e+"_"+n).replace(/[^a-zA-Z0-9]+/g,"_");if(0===a.myFilterFormInner.find("input#"+k).length){var u='<li class="'+b+'Field">';switch(b){case "favourites":var p="";"undefined"!==typeof a.cfi[c]&&(p=' checked="checked"');return u+'<input class="favourites" type="checkbox" name="'+c.raw2attr()+'" id="'+k+'" tabindex="'+d+'" '+
p+' /><label for="'+k+'">\u2764 \u2764 \u2764</label></li>';case "keyword":case "tag":var h=n=e="";if("keyword"===b){if(e="separate phrases by comma",p="keyword","undefined"!==typeof a.cfi[c]&&"undefined"!==typeof a.cfi[c][0])for(b=0;b<a.cfi[c].length;b++)n=a.cfi[c][b].vtm.raw2attr()}else if("tag"===b){if("undefined"!==typeof a.cfi[c])for(b=0;b<a.cfi[c].length;b++)g=a.cfi[c][b].vtm+"",g=a.makeFieldForForm("checkbox",c,d,g),5<g.length&&(g=g.replace("<input ",'<input checked="checked" ')),h+=g;p="awesomplete"}return u+
'<input class="text '+p+'" type="text" name="'+c.raw2attr()+'" id="'+k+'" tabindex="'+d+'" value="'+n+'" placeholder="'+e.raw2attr()+'" />'+h+"</li>";case "checkbox":p="";if("undefined"!==typeof a.cfi[c])for(b=0;b<a.cfi[c].length;b++)if(n===a.cfi[c][b].vtm){p='checked="checked"';break}c=g.toString().raw2safe();return u+'<input class="checkbox" type="checkbox" name="'+k+'" id="'+k+'" value="'+n+'" '+p+' tabindex="'+d+'" /><label for="'+k+'">'+c+"</label></li>";case "number":case "date":return n={gt:"",
lt:""},"undefined"!==typeof a.cfi[c]&&(n=a.cfi[c][0]),d=u+'<span class="gt"> <label for="'+k+'_gt">'+a.greaterThanLabel+'</label> <input data-dir="gt" data-label="'+a.greaterThanLabel.raw2attr()+'" class="number" step="any" type="number" name="'+e+'[]" id="'+k+'" tabindex="'+d+'" value="'+n.gt+'" /> </span><span class="lt"> <label for="'+k+'_lt">'+a.lowerThanLabel+'</label> <input data-dir="lt" data-label="'+a.lowerThanLabel.raw2attr()+'"  class="number" step="any" type="number" name="'+e+'[]" id="'+
k+'_lt" tabindex="'+d+'" value="'+n.lt+'" /> </span></li>',"date"===b&&(d=a.replaceAll(d,"number","datetime-local"),d=a.replaceAll(d,"step","86400")),d}}}},makeSectionFooterForForm:function(a){return"</ul></div>"},makeCheckboxSection:function(b,c){b=jQuery(b);var d=b.attr("name"),g=b.attr("tabindex"),d=a.makeFieldForForm("checkbox",d,g,c);5<d.length&&(d=d.replace("<input ",'<input checked="checked" '),b.closest("ul").append(d))},resetAll:function(){a.cfi={};a.myRowsMatching.length=0;a.myRowsMatching=
[];a.createFilterForm();a.windowTimeoutStoreSetter("runCurrentFilter",function(){a.runCurrentFilter()},a.millisecondsBetweenActionsShort)},runCurrentSort:function(){a.profileStarter("runCurrentSort");a.windowTimeoutStoreSetter("endRowManipulation");a.sfr=0;a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass);var b=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.csr.sct+'"]').first();if(b&&0<b.length){a.startRowManipulation();var c=a.csr.sct;
a.dataDictionaryBuildCategory(c);type=a.dataDictionary[c].DataType;var b=[],d=a.dataDictionary[c].Values,g;for(g in d)if(d.hasOwnProperty(g)){var e=d[g][0],e=a.validateValue(c,e);b.push([e,g])}if(!a.useJSON){g=a.myTableBody.find("> tr");var n={};jQuery(g).each(function(a,b){var c=jQuery(b),d=c.attr("id");n[d]=c})}a.myTableBody.empty();b.sort(a.getSortComparator(type));g=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.csr.sct+'"]');"desc"===a.csr.sdi?(b.reverse(),g.attr("data-sort-direction",
"asc").addClass(a.sortDescClass).removeClass(a.sortAscClass)):g.attr("data-sort-direction","desc").addClass(a.sortAscClass).removeClass(a.sortDescClass);a.myRowsSorted.length=0;a.myRowsSorted=[];b.forEach(function(b){b=b[1];a.myRowsSorted.push(b);a.useJSON||a.myTableBody.append(n[b])});a.windowTimeoutStoreSetter("endRowManipulation",function(){a.endRowManipulation()},a.millisecondsBetweenActionsShort)}a.profileEnder("runCurrentSort")},runCurrentFilter:function(){a.profileStarter("runCurrentFilter");
a.windowTimeoutStoreSetter("endRowManipulation");a.sfr=0;a.workOutCurrentFilter();a.startRowManipulation();if(!1===a.hasFilter())a.myRowsMatching=a.myRowsSorted.splice(0),a.myRows.each(function(b,c){c=jQuery(c);c.addClass(a.matchClass).removeClass(a.notMatchClass)});else{a.myRowsMatching.length=0;a.myRowsMatching=[];for(var b=0;b<a.myRowsSorted.length;b++){var c=a.myRowsSorted[b];if(!a.useJSON)var d=a.myTableBody.find("#"+c).first();var e=!0,f=!0;Object.keys(a.cfi).forEach(function(b,d){if(f){for(var g=
!1,k=!0,n=0;n<a.cfi[b].length;n++){var h=a.cfi[b][n];if(!0===k){if("Favourites"===b)"undefined"!==typeof c&&0<c.length&&-1<a.mfv.indexOf(c)&&(g=!0);else if(Array.isArray(a.dataDictionary[b].Values[c]))for(var l=a.dataDictionary[b].Values[c],m=0;m<l.length;m++){var q=l[m],q=a.validateValue(b,q);if("Keyword"===b){for(var r=h.vtm,q=q.toLowerCase(),r=r.split(" "),t=!0,w=0;w<r.length;w++){var z=r[w].raw2safe().toLowerCase();if(-1===q.indexOf(z)){t=!1;break}}!0===t&&(g=!0)}else switch(a.dataDictionary[b].DataType){case "date":break;
case "number":"undefined"!==typeof h.vtm?(r=h.vtm,q==r&&(g=!0)):(t=h.lt,r=!0,jQuery.isNumeric(t)&&0!==t&&t<q&&(r=!1),r&&(t=h.gt,jQuery.isNumeric(t)&&0!==t&&t>q&&(r=!1)),r&&(g=!0));break;default:q=q.raw2safe().toLowerCase(),q===h.vtm&&(g=!0)}if(g)return!1}g&&(k=!1)}}g||(f=e=!1)}});e?(a.myRowsMatching.push(c),a.useJSON||d.addClass(a.matchClass).removeClass(a.notMatchClass)):a.useJSON||d.addClass(a.notMatchClass).removeClass(a.matchClass)}}a.windowTimeoutStoreSetter("endRowManipulation",function(){a.endRowManipulation()},
a.millisecondsBetweenActionsShort);a.profileEnder("runCurrentFilter")},gotoPage:function(b,c){a.profileStarter("gotoPage");var d=b*a.visibleRowCount;a.pge=b;if(d!==a.sfr||c)a.windowTimeoutStoreSetter("endRowManipulation"),a.sfr=d,a.startRowManipulation(),a.windowTimeoutStoreSetter("endRowManipulation",function(){a.endRowManipulation()},a.millisecondsBetweenActionsShort);a.profileEnder("gotoPage")},reloadCurrentPage:function(){a.profileStarter("reloadCurrentPage");a.windowTimeoutStoreSetter("endRowManipulation");
a.startRowManipulation();a.windowTimeoutStoreSetter("endRowManipulation",function(){a.endRowManipulation()},a.millisecondsBetweenActionsShort);a.profileEnder("reloadCurrentPage")},scrollToTopOfHolder:function(){if(a.canPushState&&a.scrollToTopAtPageOpening){var b=a.myTableHolder.position().top;a.sizeOfFixedHeader&&(b-=a.sizeOfFixedHeader);jQuery("html, body").animate({scrollTop:b},a.millisecondsBetweenActionsLong);a.scrollToTopAtPageOpening=!0}else window.scrollTo(window.scrollX,window.scrollY)},
fixTableHeader:function(){a.profileStarter("fixTableHeader");if(a.hasFixedTableHeader){var b=!1,c=a.myTableHead.width();100<c&&a.myFilterFormHolder.width(c);a.myTableHolder.isOnScreen()&&(b=a.myTableBody.offset().top,b=jQuery(window).scrollTop()>b?!0:!1);!0!==b||!1!==a.fixedTableHeaderIsOn&&null!==a.fixedTableHeaderIsOn||(a.myTableHolder.removeClass(a.filterIsOpenClass),a.myFilterFormInner.slideUp(0),a.myTableHolder.addClass(a.fixedHeaderClass),a.fixedTableHeaderIsOn=!0,100<c&&a.myFloatingTable.width(c),
c=a.myFilterFormHolder.outerHeight(!0)-2,a.myFloatingTable.css("top",c),a.myTable.css("margin-top",c));!1!==b||!0!==a.fixedTableHeaderIsOn&&null!==a.fixedTableHeaderIsOn||(a.fixedTableHeaderIsOn=!1,a.myTableHolder.removeClass(a.fixedHeaderClass),a.myTable.css("margin-top",0))}a.profileEnder("fixTableHeader")},startRowManipulation:function(){a.profileStarter("startRowManipulation");"function"===typeof a.startRowFX1&&a.startRowFX1(a);a.myTable.addClass(a.hideClass);a.setRowsWithDetails(!0);"function"===
typeof a.startRowFX2&&a.startRowFX2(a);a.profileEnder("startRowManipulation")},endRowManipulation:function(){a.profileStarter("endRowManipulation");"function"===typeof a.endRowFX1&&a.endRowFX1(a);a.setRowsWithDetails();var b=a.sfr,c=0,d=0,g=a.hasFilter(),e=g?!1:!0;if(g)var h=a.myRowsMatching.slice(0);else a.myRowsTotalCount!==a.myRowsMatching.length&&(a.myRowsMatching=a.myRowsSorted.splice(0));a.myRowsVisible.length=0;a.myRowsVisible=[];if(a.useJSON){for(var k=0;k<a.myRowsSorted.length;k++){var m=
a.myRowsSorted[k],p=!1;if(g){var l=h.indexOf(m);-1!==l&&(p=!0,h.splice(l,1))}else p=!0;p&&(c++,c>b&&d<a.visibleRowCount&&(d++,a.myRowsVisible.push(m)))}a.buildRows()}else a.myRows.each(function(g,f){f=jQuery(f);m=f.attr("id");if(e||f.hasClass(a.matchClass))c++,c>b&&d<a.visibleRowCount&&(d++,f.removeClass(a.hideClass).addClass(a.showClass),a.myRowsVisible.push(m))});a.highlightFilteredRows();a.myTable.removeClass(a.hideClass);a.myTableHolder.hasClass(a.filterIsOpenClass)||a.windowTimeoutStoreSetter("scrollToTopOfHolder",
function(){a.scrollToTopOfHolder()},a.millisecondsBetweenActionsLong);a.createPagination(b,c,d);a.setRowsWithDetails();a.pushState();"function"===typeof a.endRowFX2&&a.endRowFX2(a);a.profileEnder("endRowManipulation");a["debugger"]()},buildTemplateRow:function(){a.templateRow=a.myTableBody.clone().html();a.templateRowCompiled=doT.template(a.templateRow);a.myTableBody.empty()},buildRows:function(){a.profileStarter("buildRows");for(var b=a.dataDictionary,c="",d=0;d<a.myRowsVisible.length;d++){var e=
{};e.RowID=a.myRowsVisible[d];for(category in b)if(b.hasOwnProperty(category)){var f=b[category].Values[e.RowID];"undefined"!==typeof f&&(e[category]=f)}c+=a.templateRowCompiled(e)}if(0<c.length)for(a.myTableBody.html(c),a.myTableBody.find("input["+a.inputValueDataAttribute+"], select["+a.inputValueDataAttribute+"], textarea["+a.inputValueDataAttribute+"]").each(function(b,c){c=jQuery(c);var d=c.attr(a.inputValueDataAttribute),d=d.raw2safe();jQuery(c).val(d)}),d=0;d<a.mfv.length;d++)a.myTableBody.find("#"+
a.mfv[d]).addClass(a.favouriteClass);a.profileEnder("buildRows")},highlightFilteredRows:function(){a.profileStarter("highlightFilteredRows");a.myTableBody.find("."+a.selectedFilterItem).each(function(b,c){jQuery(c).removeClass(a.selectedFilterItem)});Object.keys(a.cfi).forEach(function(b,c){for(var d=a.cfi[b],e=[],f=0;f<d.length;f++)e.push(d[f].vtm);a.myTableBody.find("["+a.filterItemAttribute+'="'+b+'"]').each(function(b,c){var d=jQuery(c).text().toString().raw2safe().toLowerCase();for(b=0;b<e.length;b++)if(d===
e[b]){jQuery(c).addClass(a.selectedFilterItem);break}})});a.profileEnder("highlightFilteredRows")},createPagination:function(b,c,d){0<c?jQuery("."+a.noMatchMessageClass).hide():jQuery("."+a.noMatchMessageClass).show();d=b+d;var e=Math.ceil(c/a.visibleRowCount),f=Math.floor(a.sfr/a.visibleRowCount),h="";if(1<e){var k,m=0,p=f-2,l=f+2,v=[];for(k=0;k<e;k++){if(f===k)m=0,h+="<span>["+(k+1)+"]</span>";else{var x=k>=e-1,y=1>k;k>p&&k<l||x||y?(v.length=0,v=[],m=0,0===k&&v.push("first"),k===e-1&&v.push("last"),
k===f-1&&v.push("prev"),k===f+1&&v.push("next"),h+='<a href="#" class="'+v.join(" ")+'"data-page="'+k+'">'+(k+1)+"</a> "):3>m&&(m++,h+=" . ")}h+=" "}a.myTableHolder.find(a.moreRowEntriesSelector).show()}b++;a.myRowsTotalCount===c?(a.myTableHolder.find(a.filteredCountHolder).hide(),a.myTableHolder.find(a.unfilteredCountHolder).show()):(a.myTableHolder.find(a.unfilteredCountHolder).hide(),a.myTableHolder.find(a.filteredCountHolder).show());a.myTableHolder.find(a.minRowSelector).text(b);a.myTableHolder.find(a.maxRowSelector).text(d);
a.myTableHolder.find(a.matchRowCountSelector).text(c);a.myTableHolder.find(a.totalRowCountSelector).text(a.myRowsTotalCount);a.myTableHolder.find(a.visibleRowCountSelector).val(a.visibleRowCount);a.myTableHolder.find(a.paginationSelector).html(h)},hasFilter:function(){return 0===a.objectSize(a.cfi)?!1:!0},workOutCurrentFilter:function(){a.profileStarter("workOutCurrentFilter");var b="";a.cfi={};a.myFilterFormHolder.find(" ."+a.filterGroupClass).each(function(c,d){var e="",g="",f=jQuery(d),h=f.attr("data-to-filter"),
m=f.attr("field-type").toLowerCase(),l=[];f.find("input").each(function(b,c){c=jQuery(c);var d=c.val(),f=a.validateValue(h,d);e=d.raw2safe();g=e.toLowerCase();var k,n;switch(m){case "keyword":if(1<g.length){g.replace(" OR ",",");for(var d=g.split(","),p=d.length,f=0;f<p;f++)if(k=d[f].trim(),1<k.length){var v=k;if(Array.isArray(a.keywordToFilterFieldArray)&&0<a.keywordToFilterFieldArray.length)for(n=0;n<a.keywordToFilterFieldArray.length;n++)if(2<k.length){var u=a.keywordToFilterFieldArray[n];-1<a.dataDictionary[u].Options.indexOf(k)&&
("undefined"===typeof a.cfi[u]&&(a.cfi[u]=[]),a.cfi[u].push({vtm:k,ivl:k}),k="")}1<k.length&&(n=k,"undefined"===typeof a.cfi[h]&&(a.cfi[h]=[]),a.cfi[h].push({vtm:n,ivl:k}));l.push(v)}}break;case "tag":case "checkbox":c.is(":checked")&&("undefined"===typeof a.cfi[h]&&(a.cfi[h]=[]),l.push(g),a.cfi[h].push({vtm:g,ivl:e}));break;case "favourites":c.is(":checked")?("undefined"===typeof a.cfi[h]&&(a.cfi[h]=[]),a.cfi[h].push({vtm:g,ivl:e}),l.push(g),a.myTableHolder.addClass(a.hasFavouritesInFilterClass)):
a.myTableHolder.removeClass(a.hasFavouritesInFilterClass);break;case "date":""!==f&&("undefined"===typeof a.cfi[h]&&(a.cfi[h]={}),l.push(c.attr("data-label")+f),a.cfi[h][0][c.attr("data-dir")]=f);break;case "number":0!==f&&""!==f&&("undefined"===typeof a.cfi[h]&&(a.cfi[h]=[]),"undefined"===typeof a.cfi[h][0]&&(a.cfi[h][0]={}),l.push(c.attr("data-label")+f+" "),a.cfi[h][0][c.attr("data-dir")]=f);break;case "boolean":if(!1===f||!0===f)"undefined"===typeof a.cfi[h]&&(a.cfi[h]={}),l.push(c.attr("data-label")+
f),a.cfi[h][0][c.attr("data-dir")]=f}});0<l.length&&(f=a.getCategoryLabel(h),b+='<li class="category"><strong>'+f+":</strong> <span>"+l.join("</span><span>")+"</span></li>")});var c=a.myTableHolder.find("."+a.currentSearchFilterClass);if(!0===a.hasFilter()){var b="<ul>"+b+"</ul>",d=c.attr("data-title");"string"===typeof d&&0<d.length&&(b="<h3>"+d+"</h3>"+b);a.myTableHolder.addClass(a.hasFilterClass).removeClass(a.doesNotHaveFilterClass)}else b=c.attr("data-no-filter-text"),a.myTableHolder.removeClass(a.hasFilterClass).addClass(a.doesNotHaveFilterClass);
c.html(b);a.profileEnder("workOutCurrentFilter")},pushState:function(){!0===a.canPushState&&history.replaceState(null,null,a.currentURL())},currentURL:function(){for(var b={},c=0;c<a.filterAndSortVariables.length;c++){var d=a.filterAndSortVariables[c],e=typeof a[d];if("number"===e&&0!==a[d]||"string"===e&&0<a[d].length||"boolean"===e||"object"===e&&0<a.objectSize(a[d]))b[d]=a[d]}b="undefined"!==typeof JSURL?JSURL.stringify(b):"tfs="+encodeURI(JSON.stringify(b));return a.baseURL+"#"+b},retrieveLocalCookie:function(){if("undefined"!==
typeof Cookies){a.mfv=Cookies.getJSON("mfv");"undefined"===typeof a.mfv?a.mfv=[]:a.serverDataToApply.mfv=!0;var b=Cookies.getJSON("visibleRowCount");visibleRowCount=a.visibleRowCountValidator(b);!1!==visibleRowCount&&(a.visibleRowCount=b)}},retrieveDataFromFragment:function(){if("undefined"!==typeof JSURL&&"undefined"!==typeof location.hash&&location.hash&&0<location.hash.length){var b=window.location.hash.substr(1),b=JSURL.tryParse(b,{}),c;for(c in b)b.hasOwnProperty(c)&&("pge"===c&&(b[c]=parseInt(b[c])),
a[c]=b[c],a.serverDataToApply[c]=!0)}},retrieveDataFromGetVar:function(){var b={};"undefined"!==typeof location.search&&location.search&&0<location.search.length&&location.search.substr(1).split("&").forEach(function(a){var c=a.split("=");a=c[0];c=c[1]&&decodeURIComponent(c[1]);(b[a]=b[a]||[]).push(c)});"undefined"!==typeof b.load&&"undefined"!==typeof b.load[0]&&"string"===typeof b.load[0]&&0<b.load.length&&(a.urlToLoad=b.load)},retrieveDataFromServer:function(b){a.profileStarter("retrieveDataFromServer");
b=!1;if(""!==a.urlToLoad){var c=a.serverConnectionURL+"load/"+a.urlToLoad+"/";a.urlToLoad="";jQuery.getJSON(c,function(c){c=c.Data;c=JSON.parse(c);for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d],a.serverDataToApply[d]=!0,"mfv"===d&&(b=!0))}).fail(function(){alert("Error - trying it again ...")})}a.profileEnder("retrieveDataFromServer");a.processRetrievedData(b)},processRetrievedData:function(b){a.profileStarter("processRetrievedData");"undefined"!==typeof a.serverDataToApply.mfv&&!0===a.serverDataToApply.mfv&&
(a.checkAndSaveFavourites(),a.useJSON||a.myTableBody.find("tr."+a.favouriteClass).removeClass(a.favouriteClass),0<a.mfv.length?a.myTableHolder.addClass(a.hasFavouritesClass):a.myTableHolder.removeClass(a.hasFavouritesClass),!0===b&&(a.myTableHolder.hasClass(a.hasFavouritesInFilterClass)&&a.myTableHolder.find(a.showFavouritesSelector).click(),a.myTableHolder.find(a.showFavouritesSelector).click()),delete a.serverDataToApply.mfv);a.createFilterForm();"undefined"!==typeof a.serverDataToApply.cfi&&!0===
a.serverDataToApply.cfi&&(a.runCurrentFilter(),delete a.serverDataToApply.cfi);if("undefined"!==typeof a.serverDataToApply.csr&&!0===a.serverDataToApply.csr){b=a.csr.sct;var c=a.csr.sdi;a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass);a.myTableHead.find(a.sortLinkSelector+"[data-sort-field='"+b+"']").attr("data-sort-direction",c).click();delete a.serverDataToApply.csr}"undefined"!==typeof a.serverDataToApply.pge&&!0===a.serverDataToApply.pge&&(a.gotoPage(a.pge),
delete a.serverDataToApply.pge);a.profileEnder("processRetrievedData")},getSortComparator:function(b){switch(b){case "number":return a.numberComparator;case "string":return a.stringComparator;default:return a.stringComparator}},findValueOfObject:function(b){var c;if("undefined"===typeof b)return"";c=b.prop("nodeName");"undefined"===typeof c&&(c="SPAN");var d=c.toUpperCase(),e=!1;switch(d){case "INPUT":case "SELECT":case "TEXTAREA":c=b.attr(a.inputValueDataAttribute);"undefined"!==typeof c&&(e=!0);
break;default:e=!0,c=b.text().trim()}!1===e&&(c=a.findCurrentValueOfInputObject(b,d),b.attr(a.inputValueDataAttribute,c));return c=c.raw2safe()},findCurrentValueOfInputObject:function(a,c){"undefined"===typeof c&&(c=a.prop("nodeName").toUpperCase());switch(c){case "INPUT":return"checkbox"===a.attr("type")?a[0].checked?"YES":"NO":a.val();case "SELECT":return a.find("option:selected").text();case "TEXTAREA":return a.val();default:return""}},replaceAll:function(a,c,d){a.split(c).join(d);return a},objectSize:function(a){var b=
0,d;if("undefined"===typeof a)return 0;for(d in a)a.hasOwnProperty(d)&&b++;return b},objectSort:function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push([d,a[d]]);b.sort(function(a,b){a=a[1];b=b[1];return a<b?-1:a>b?1:0});a={};for(d=d=0;d<b.length;d++)"string"===typeof b[d][1]&&(a[b[d][0]]=b[d][1]);return a},visibleRowCountValidator:function(a){a=parseInt(a);return!isNaN(a)&&(a|0)===a&&0<a&&1E4>a?a:!1},makeID:function(){for(var a="",c=0;9>c;c++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*
Math.random()));return a},stringComparator:function(a,c){var b=a[0].toLowerCase(),e=c[0].toLowerCase();return b===e?0:b>e?1:-1},numberComparator:function(a,c){return isNaN(a[0])?1:isNaN(c[0])?-1:a[0]-c[0]},joinRecursively:function(b,c){var d=[];if("string"===typeof b||"number"===typeof b)d.push(b);else if(Array.isArray(b))for(var e=0;e<b.length;e++)d.push(a.joinRecursively(b[e],c));else if("object"===typeof b)for(e in b)b.hasOwnProperty(e)&&d.push(a.joinRecursively(b[e],c));return c+d.join(c)},isDate:function(a){if("string"===
typeof a&&(a=a.split("/"),3===a.length)){var b=new Date(a[2],a[1]-1,a[0]);return isDate=b&&b.getMonth()+1==a[1]}return!1},windowTimeoutStoreSetter:function(b,c,d){"undefined"!==typeof a.windowTimeoutStore[b]&&window.clearTimeout(a.windowTimeoutStore[b]);"undefined"===typeof d&&(d=a.millisecondsBetweenActionsShort);"undefined"!==typeof c&&(a.windowTimeoutStore[b]=window.setTimeout(c,d))},profileStarter:function(b){!0===a.debug&&(console.log("_______________________"),console.count(b),console.time(b),
!0===a.profile&&console.profile(b))},profileEnder:function(b){!0===a.debug&&(!0===a.profile&&console.profileEnd(b),console.timeEnd(b),console.log("-----------------------"))},"debugger":function(b){if(!0===a.debug){console.log("_______________________");console.log("_______________________ SORTED");console.log(a.myRowsSorted);console.log("_______________________ HAS FILTER");console.log(a.hasFilter()?"TRUE":"FALSE");console.log("_______________________ MATCHING");console.log(a.myRowsMatching);console.log("_______________________  VISIBLE ");
console.log(a.myRowsVisible);b=[];var c=[],d=[],e=[],f=[],h=[],k=[];for(prop in a)switch(value=a[prop],typeof value){case "boolean":b[prop]=value;break;case "string":c[prop]=value;break;case "number":d[prop]=value;break;case "object":Array.isArray(value)?e[prop]=value:value instanceof jQuery?f[prop]=value:h[prop]=value;break;default:k[prop]=value}console.log("_______________________ BOOLEANS");console.log(b);console.log("_______________________ STRINGS");console.log(c);console.log("_______________________ NUMBERS");
console.log(d);console.log("_______________________ ARRAYS");console.log(e);console.log("_______________________ JQUERY OBJECTS");console.log(f);console.log("_______________________ OTHER OBJECTS");console.log(h);console.log("_______________________ OTHERS");console.log(k);console.log("_______________________")}}},a=jQuery.extend(a,e);this.each(function(b,c){a.init(l);l++});return{getVar:function(b){if(a.hasOwnProperty(b))return a[b]},setVar:function(b,c){a[b]=c;return this},reloadCurrentPage:function(b){a.reloadCurrentPage();
return this},gotoPage:function(b){a.gotoPage(b);return this},reloadCurrentSelection:function(){a.gotoPage(0,!0);return this},updateDataDictionaryForCategoryRow:function(b,c,d){a.replaceRowValue(b,c,d);return this},updateMatchingRowsInDataDictionary:function(b,c){a.updateMatchingRowsInDataDictionary(b,c);return this},resetAll:function(){a.resetAll();return this}}}})(jQuery);
String.prototype.raw2safe=function(){var e=document.createElement("DIV");e.innerHTML=this;return(e.textContent||e.innerText||"").trim()};String.prototype.raw2attr=function(){return(""+this).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"&#13;").replace(/[\r\n]/g,"&#13;")};
String.prototype.attr2raw=function(){var e;e=(""+this).replace(/\r\n/g,"\n").replace(/[\r\n]/,"\n").replace(/&#13;&#10;/g,"\n").replace(/&#1[03];/g,"\n").replace(/&#9;/g,"\t").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'");var m=/&[^;]*;?/.match(e);if(0<m.length&&"&amp;"!==m[0])throw"unsafe entity found in the attribute literal content";return e=e.replace(/&amp;/g,"&")};
jQuery.fn.isOnScreen=function(){var e,m;e=jQuery(window).scrollTop();m=e+jQuery(window).height();var l,h;l=this.offset().top;h=l+this.outerHeight();return l<=m&&h>=e};(function(e){var m=e.fn.on,l;e.fn.delayedOn=function(){var e=Array.apply(null,arguments),a=e[e.length-1];if(isNaN(a)||1===a&&e.pop())return m.apply(this,e);var b=e.pop(),c=e.pop();e.push(function(){var a=this,e=arguments;window.clearTimeout(l);l=setTimeout(function(){c.apply(a,e)},b)});return m.apply(this,e)}})(jQuery);
