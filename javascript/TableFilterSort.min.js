jQuery(document).ready(function(){if("undefined"!==typeof TableFilterSortTableList)for(var g=0,g=0;g<TableFilterSortTableList.length;g++)TableFilterSortTableList[g]=jQuery(TableFilterSortTableList[g]).tableFilterSort()});
(function(g){g.fn.tableFilterSort=function(g){var n=0,p=this,a={debug:!1,baseURL:"",serverConnectionURL:"/tfs/",serverDataToApply:{cfinc:!0,csort:!0,myfavs:!0},filtersParentPageID:"",favouritesParentPageID:"",useBackAndForwardButtons:!0,holderNumber:0,myTableHolder:p,myFilterFormHolder:null,myFilterFormInner:null,myTable:null,myTableHead:null,myTableBody:null,myRows:null,dataDictionary:[],filterAndSortVariables:["cfinc","cforcat","cfex","csort"],favouritesVariables:["myfavs"],cfinc:{},cforcat:[],
cfex:{},csort:{},showFromRow:0,visibleRowCount:50,totalRowCount:0,maximumNumberOfFilterOptions:30,intervalForFilterCheck:1E3,hasFixedTableHeader:!0,hasKeywords:!0,hasFavourites:!1,hasFavouritesSaving:!1,hasFilterSaving:!1,millisecondsBetweenActions:10,setTableWidthInFuture:null,validDataTypes:["number","string","date","boolean"],maxNumberOfValuesToCheck:500,myfavs:[],startRowFX1:null,startRowFX2:null,endRowFX1:null,endRowFX2:null,greaterThanLabel:"&gt; ",lowerThanLabel:"&lt; ",keywordsCategoryTitle:"Keywords",
favouritesCategoryTitle:"Favourites",filtersTitle:"Filter",matchRowCountSelector:".match-row-number",minRowSelector:".min-row-number",maxRowSelector:".max-row-number",totalRowCountSelector:".total-row-number",visibleRowCountSelector:".total-showing-row-number",paginationSelector:".pagination",loadingClass:"loading",fixedHeaderClass:"fixed-header",filterInUseClass:"tfs-filter-in-use",filterNotInUseClass:"tfs-filter-not-in-use",filterIsOpenClass:"filter-is-open",filterIsClosedClass:"filter-is-closed",
hasFilterClass:"tfs-has-filter",doesNotHaveFilterClass:"tfs-does-not-have-filter",hasFavouritesClass:"tfs-has-favourites",hasFavouritesInFilterClass:"tfs-has-favourites-in-filter",moreRowEntriesSelector:".tfs-more-entries",commonContentHolderClass:"tfs-common-content-holder",noMatchMessageClass:"no-matches-message",filterFormHolderSelector:".tfs-filter-form-holder",filterFormInnerSelector:".tfs-filter-form-inner",tableSelector:"table.tfs-table",rowSelector:"tr.tfstr",filterItemSelector:"span[data-filter]",
showMoreDetailsSelector:".more",moreDetailsSelector:".hidden",favouriteLinkSelector:"a.addFav",showClass:"show",hideClass:"hide",matchClass:"match",notMatchClass:"no-match",openedClass:"opened",closedClass:"closed",directLinkClass:"dl",favouriteClass:"fav",currentSearchFilterClass:"tfs-current-search-holder",openAndCloseFilterFormClass:"tfs-open-filter-form",saveAndLoadClass:"tfs-save-and-load",currentFilterClass:"tfs-current-filter",clearFilterClass:"tfs-clear",showFavouritesSelector:".filter-for-favourites a",
sectionFilterClassAppendix:"Filter",filterOptionsHolderClass:"tfs-filter-form-options",filterGroupClass:"tfs-filter-column",groupLabelClass:"tfs-group-label",sortLinkSelector:"a.sortable",sortAscClass:"sort-asc",sortDescClass:"sort-desc",init:function(b){a.holderNumber=b;a.myTableHolder=p;a.myFilterFormHolder=a.myTableHolder.find(a.filterFormHolderSelector).first();a.myFilterFormInner=a.myFilterFormHolder.find(a.filterFormInnerSelector).first();a.myTable=a.myTableHolder.find(a.tableSelector).first();
a.myTableHead=a.myTableHolder.find("table thead");a.myTableBody=a.myTable.find(" > tbody");a.resetObjects();a.favouritesParentPageID=a.myTableHolder.attr("data-favourites-parent-page-id");"string"===typeof a.favouritesParentPageID&&0<a.favouritesParentPageID.length&&(a.hasFavouritesSaving=!0);a.filtersParentPageID=a.myTableHolder.attr("data-filters-parent-page-id");"string"===typeof a.filtersParentPageID&&0<a.filtersParentPageID.length&&(a.hasFilterSaving=!0);a.baseURL=location.protocol+"//"+location.host+
location.pathname;1<a.myRows.length&&window.setTimeout(function(){a.debug&&console.profile("filterItemCollector");a.filterItemCollector();a.debug&&(console.profileEnd(),console.profile("tableHideColsWhichAreAllTheSame"));a.tableHideColsWhichAreAllTheSame();a.debug&&(console.profileEnd(),console.profile("setTableWidth"));a.setTableWidth();a.myTableHolder.addClass(a.loadingClass);a.debug&&(console.profileEnd(),console.profile("dataDictionaryCollector"));a.dataDictionaryCollector();a.debug&&(console.profileEnd(),
console.profile("findDefaultSort"));a.findDefaultSort();a.debug&&(console.profileEnd(),console.profile("fixTableHeaderListener"));a.fixTableHeaderListener();a.debug&&(console.profileEnd(),console.profile("setupFilterFormListeners"));a.setupFilterFormListeners();a.debug&&(console.profileEnd(),console.profile("setupSortListeners"));a.setupSortListeners();a.debug&&(console.profileEnd(),console.profile("paginationListeners"));a.paginationListeners();a.debug&&console.profile("setupMoreDetailsListener");
a.setupMoreDetailsListener();a.debug&&console.profile("addURLChangeListener");a.addURLChangeListener();a.debug&&(console.profileEnd(),console.profile("openServerModalWindowListener"));a.openServerModalWindowListener();a.debug&&(console.profileEnd(),console.profile("favouriteLinkListener"));a.favouriteLinkListener();a.debug&&(console.profileEnd(),console.profile("directFilterLinkListener"));a.directFilterLinkListener();a.debug&&(console.profileEnd(),console.profile("retrieveLocalCookie"));a.retrieveLocalCookie();
a.debug&&(console.profileEnd(),console.profile("retrieveDataFromURL"));a.retrieveDataFromURL();a.debug&&(console.profileEnd(),console.profile("retrieveDataFromServer"));a.retrieveDataFromServer();a.debug&&(console.profileEnd(),console.profile("applyFilter"));a.applyFilter();a.debug&&(console.profileEnd(),console.profile("runCurrentSort"));a.runCurrentSort();a.debug&&console.profileEnd();a.myTableHolder.removeClass(a.loadingClass)},a.millisecondsBetweenActions)},resetObjects:function(){a.myRows=a.myTable.find(a.rowSelector)},
setTableWidth:function(){var b="<colgroup>";a.myTableHead.find("tr:first th:visible").each(function(a,d){d=jQuery(d);var e=d.width(),f=e+"px";b+='<col width="'+e+'" style="width: '+f+"; min-width: "+f+"; max-width: "+f+';" />';d.css("min-width",f).css("max-width",f).css("width",f)});b+="</colgroup>";a.myTable.prepend(b);a.myTableHolder.find(".tfspushdowndiv").first().remove();jQuery('<div class="tfspushdowndiv"></div>').insertBefore(a.myTable)},filterItemCollector:function(){var b="",c="";a.myRows.each(function(d,
e){jQuery(e).find(a.filterItemSelector).each(function(d,e){e=jQuery(e);b=e.text();c=e.attr("data-filter");0<b.trim().length&&("undefined"===typeof a.dataDictionary[c]&&(a.dataDictionary[c]={}),"undefined"===typeof a.dataDictionary[c].Options&&(a.dataDictionary[c].Options=[]),-1===a.dataDictionary[c].Options.indexOf(b)&&a.dataDictionary[c].Options.push(b))})})},tableHideColsWhichAreAllTheSame:function(){var b=a.myTableHolder.find("."+a.commonContentHolderClass).attr("data-title"),c='<div class="'+
a.commonContentHolderClass+'-inner">'+("undefined"!==typeof b?"<h3>"+b+"</h3>":"")+"<ul>",d=!1;Object.keys(a.dataDictionary).forEach(function(b,f){if(1===a.dataDictionary[b].Options.length){delete a.dataDictionary[b];a.debug&&console.debug("tableHideColsWhichAreAllTheSame: checking category: "+b);d=!0;var m=!1;jQuery('span[data-filter="'+b+'"]').each(function(d,f){f=jQuery(f);m||""===f.html()||f.hasClass("ignore-content")||(c+="<li><strong>"+b+":</strong> <span>"+f.html()+"</span></li>",m=!0);var h=
f.parent();f.remove();if(h.is("li"))h.hide();else if(h.is("td")&&0===h.children().length){if(0===d){var g=h.parent("tr").children("td").index(h);a.myTable.find("th").eq(g).remove()}h.remove()}})}});c+="</ul></div>";d?a.myTableHolder.find("."+a.commonContentHolderClass).html(c):a.myTableHolder.find("."+a.commonContentHolderClass).remove()},dataDictionaryCollector:function(){Object.keys(a.dataDictionary).forEach(function(b,c){"undefined"===typeof a.dataDictionary[b].Options&&(a.dataDictionary[b].Options=
[]);var d=a.myTable.find(a.sortLinkSelector+'[data-sort-field="'+b+'"]').first();"undefined"===typeof a.dataDictionary[b].CanFilter&&(d&&"true"==d.attr("data-sort-only")?a.dataDictionary[b].CanFilter=!1:a.dataDictionary[b].CanFilter=1<a.dataDictionary[b].Options.length);"undefined"===typeof a.dataDictionary[b].CanSort&&(a.dataDictionary[b].CanSort=0<d.length);"undefined"===typeof a.dataDictionary[b].DataType&&a.dataDictionary[b].CanSort&&(d=d.attr("data-sort-type"),a.dataDictionary[b].DataType=d);
if("undefined"===typeof a.dataDictionary[b].DataType){for(var d="number",e=!1,f=0,m=a.dataDictionary[b].Options.length<a.maxNumberOfValuesToCheck?a.dataDictionary[b].Options.length:500,f=0;f<m;f++)if(e=jQuery.isNumeric(a.dataDictionary[b].Options[f]),!1===e){d="string";break}a.dataDictionary[b].DataType=d}!1===jQuery.inArray(a.dataDictionary[b].DataType,a.validDataTypes)&&console.debug("ERROR: invalid DataType for"+b+": "+a.dataDictionary[b].DataType);switch(a.dataDictionary[b].DataType){case "number":a.dataDictionary[b].Options.sort(function(a,
b){a=parseFloat(a.replace(/[^0-9.]/g,""));b=parseFloat(b.replace(/[^0-9.]/g,""));return a-b});break;default:a.dataDictionary[b].Options.sort()}})},findDefaultSort:function(){var b=a.myTableHead.find("."+a.sortDescClass+", ."+a.sortAscClass).first();b&&0<b.length||(b=a.myTableHead.find(a.sortLinkSelector+"[data-sort-default=true]").first())&&0<b.length||(b=a.myTableHead.find(a.sortLinkSelector).first());b&&0<b.length&&(a.csort.sdir=b.attr("data-sort-direction"),a.csort.scat=b.attr("data-sort-field"))},
fixTableHeaderListener:function(){jQuery(window).on("load scroll",function(b){a.fixTableHeader()},a.millisecondsBetweenActions);jQuery(window).on("resize",function(b){a.myTableHolder.removeClass(a.fixedHeaderClass);a.myTable.find("colgroup").remove();a.myFilterFormHolder.css("width","");a.myTable.find("thead tr:first th").css({width:"","min-width":"","max-width":""});window.clearTimeout(a.setTableWidthInFuture);a.setTableWidthInFuture=window.setTimeout(function(){a.setTableWidth();a.fixTableHeader()},
a.millisecondsBetweenActions)},a.millisecondsBetweenActions)},setupFilterFormListeners:function(){a.myFilterFormInner.hide();a.myFilterFormHolder.on("click","."+a.openAndCloseFilterFormClass,function(b){b.preventDefault();a.myFilterFormInner.slideToggle("fast",function(){a.hasFixedTableHeader&&a.myTableHead.css("top",a.myFilterFormHolder.outerHeight()+"px");a.myTableHolder.toggleClass(a.filterIsOpenClass);a.myTableHolder.hasClass(a.filterIsOpenClass)});return!1});a.myFilterFormHolder.on("click","."+
a.clearFilterClass+" a",function(b){b.preventDefault();a.cfinc={};a.createFilterForm();a.applyFilter();return!1});a.myFilterFormInner.on("change","input",function(b){a.applyFilter()})},setupSortListeners:function(){a.myTableHolder.on("click",a.sortLinkSelector,function(b){b.preventDefault();var c=jQuery(this);a.showFromRow=0;a.startRowManipulation();a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass);window.setTimeout(function(){a.csort.scat=c.attr("data-sort-field");
a.csort.sdir=c.attr("data-sort-direction");var b=c.attr("data-sort-type");"undefined"===typeof b&&(b=a.dataDictionary[a.csort.category].DataType);var e=[];a.myRows.each(function(c,f){var k=jQuery(f).find('[data-filter="'+a.csort.scat+'"]').text();"number"===b&&(k=k.replace(/[^\d.-]/g,""),k=parseFloat(k));e.push([k,c])});a.myTableBody.empty();e.sort(a.sortMultiDimensionalArray);var f=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.csort.scat+'"]');"desc"===a.csort.sdir?(e.reverse(),f.attr("data-sort-direction",
"asc").addClass(a.sortDescClass)):f.attr("data-sort-direction","desc").addClass(a.sortAscClass);e.forEach(function(b){a.myTableBody.append(a.myRows[b[1]])});a.endRowManipulation()},a.millisecondsBetweenActions)})},paginationListeners:function(){a.myTableHolder.on("click",a.paginationSelector+" a",function(b){b.preventDefault();b=jQuery(this).attr("data-page");a.gotoPage(b);return!1})},setupMoreDetailsListener:function(){a.myTableHolder.on("click",a.showMoreDetailsSelector,function(b){b.preventDefault();
b=jQuery(this);b.toggleClass(a.openedClass);b.closest("tr").toggleClass(a.openedClass).find(a.moreDetailsSelector).each(function(b,d){d=jQuery(d);d.slideToggle();d.toggleClass(a.openedClass)})})},addURLChangeListener:function(){window.addEventListener("popstate",function(b){a.retrieveDataFromURL();a.retrieveDataFromServer()})},directFilterLinkListener:function(){a.myTableBody.on("click",a.filterItemSelector+"."+a.directLinkClass,function(b){b.preventDefault();var c=jQuery(this);b=c.attr("data-filter");
var d=c.text().trim(),c=a.myFilterFormInner.find("."+a.filterGroupClass+'[data-to-filter="'+b+'"]'),e=c.attr("field-type"),f=c.find('input[value="'+d+'"].checkbox').first(),m=!0;f&&0<f.length?f.is(":checkbox")&&(!0===f.prop("checked")?(f.prop("checked",!1).trigger("change"),m=!1):f.prop("checked",!0).trigger("change")):"tag"===e&&a.makeCheckboxSection(c.find("input.awesomplete").first(),d);var w=a.directLinkClass+"-on";a.myRows.find('span[data-filter="'+b+'"].'+a.directLinkClass).each(function(a,
b){var c=jQuery(b);c.text().trim()===d&&(m?c.addClass(w):c.removeClass(w))});a.applyFilter();return!1})},favouriteLinkListener:function(){a.hasFavourites=0<a.myTableBody.find(a.favouriteLinkSelector).length;a.hasFavourites&&(a.myTableBody.on("click",a.favouriteLinkSelector,function(b){b.preventDefault();b=jQuery(this).closest("td, th").closest("tr");b.toggleClass(a.favouriteClass);var c=b.attr("id");c&&"undefined"!==typeof c&&""!==c&&(b.hasClass(a.favouriteClass)?a.myfavs.push(c):(b=a.myfavs.indexOf(c),
-1<b&&a.myfavs.splice(b,1)),"undefined"!==typeof Cookies&&Cookies.set("myfavs",a.myfavs,{path:a.baseURL,expires:180}));0<a.myfavs.length?a.myTableHolder.addClass(a.hasFavouritesClass):a.myTableHolder.removeClass(a.hasFavouritesClass);return!1}),a.myTableHolder.on("click",a.showFavouritesSelector,function(b){b.preventDefault();b=a.myFilterFormInner.find('input[name="Favourites"]').first();!0===b.prop("checked")?b.prop("checked",!1).trigger("change"):(a.myFilterFormHolder.find("."+a.clearFilterClass+
" a").click(),b=a.myFilterFormInner.find('input[name="Favourites"]').first(),b.prop("checked",!0).trigger("change"))}))},openServerModalWindowListener:function(){a.myTableHolder.on("click","."+a.saveAndLoadClass+" a",function(b){b.preventDefault();a.myTable.removeClass(a.loadingClass);var c=jQuery(this).closest("."+a.saveAndLoadClass);b=a.serverConnectionURL;var d=!1,e=a.filtersParentPageID,f=a.filterAndSortVariables;!c.hasClass("filters")&&c.hasClass("favourites")&&(e=a.favouritesParentPageID,f=
a.favouritesVariables);c.hasClass("save")?(d=!0,b+="start/"):b+="index/";c={};if(!0===d)for(d=0;d<f.length;d++)c[f[d]]=a[f[d]];c.ParentPageID=e;jQuery.post(b,c,function(b){var d=Math.round(.85*jQuery(window).width()),c=Math.round(.85*jQuery(window).height());jQuery.modal('<iframe src="'+b+'" width="'+d+'"height="'+c+'" style="border:0" id="tfs-pop-up-i-frame" name="tfs-pop-up-i-frame">',{closeHTML:"close",containerCss:{backgroundColor:"#fff",borderColor:"#fff",padding:0,width:d,height:c},opacity:75,
overlayClose:!0,onClose:function(){jQuery.modal.close();a.retrieveDataFromServer()}});return!1}).fail(function(){alert("ERROR!");a.myTable.removeClass(a.loadingClass)});return!1})},createFilterForm:function(){if(0<a.myFilterFormInner.length){a.myFilterFormInner.html("");var b=1,c=[],d='<form class="'+a.filterOptionsHolderClass+'">';Object.keys(a.dataDictionary).forEach(function(e,f){if(a.dataDictionary[e].CanFilter){b++;var k=0,h=a.dataDictionary[e].Options.length;if(1<h&&h<=a.maximumNumberOfFilterOptions){d+=
a.makeSectionHeaderForForm("checkbox",e);for(k=0;k<h;k++)d+=a.makeFieldForForm("checkbox",e,b,a.dataDictionary[e].Options[k]);d+=a.makeSectionFooterForForm()}else h>a.maximumNumberOfFilterOptions&&(k=a.dataDictionary[e].DataType,"string"===a.dataDictionary[e].DataType&&(c.push(e),k="tag"),d+=a.makeSectionHeaderForForm(k,e),d+=a.makeFieldForForm(k,e,b,0),d+=a.makeSectionFooterForForm())}});a.hasFavourites&&(d+=a.makeSectionHeaderForForm("favourites",a.favouritesCategoryTitle),d+=a.makeFieldForForm("favourites",
a.favouritesCategoryTitle,b,0),d+=a.makeSectionFooterForForm(),b++);a.hasKeywords&&(d+=a.makeSectionHeaderForForm("keyword",a.keywordsCategoryTitle),d+=a.makeFieldForForm("keyword",a.keywordsCategoryTitle,b,0),d+=a.makeSectionFooterForForm());d+="</form>";a.myFilterFormInner.html(d);for(var e=0,f,e=0;e<c.length;e++)category=c[e],f=a.myFilterFormInner.find('input[name="'+category+'"].awesomplete').first(),f=jQuery(f).attr("id"),f=document.getElementById(f),new Awesomplete(f,{list:a.dataDictionary[category].Options,
autoFirst:!0,filter:function(a,b){return Awesomplete.FILTER_CONTAINS(a,b)&&-1===Awesomplete.blackList.indexOf(a.value)},replace:function(b){a.makeCheckboxSection(this.input,b.value);this.input.value="";Awesomplete.blackList.push(b.value);a.applyFilter()}}),Awesomplete.blackList=[]}},makeSectionHeaderForForm:function(b,c){var d=b+a.sectionFilterClassAppendix;c.replace(/\W/g,"");return'<div class="'+a.filterGroupClass+" "+d+'" field-type="'+b+'" data-to-filter="'+c.raw2attr()+'"><label class="'+a.groupLabelClass+
'">'+a.replaceAll(c,"-"," ")+"</label><ul>"},makeFieldForForm:function(b,c,d,e){var f=c.replace(/\W/g,""),m=e.toString().toLowerCase(),g=("TFS_"+f+"_"+m).replace(/[^a-zA-Z0-9]+/g,"_");if(0===a.myFilterFormInner.find("input#"+g).length){var k='<li class="'+b+'Field">';switch(b){case "favourites":var h="";"undefined"!==typeof a.cfinc[c]&&(h=' checked="checked"');return k+'<input class="favourites" type="checkbox" name="'+c.raw2attr()+'" id="'+g+'" tabindex="'+d+'" '+h+' /><label for="'+g+'">\u2764 \u2764 \u2764</label></li>';
case "keyword":case "tag":f=m="";if("keyword"===b){if(h="keyword","undefined"!==typeof a.cfinc[c]&&"undefined"!==typeof a.cfinc[c][0])for(b=0;b<a.cfinc[c].length;b++)m=a.cfinc[c][b].vtm,m=m.raw2attr()}else if("tag"===b){if("undefined"!==typeof a.cfinc[c])for(b=0;b<a.cfinc[c].length;b++)e=a.cfinc[c][b].vtm,e=a.makeFieldForForm("checkbox",c,d,e),5<e.length&&(e=e.replace("<input ",'<input checked="checked" ')),f+=e;h="awesomplete"}return k+'<input class="text '+h+'" type="text" name="'+c.raw2attr()+
'" id="'+g+'" tabindex="'+d+'" value="'+m+'" />'+f+"</li>";case "checkbox":h="";if("undefined"!==typeof a.cfinc[c])for(b=0;b<a.cfinc[c].length;b++)if(m.trim()===a.cfinc[c][b].vtm.trim()){h='checked="checked"';break}return k+'<input class="checkbox" type="checkbox" name="'+g+'" id="'+g+'" value="'+e.raw2attr()+'" '+h+' tabindex="'+d+'" /><label for="'+g+'">'+e+"</label></li>";case "number":case "date":return m={gt:"",lt:""},"undefined"!==typeof a.cfinc[c]&&(m=a.cfinc[c][0]),c=k+'<span class="gt"> <label for="'+
g+'_gt">'+a.greaterThanLabel+'</label> <input data-dir="gt" data-label="'+a.greaterThanLabel.raw2attr()+'" class="number" step="any" type="number" name="'+f+'[]" id="'+g+'" tabindex="'+d+'" value="'+m.gt+'" /> </span><span class="lt"> <label for="'+g+'_lt">'+a.lowerThanLabel+'</label> <input data-dir="lt" data-label="'+a.lowerThanLabel.raw2attr()+'"  class="number" step="any" type="number" name="'+f+'[]" id="'+g+'_lt" tabindex="'+d+'" value="'+m.lt+'" /> </span></li>',"date"===b&&(c=a.replaceAll(c,
"number","datetime-local"),c=a.replaceAll(c,"step","86400")),c}}},makeSectionFooterForForm:function(){return"</ul></div>"},makeCheckboxSection:function(b,c){b=jQuery(b);var d=b.attr("name");tabIndex=b.attr("tabindex");d=a.makeFieldForForm("checkbox",d,tabIndex,c);5<d.length&&(d=d.replace("<input ",'<input checked="checked" '),b.closest("ul").append(d))},runCurrentSort:function(){var b=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.csort.scat+'"]').first();b&&0<b.length&&b.click()},applyFilter:function(){a.showFromRow=
0;a.workOutCurrentFilter();a.startRowManipulation();window.setTimeout(function(){a.debug&&(console.debug("=============="),console.debug(a.cfinc));a.myRows.each(function(b,c){var d=jQuery(c);a.debug&&console.log("===");var e=!0,f=!0;Object.keys(a.cfinc).forEach(function(b,c){if(f){for(var g=!1,h=!0,r=0;r<a.cfinc[b].length;r++){var l=a.cfinc[b][r];if(h){if(b===a.favouritesCategoryTitle){var t=d.attr("id");"undefined"!==typeof t&&0<t.length&&-1<a.myfavs.indexOf(t)&&(g=!0)}else if(b===a.keywordsCategoryTitle){for(var q=
l.vtm,t=d.text().toLowerCase(),q=q.split(" "),v=!0,p=0;p<q.length;p++){var n=q[p].trim();if(-1===t.indexOf(n)){v=!1;break}}!0===v&&(g=!0)}else d.find('span[data-filter="'+b+'"]').each(function(d,c){c=jQuery(c);var e=c.text().toLowerCase().trim();switch(a.dataDictionary[b].DataType){case "date":break;case "number":if("undefined"!==typeof l.vtm){var f=l.vtm;e==f&&(g=!0)}else{var e=parseFloat(e.replace(/[^0-9.]/g,"")),h=l.lt,q=!0;jQuery.isNumeric(h)&&0!==h&&h<e&&(q=!1);q&&(h=l.gt,jQuery.isNumeric(h)&&
0!==h&&h>e&&(q=!1));q&&(g=!0);break}default:f=l.vtm,e===f&&(g=!0)}if(g)return a.debug&&console.log("FILTER - MATCH: '"+f+"' in '"+b+"'"),!1;a.debug&&console.log("FILTER - NO MATCH: '"+f+"' in '"+b+"'")});g&&(h=!1)}}g||(f=e=!1)}});e?d.addClass(a.matchClass).removeClass(a.notMatchClass):d.addClass(a.notMatchClass).removeClass(a.matchClass)});a.endRowManipulation();a.debug&&(console.debug(a.cfinc),console.debug("=============="))},a.millisecondsBetweenActions)},gotoPage:function(b){a.showFromRow=b*a.visibleRowCount;
a.startRowManipulation();a.endRowManipulation()},fixTableHeader:function(){if(a.myTableHolder.isOnScreen()||a.myTableHolder.hasClass(a.filterIsOpenClass)){if(a.myTableHolder.addClass(a.filterInUseClass),a.myTableHolder.removeClass(a.filterNotInUseClass),a.hasFixedTableHeader){var b=a.myTableHolder.hasClass(a.filterIsOpenClass)?!1:!0,c=a.myTableHead.outerHeight();b&&(c+=a.myFilterFormHolder.outerHeight());a.myTableHolder.find(".tfspushdowndiv").height(c);c=a.myTableBody.offset().top;!0===(jQuery(window).scrollTop()>
c?!0:!1)?(c=a.myTableHolder.width(),b&&a.myFilterFormHolder.width(c),window.setTimeout(function(){a.myTableHolder.addClass(a.fixedHeaderClass);var d=0;b&&(d=a.myFilterFormHolder.outerHeight());a.myTableHead.css("top",d)},a.millisecondsBetweenActions)):a.myTableHolder.removeClass(a.fixedHeaderClass)}}else a.myTableHolder.addClass(a.filterNotInUseClass),a.myTableHolder.removeClass(a.filterInUseClass)},startRowManipulation:function(){"function"===typeof a.startRowFX1&&a.startRowFX1(a);a.resetObjects();
a.myTable.addClass(a.loadingClass);a.myTable.find(a.moreRowEntriesSelector).hide();a.myTable.hide();a.myRows.each(function(b,c){jQuery(c).addClass(a.hideClass).removeClass(a.showClass)});"function"===typeof a.startRowFX2&&a.startRowFX2(a)},endRowManipulation:function(){"function"===typeof a.endRowFX1&&a.endRowFX1(a);a.resetObjects();var b=a.showFromRow,c=0,d=0,e=0,f=0===a.myTableBody.find("tr."+a.notMatchClass).length?!0:!1,g=!1;a.myRows.each(function(h,q){q=jQuery(q);c++;g=!1;if(f||q.hasClass(a.matchClass))g=
!0,d++;g&&d>b&&e<a.visibleRowCount&&(e++,q.removeClass(a.hideClass).addClass(a.showClass))});0<d?jQuery("."+a.noMatchMessageClass).hide():jQuery("."+a.noMatchMessageClass).show();var p=b+e,k=Math.ceil(d/a.visibleRowCount),h=Math.floor(a.showFromRow/a.visibleRowCount),r="";if(1<k){for(var l=0,t=0,q=h-2,v=h+2,n=[],l=0;l<k;l++)h===l?(t=0,r+="<span>["+(l+1)+"]</span>"):(test1=l>q&&l<v,test2=l>=k-1,test3=1>l,test1||test2||test3?(n=[],t=0,0===l&&n.push("first"),l===k-1&&n.push("last"),l===h-1&&n.push("prev"),
l===h+1&&n.push("next"),r+='<a href="#" class="'+n.join(" ")+'"data-page="'+l+'">'+(l+1)+"</a> "):3>t&&(t++,r+=" . ")),r+=" ";a.myTableHolder.find(a.moreRowEntriesSelector).show()}b++;a.myTableHolder.find(a.minRowSelector).text(b);a.myTableHolder.find(a.maxRowSelector).text(p);a.myTableHolder.find(a.matchRowCountSelector).text(d);a.myTableHolder.find(a.totalRowCountSelector).text(c);a.myTableHolder.find(a.visibleRowCountSelector).text(e);a.myTableHolder.find(a.paginationSelector).html(r);a.myTable.show();
a.myTable.removeClass(a.loadingClass);a.myTableHolder.hasClass(a.filterIsOpenClass)||window.setTimeout(function(){jQuery("html, body").animate({scrollTop:a.myTableHolder.position().top},200)},a.millisecondsBetweenActions);p=a.currentURL();a.useBackAndForwardButtons&&history.pushState(null,null,p);"undefined"!==typeof Cookies&&Cookies.set("lastFilter",p,{path:a.baseURL,expires:180});a.resetObjects();"function"===typeof a.endRowFX2&&a.endRowFX2(a);a.fixTableHeader()},currentURL:function(){for(var b=
{},c=0;c<a.filterAndSortVariables.length;c++){var d=a.filterAndSortVariables[c];0<Object.keys(a[d]).length&&(b[d]=a[d])}b="undefined"!==typeof JSURL?JSURL.stringify(b):"tfs="+encodeURI(JSON.stringify(b));return a.baseURL+"#"+b},workOutCurrentFilter:function(){var b="",c,d="";a.cfinc={};a.myFilterFormHolder.find(" ."+a.filterGroupClass).each(function(e,f){c=jQuery(f);d=c.attr("data-to-filter");var g=c.attr("field-type"),h=[];c.find("input").each(function(b,c){c=jQuery(c);var e=c.val(),f=e.toLowerCase().trim();
switch(g){case "keyword":if(1<f.length)for("undefined"===typeof a.cfinc[d]&&(a.debug&&console.log("adding "+d),a.cfinc[d]=[]),e=f.split(","),f=e.length,b=0;b<f;b++)innerValueToMatch=innerInputVal=e[b].trim(),1<innerValueToMatch.length&&(a.cfinc[d].push({vtm:innerValueToMatch,ival:innerInputVal}),h.push(innerValueToMatch),a.debug&&console.log("... adding '"+innerValueToMatch+"' to '"+d+"'"));break;case "tag":case "checkbox":c.is(":checked")&&("undefined"===typeof a.cfinc[d]&&(a.debug&&console.log("adding "+
d),a.cfinc[d]=[]),h.push(f),a.cfinc[d].push({vtm:f,ival:e}),a.debug&&console.log("... adding '"+d+"' to '"+f+"'"));break;case "favourites":c.is(":checked")?("undefined"===typeof a.cfinc[d]&&(a.debug&&console.log("adding "+d),a.cfinc[d]=[]),a.cfinc[d].push({vtm:f,ival:e}),h.push(f),a.myTableHolder.addClass(a.hasFavouritesInFilterClass),a.debug&&console.log("... adding '"+d+"' to '"+f+"'")):a.myTableHolder.removeClass(a.hasFavouritesInFilterClass);break;case "number":e=parseFloat(c.val());jQuery.isNumeric(e)&&
0!==e&&("undefined"===typeof a.cfinc[d]&&(a.debug&&console.log("adding "+d),a.cfinc[d]=[]),h.push(c.attr("data-label")+e+" "),"undefined"===typeof a.cfinc[d][0]&&(a.cfinc[d][0]={}),a.cfinc[d][0][c.attr("data-dir")]=e);break;case "date":e=c.val().trim(),"0"!==e&&""!==e&&("undefined"===typeof a.cfinc[d]&&(a.debug&&console.log("adding "+d),a.cfinc[d]={}),h.push(c.attr("data-label")+e),a.cfinc[d][0][c.attr("data-dir")]=e)}});if("undefined"!==typeof a.cfinc[d]){var p=c.find("label."+a.groupLabelClass).text();
b+='<li class="category"><strong>'+p+":</strong> <span>"+h.join("</span><span>")+"</span></li>"}});var e=a.myTableHolder.find("."+a.currentSearchFilterClass);if(!0===(0<Object.keys(a.cfinc).length?!0:!1)){var b="<ul>"+b+"</ul>",f=e.attr("data-title");"string"===typeof f&&0<f.length&&(b="<h3>"+f+"</h3>"+b);a.myTableHolder.addClass(a.hasFilterClass).removeClass(a.doesNotHaveFilterClass)}else b=e.attr("data-no-filter-text"),a.myTableHolder.removeClass(a.hasFilterClass).addClass(a.doesNotHaveFilterClass);
e.html(b)},retrieveLocalCookie:function(){"undefined"!==typeof Cookies&&(a.myfavs=Cookies.getJSON("myfavs"),"undefined"===typeof a.myfavs?a.myfavs=[]:a.serverDataToApply.myfavs=!0)},retrieveDataFromURL:function(){if("undefined"!==typeof JSURL&&"undefined"!==typeof location.hash&&location.hash&&0<location.hash.length){var b=window.location.hash.substr(1);data=JSURL.tryParse(b,{});for(var c in data)data.hasOwnProperty(c)&&(a[c]=data[c],a.serverDataToApply[c]=!0)}},retrieveDataFromServer:function(){var b=
{},c=!1;"undefined"!==typeof location.search&&location.search&&0<location.search.length&&(location.search.substr(1).split("&").forEach(function(a){var c=a.split("=");a=c[0];c=c[1]&&decodeURIComponent(c[1]);(b[a]=b[a]||[]).push(c)}),"undefined"!==typeof b.load&&(c=!0,a.myTable.addClass(a.loadingClass),jQuery.getJSON(a.serverConnectionURL+"load/"+b.load+"/",function(b){var c=!1;b=b.Data;b=JSON.parse(b);for(var f in b)b.hasOwnProperty(f)&&(a[f]=b[f],a.serverDataToApply[f]=!0,"myfavs"===f&&(c=!0));a.processRetrievedData(c);
a.myTable.removeClass(a.loadingClass)}).fail(function(){a.processRetrievedData();a.myTable.removeClass(a.loadingClass)})));!1===c&&a.processRetrievedData()},processRetrievedData:function(b){if("undefined"!==typeof a.serverDataToApply.myfavs&&!0===a.serverDataToApply.myfavs){a.myTableBody.find("tr."+a.favouriteClass).removeClass(a.favouriteClass);for(var c in a.myfavs)a.myfavs.hasOwnProperty(c)&&a.myTableBody.find("#"+a.myfavs[c]).addClass(a.favouriteClass);0<a.myfavs.length?a.myTableHolder.addClass(a.hasFavouritesClass):
a.myTableHolder.removeClass(a.hasFavouritesClass);!0===b&&(a.myTableHolder.hasClass(a.hasFavouritesInFilterClass)&&a.myTableHolder.find(a.showFavouritesSelector).click(),a.myTableHolder.find(a.showFavouritesSelector).click());delete a.serverDataToApply.myfavs}"undefined"!==typeof a.serverDataToApply.cfinc&&!0===a.serverDataToApply.cfinc&&(a.createFilterForm(),a.applyFilter(),delete a.serverDataToApply.cfinc);"undefined"!==typeof a.serverDataToApply.csort&&!0===a.serverDataToApply.csort&&(b=a.csort.scat,
c=a.csort.sdir,a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass),a.myTableHead.find(a.sortLinkSelector+"[data-sort-field='"+b+"']").attr("data-sort-direction",c).click(),delete a.serverDataToApply.csort)},replaceAll:function(a,c,d){a.split(c).join(d);return a},objectSize:function(a){var c=0,d;if("undefined"===typeof a)return 0;for(d in a)a.hasOwnProperty(d)&&c++;return c},objectSort:function(a){var c=[],d;for(d in a)a.hasOwnProperty(d)&&c.push([d,a[d]]);
c.sort(function(a,b){a=a[1];b=b[1];return a<b?-1:a>b?1:0});a={};for(d=d=0;d<c.length;d++)"string"===typeof c[d][1]&&(a[c[d][0]]=c[d][1]);return a},makeID:function(){for(var a="",c=0;9>c;c++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random()));return a},sortMultiDimensionalArray:function(a,c){var d=a[0];"string"===typeof d&&(d=d.toLowerCase());var e=c[0];"string"===typeof e&&(e=e.toLowerCase());return d===e?0:d<e?-1:1}},a=jQuery.extend(a,g);this.each(function(b,
c){a.init(n);n++});return{getVar:function(b){if(a.hasOwnProperty(b))return a[b]},setVar:function(b,c){a[b]=c;return this},gotoPage:function(b){a.gotoPage(b);return this}}}})(jQuery);String.prototype.raw2attr=function(){return(""+this).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"&#13;").replace(/[\r\n]/g,"&#13;")};
String.prototype.attr2raw=function(){var g;g=(""+this).replace(/\r\n/g,"\n").replace(/[\r\n]/,"\n").replace(/&#13;&#10;/g,"\n").replace(/&#1[03];/g,"\n").replace(/&#9;/g,"\t").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'");var u=/&[^;]*;?/.match(g);if(0<u.length&&"&amp;"!==u[0])throw"unsafe entity found in the attribute literal content";return g=g.replace(/&amp;/g,"&")};
jQuery.fn.isOnScreen=function(){var g,u;g=jQuery(window).scrollTop();u=g+jQuery(window).height();var n,p;n=this.offset().top;p=n+this.outerHeight();return n<=u&&p>=g};(function(g){var u=g.fn.on,n;g.fn.on=function(){var g=Array.apply(null,arguments),a=g[g.length-1];if(isNaN(a)||1===a&&g.pop())return u.apply(this,g);var b=g.pop(),c=g.pop();g.push(function(){var a=this,e=arguments;clearTimeout(n);n=setTimeout(function(){c.apply(a,e)},b)});return u.apply(this,g)}})(jQuery);
