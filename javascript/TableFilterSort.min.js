<<<<<<< HEAD
jQuery(document).ready(function(){if(typeof TableFilterSortTableList!=="undefined"){var a=0;for(a=0;a<TableFilterSortTableList.length;a++){TableFilterSortTableList[a]=jQuery(TableFilterSortTableList[a]).tableFilterSort()}}});(function(a){a.fn.tableFilterSort=function(c){var e=0;var b=this;var d={debug:false,baseURL:"",favouritesURL:"/tfs/favourites/",filtersURL:"/tfs/filters/",filtersParentPageID:"",favouritesParentPageID:"",useBackAndForwardButtons:false,holderNumber:0,myTableHolder:b,myFilterFormHolder:null,myTable:null,myTableHead:null,myTableBody:null,myRows:null,dataDictionary:[],currentFilter:{},currentSorter:{},showFromRow:0,visibleRowCount:50,totalRowCount:0,maximumNumberOfFilterOptions:3,intervalForFilterCheck:1000,hasFixedTableHeader:true,hasKeywords:true,hasFavourites:false,hasFilterSaving:false,millisecondsBetweenActions:10,validDataTypes:["number","string","date"],maxNumberOfValuesToCheck:500,favouritesStore:[],startRowFX1:null,startRowFX2:null,endRowFX1:null,endRowFX2:null,filterTitle:"Filter Table",noFilterSelectedText:"No filter selected",closeAndApplyFilterText:"Close and Apply Filter",currentFilterText:"Current Filter",greaterThanLabel:"&gt; ",lowerThanLabel:"&lt; ",keywordsCategoryTitle:"Keywords",favouritesCategoryTitle:"Favourites",filtersTitle:"Filter",tableSelector:"table.tableFilterSortTable",rowSelector:"tr.tfsRow",filterItemSelector:"span[data-filter]",showMoreDetailsSelector:".more",moreDetailsSelector:".hidden",filterFormHolderSelector:".tableFilterSortFilterFormHolder",sortLinkSelector:"a.sortable",favouriteLinkSelector:"a.addFav",moreRowEntriesSelector:".tableFilterSortMoreEntries",matchRowCountSelector:".match-row-number",minRowSelector:".min-row-number",maxRowSelector:".max-row-number",totalRowCountSelector:".total-row-number",visibleRowCountSelector:".total-showing-row-number",paginationSelector:".pagination",saveAndLoadSelector:".saveAndLoad",loadingClass:"loading",showClass:"show",hideClass:"hide",matchClass:"match",notMatchClass:"no-match",openedClass:"opened",filterIsOpenClass:"filterIsOpen",sectionFilterClassAppendix:"Filter",commonContentHolderClass:"tableFilterSortCommonContentHolder",currentSearchFilterClass:"tableFilterSortCurrentSearchHolder",openAndCloseFilterFormClass:"tableFilterSortOpenFilterForm",filterOptionsHolderClass:"tableFilterSortFilterFormOptions",filterGroupClass:"filterColumn",groupLabelClass:"groupLabel",applyFilterClass:"applyFilter",filterInUseClass:"tableFilterSortFilterInUse",filterNotInUseClass:"tableFilterSortFilterNotInUse",noMatchMessageClass:"no-matches-message",sortAscClass:"sort-asc",sortDescClass:"sort-desc",directLinkClass:"dl",favouriteClass:"fav",init:function(f){d.holderNumber=f;d.myTableHolder=b;d.myFilterFormHolder=d.myTableHolder.find(d.filterFormHolderSelector).first();d.myTable=d.myTableHolder.find(d.tableSelector).first();d.myTableHead=d.myTableHolder.find("table thead");d.myTableBody=d.myTable.find(" > tbody");d.favouritesParentPageID=d.myFilterFormHolder.attr("data-favourites-page-id");if(typeof d.favouritesParentPageID==="string"&&d.favouritesParentPageID.length>0){d.hasFavourites=true}d.filtersParentPageID=d.myFilterFormHolder.attr("data-filter-page-id");if(typeof d.filtersParentPageID==="string"&&d.filtersParentPageID.length>0){d.hasFilterSaving=true}d.baseURL=location.protocol+"//"+location.host+location.pathname;d.resetObjects();if(d.myRows.length>1){d.myTableHolder.addClass(d.loadingClass);window.setTimeout(function(){if(d.debug){console.profileEnd();console.profile("filterItemCollector")}d.filterItemCollector();if(d.debug){console.profileEnd();console.profile("tableHideColsWhichAreAllTheSame")}d.tableHideColsWhichAreAllTheSame();if(d.debug){console.profileEnd();console.profile("dataDictionaryCollector")}d.dataDictionaryCollector();if(d.debug){console.profileEnd();console.profile("setupFilterFormListeners")}d.setupFilterFormListeners();if(d.debug){console.profileEnd();console.profile("setupSortListeners")}d.setupSortListeners();if(d.debug){console.profileEnd();console.profile("paginationListeners")}d.paginationListeners();if(d.debug){console.profile("setupMoreDetailsListener")}d.setupMoreDetailsListener();if(d.debug){console.profile("addURLChangeListener")}d.addURLChangeListener();if(d.debug){console.profileEnd();console.profile("retrieveServerDataListener")}d.retrieveServerDataListener();if(d.debug){console.profileEnd();console.profile("favouriteLinkListener")}d.favouriteLinkListener();if(d.debug){console.profileEnd();console.profile("directFilterLinkListener")}d.directFilterLinkListener();if(d.debug){console.profileEnd();console.profile("createFilterForm")}d.createFilterForm();if(d.debug){console.profileEnd()}d.myTableHolder.removeClass(d.loadingClass);if(d.debug){console.profile("runCurrentSort")}d.runCurrentSort();if(d.debug){console.profileEnd();console.profile("retrieveCookieData")}d.retrieveCookieData();if(d.debug){console.profileEnd();console.profile("fixTableHeader")}d.fixTableHeader();if(d.debug){console.profileEnd()}},d.millisecondsBetweenActions)}},resetObjects:function(){d.myRows=d.myTable.find(d.rowSelector)},filterItemCollector:function(){var g="";var f="";d.myRows.each(function(h,j){jQuery(j).find(d.filterItemSelector).each(function(i,k){k=jQuery(k);g=k.text();f=k.attr("data-filter");if(g.trim().length>0){if(d.debug){console.debug("adding "+g+" to "+f)}if(typeof d.dataDictionary[f]==="undefined"){d.dataDictionary[f]={}}if(typeof d.dataDictionary[f]["Options"]==="undefined"){d.dataDictionary[f]["Options"]=[]}if(d.dataDictionary[f]["Options"].indexOf(g)===-1){d.dataDictionary[f]["Options"].push(g)}}})})},tableHideColsWhichAreAllTheSame:function(){var g=d.myTableHolder.find("."+d.commonContentHolderClass).attr("data-title");if(typeof g!=="undefined"){g="<h3>"+g+"</h3>"}else{g=""}var h='<div class="'+d.commonContentHolderClass+'-inner">'+g+"<ul>";var f=false;Object.keys(d.dataDictionary).forEach(function(j,k){if(d.dataDictionary[j]["Options"].length===1){delete d.dataDictionary[j];if(d.debug){console.debug("tableHideColsWhichAreAllTheSame: checking category: "+j)}f=true;var i=false;jQuery('span[data-filter="'+j+'"]').each(function(m,n){n=jQuery(n);if(!i){if(n.html()!==""){h+="<li><strong>"+j+":</strong> <span>"+n.html()+"</span></li>";i=true}}var o=n.parent();n.remove();if(o.is("li")){o.hide()}else{if(o.is("td")){if(o.children().length===0){if(m===0){var l=o.parent("tr").children("td").index(o);d.myTable.find("th").eq(l).remove()}o.remove()}}}})}});h+="</ul></div>";if(f){d.myTableHolder.find("."+d.commonContentHolderClass).html(h)}else{d.myTableHolder.find("."+d.commonContentHolderClass).remove()}},dataDictionaryCollector:function(){Object.keys(d.dataDictionary).forEach(function(j,k){if(typeof d.dataDictionary[j]["Options"]==="undefined"){d.dataDictionary[j]["Options"]=[]}var n=d.myTable.find(d.sortLinkSelector+'[data-sort-field="'+j+'"]').first();if(typeof d.dataDictionary[j]["CanFilter"]==="undefined"){if(n&&n.attr("data-sort-only")=="true"){d.dataDictionary[j]["CanFilter"]=false}else{d.dataDictionary[j]["CanFilter"]=d.dataDictionary[j]["Options"].length>1}}if(typeof d.dataDictionary[j]["CanSort"]==="undefined"){d.dataDictionary[j]["CanSort"]=n.length>0}if(typeof d.dataDictionary[j]["DataType"]==="undefined"){if(d.dataDictionary[j]["CanSort"]){var l=n.attr("data-sort-type");d.dataDictionary[j]["DataType"]=l}}if(typeof d.dataDictionary[j]["DataType"]==="undefined"){var h="number";var m=false;var g=0;var f=d.dataDictionary[j]["Options"].length<d.maxNumberOfValuesToCheck?d.dataDictionary[j]["Options"].length:500;for(g=0;g<f;g++){m=jQuery.isNumeric(d.dataDictionary[j]["Options"][g]);if(m===false){h="string";break}}d.dataDictionary[j]["DataType"]=h}if(jQuery.inArray(d.dataDictionary[j]["DataType"],d.validDataTypes)===false){console.debug("ERROR: invalid DataType for"+j+": "+d.dataDictionary[j]["DataType"])}switch(d.dataDictionary[j]["DataType"]){case"number":d.dataDictionary[j]["Options"].sort(function(o,i){o=parseFloat(o.replace(/[^0-9.]/g,""));i=parseFloat(i.replace(/[^0-9.]/g,""));return o-i});break;case"string":default:d.dataDictionary[j]["Options"].sort()}})},setupFilterFormListeners:function(){d.myFilterFormHolder.on("click","."+d.openAndCloseFilterFormClass,function(f){f.preventDefault();d.myFilterFormHolder.find("."+d.filterOptionsHolderClass).toggleClass(d.openedClass).slideToggle("fast");d.myTableHolder.toggleClass(d.filterIsOpenClass);if(d.myTableHolder.hasClass(d.filterIsOpenClass)){}else{d.applyFilter()}return false});d.myFilterFormHolder.on("change","input",function(f){d.applyFilter()})},setupSortListeners:function(){d.myTableHolder.on("click",d.sortLinkSelector,function(f){f.preventDefault();var g=jQuery(this);d.showFromRow=0;d.startRowManipulation();d.myTableHead.find(d.sortLinkSelector).removeClass(d.sortAscClass).removeClass(d.sortDescClass);window.setTimeout(function(){d.currentSorter.category=g.attr("data-sort-field");d.currentSorter.direction=g.attr("data-sort-direction");d.currentSorter.sortType=g.attr("data-sort-type");if(typeof d.currentSorter.sortType==="undefined"){d.currentSorter.sortType=d.dataDictionary[d.currentSorter.category]["DataType"]}var h=[];d.myRows.each(function(k,l){var n=jQuery(l);var m=n.find('[data-filter="'+d.currentSorter.category+'"]').text();if(d.currentSorter.sortType==="number"){m=m.replace(/[^\d.-]/g,"");m=parseFloat(m)}else{}var j=new Array(m,k);h.push(j)});d.myTableBody.empty();h.sort(d.sortMultiDimensionalArray);var i=d.myTableHead.find(d.sortLinkSelector+'[data-sort-field="'+d.currentSorter.category+'"]');if(d.currentSorter.direction==="desc"){h.reverse();i.attr("data-sort-direction","asc").addClass(d.sortDescClass)}else{i.attr("data-sort-direction","desc").addClass(d.sortAscClass)}h.forEach(function(j){d.myTableBody.append(d.myRows[j[1]])});d.endRowManipulation()},d.millisecondsBetweenActions)})},paginationListeners:function(){d.myTableHolder.on("click",d.paginationSelector+" a",function(g){g.preventDefault();var f=jQuery(this).attr("data-page");d.gotoPage(f);return false})},setupMoreDetailsListener:function(){d.myTableHolder.on("click",d.showMoreDetailsSelector,function(f){f.preventDefault();var h=jQuery(this);var g=h.closest("tr");g.toggleClass(d.openedClass).find(d.moreDetailsSelector).each(function(k,j){j=jQuery(j);j.slideToggle();j.toggleClass(d.openedClass)});h.toggleClass(d.openedClass)})},addURLChangeListener:function(){if(d.useBackAndForwardButtons){window.addEventListener("popstate",function(f){d.findAndApplyGetVariables()})}},directFilterLinkListener:function(){d.myTableBody.on("click","span[data-filter]."+d.directLinkClass,function(i){i.preventDefault();var l=jQuery(this);var h=l.attr("data-filter");var k=l.text().trim();var j=d.myFilterFormHolder.find("."+d.filterGroupClass+'[data-to-filter="'+h+'"]');var g=j.attr("field-type");var f=j.find('input[value="'+k+'"].checkbox').first();if(f&&f.length>0){if(f.is(":checkbox")){if(f.prop("checked")===true){f.prop("checked",false).trigger("change")}else{f.prop("checked",true).trigger("change")}}}else{if(g==="tag"){d.makeCheckboxSection(j.find("input.awesomplete").first(),k)}}d.applyFilter();return false})},favouriteLinkListener:function(){if(d.myTableBody.find(d.favouriteLinkSelector).length>0){d.myTableHolder.on("click",d.favouriteLinkSelector,function(g){g.preventDefault();var i=jQuery(this).closest("tr");i.toggleClass(d.favouriteClass);var h=i.attr("id");if(h&&typeof h!=="undefined"&&h!==""){if(i.hasClass(d.favouriteClass)){d.favouritesStore.push(h)}else{var f=d.favouritesStore.indexOf(h);if(f>-1){d.favouritesStore.splice(f,1)}}Cookies.set("favouritesStore",d.favouritesStore,{path:d.baseURL,expires:180})}return false})}},retrieveServerDataListener:function(){d.myTableHolder.on("click",d.saveAndLoadSelector+" a",function(h){h.preventDefault();var l=jQuery(this);var f=l.attr("href");var k=false;var j=false;var g=d.favouritesParentPageID;var i={};if(l.hasClass("save")){j=true}if(l.hasClass("filters")){k=true;var g=d.filtersParentPageID}if(j){if(k){i={f:d.currentFilter,s:d.currentSorter}}else{i={f:d.favouritesStore}}}g=g.split("/").join("--");dataAsString=JSON.stringify(i);fullURL=f+encodeURI(g)+"/?data="+encodeURI(dataAsString);jQuery.modal('<iframe src="'+fullURL+'" height="450" width="830" style="border:0">',{closeHTML:"",containerCss:{backgroundColor:"#fff",borderColor:"#fff",height:450,padding:0,width:830},overlayClose:true});l.modal();return false})},createFilterForm:function(){if(d.myFilterFormHolder.length>0){var g=d.myFilterFormHolder.attr("data-title");if(typeof g==="undefined"){g=d.filterTitle}if(d.myTableHolder.find("."+d.currentSearchFilterClass).length===0){var n='<div class="'+d.currentSearchFilterClass+'"></div>'}var h=1;var p=[];var k="<form>"+n+'<a href="#" class="'+d.openAndCloseFilterFormClass+' button closed">'+g+'</a><div style="display: none;" class="'+d.filterOptionsHolderClass+'">';if(d.hasKeywords){k+=d.makeSectionHeaderForForm("keyword",d.keywordsCategoryTitle);k+=d.makeFieldForForm("keyword",d.keywordsCategoryTitle,h,0);k+=d.makeSectionFooterForForm()}Object.keys(d.dataDictionary).forEach(function(t,u){if(d.dataDictionary[t]["CanFilter"]){h++;var r="";var i=[];var s=0;var w=d.dataDictionary[t]["Options"].length;if(w>1&&w<=d.maximumNumberOfFilterOptions){k+=d.makeSectionHeaderForForm("checkbox",t);s=0;for(s=0;s<w;s++){var v=d.dataDictionary[t]["Options"][s];k+=d.makeFieldForForm("checkbox",t,h,v)}k+=d.makeSectionFooterForForm()}else{if(w>d.maximumNumberOfFilterOptions){var q=d.dataDictionary[t]["DataType"];if(d.dataDictionary[t]["DataType"]==="string"){p.push(t);q="tag"}k+=d.makeSectionHeaderForForm(q,t);k+=d.makeFieldForForm(q,t,h,0);k+=d.makeSectionFooterForForm()}}}});if(d.hasFavourites){k+=d.makeSectionHeaderForForm("favourites",d.favouritesCategoryTitle);k+=d.makeFieldForForm("favourites",d.favouritesCategoryTitle,h,0);k+=d.makeSectionFooterForForm();h++}var m=d.myFilterFormHolder.attr("data-title-close-and-apply");if(typeof m==="undefined"){m=d.closeAndApplyFilterText}k+='<div class="'+d.applyFilterClass+'"><a href="#" class="'+d.openAndCloseFilterFormClass+' button closed">'+m+"</a></div></div></form>";d.myFilterFormHolder.html(k);var j=0;var o;for(j=0;j<p.length;j++){category=p[j];var l=d.myFilterFormHolder.find('input[name="'+category+'"].awesomplete').first();var f=jQuery(l).attr("id");var o=document.getElementById(f);new Awesomplete(o,{list:d.dataDictionary[category]["Options"],autoFirst:true,replace:function(q){d.makeCheckboxSection(this.input,q.value);this.input.value="";var i=this._list.indexOf(q.value);if(i>-1){this._list.splice(i,1)}d.applyFilter()}})}}},makeSectionHeaderForForm:function(g,i){var f=g+d.sectionFilterClassAppendix;var h=i.replace(/\W/g,"");return'<div class="'+d.filterGroupClass+" "+f+'" field-type="'+g+'" data-to-filter="'+i.raw2attr()+'"><label class="'+d.groupLabelClass+'">'+d.replaceAll(i,"-"," ")+"</label><ul>"},makeFieldForForm:function(k,f,g,l){var i=f.replace(/\W/g,"");var h=l.toString();var j=("TFS_"+i+"_"+h).replace(/[^a-zA-Z0-9]+/g,"_");if(d.myFilterFormHolder.find("input#"+j).length===0){var m='<li class="'+k+'Field">';var p="</li>";switch(k){case"favourites":return m+'<input class="favourites" type="checkbox" name="'+f.raw2attr()+'" id="'+j+'" tabindex="'+g+'" /><label for="'+j+'">♥ ♥ ♥</label>'+p;break;case"keyword":case"tag":var r="";if(typeof d.currentFilter[f]!=="undefined"){if(typeof d.currentFilter[f][0]!=="undefined"){r=d.currentFilter[f][0];r=r.raw2attr()}}if(k==="keyword"){extraClass="keyword"}else{if(k==="tag"){extraClass="awesomplete"}}return m+'<input class="text '+extraClass+'" type="text" name="'+f.raw2attr()+'" id="'+j+'" tabindex="'+g+'" />'+p;case"checkbox":var o="";if(typeof d.currentFilter[f]!=="undefined"){var n=jQuery.inArray(l,d.currentFilter[f]);if(n>-1){o='checked="checked"'}}return m+'<input class="checkbox" type="checkbox" name="'+j+'" id="'+j+'" value="'+l.raw2attr()+'" '+o+' " tabindex="'+g+'" /><label for="'+j+'">'+l+"</label>"+p;case"number":case"date":var r=["",""];if(typeof d.currentFilter[f]!=="undefined"){r=d.currentFilter[f]}var q=m+'<span class="gt"> <label for="'+j+'_gt">'+d.greaterThanLabel+'</label> <input data-dir="gt" data-label="'+d.greaterThanLabel.raw2attr()+'" class="number" step="any" type="number" name="'+i+'[]" id="'+j+'" tabindex="'+g+'" value="'+r[0].raw2attr()+'" /> </span><span class="lt"> <label for="'+j+'_lt">'+d.lowerThanLabel+'</label> <input data-dir="lt" data-label="'+d.lowerThanLabel.raw2attr()+'"  class="number" step="any" type="number" name="'+i+'[]" id="'+j+'_lt" tabindex="'+g+'" value="'+r[1].raw2attr()+'" /> </span>'+p;if(k==="date"){q=d.replaceAll(q,"number","datetime-local");q=d.replaceAll(q,"step","86400")}return q}}},makeSectionFooterForForm:function(){return"</ul></div>"},makeCheckboxSection:function(f,i){f=jQuery(f);var h=f.attr("name");tabIndex=f.attr("tabindex");var g=d.makeFieldForForm("checkbox",h,tabIndex,i);if(g.length>5){g=g.replace("<input ",'<input checked="checked" ');f.closest("ul").append(g)}},runCurrentSort:function(){var f="."+d.sortDescClass+", ."+d.sortAscClass;var g=d.myTableHolder.find(f).first();if(g&&g.length>0){}else{g=d.myTableHolder.find(d.sortLinkSelector+"[data-sort-default=true]").first()}if(g&&g.length>0){}else{g=d.myTableHolder.find(d.sortLinkSelector).first()}if(g&&g.length>0){g.click()}},applyFilter:function(){d.showFromRow=0;d.workOutCurrentFilter();d.startRowManipulation();window.setTimeout(function(){if(d.debug){console.debug("==============");console.debug(d.currentFilter)}d.myRows.each(function(g,h){var k=jQuery(h);if(d.debug){console.log("===")}var j=true;var f=true;Object.keys(d.currentFilter).forEach(function(n,m){if(f){var l=false;var o=true;for(var p=0;p<d.currentFilter[n].length;p++){var u=d.currentFilter[n][p];if(o){if(n===d.favouritesCategoryTitle){var v=k.attr("id");if(typeof v!=="undefined"&&v.length>0){if(d.favouritesStore.indexOf(v)>-1){l=true}}}else{if(n===d.keywordsCategoryTitle){var w=u.valueToMatch;var x=k.text().toLowerCase();var s=w.split(" ");var r=true;for(var q=0;q<s.length;q++){var t=s[q].trim();if(x.indexOf(t)===-1){r=false;break}}if(r===true){l=true}}else{k.find('span[data-filter="'+n+'"]').each(function(D,C){C=jQuery(C);var B=C.text().toLowerCase().trim();switch(d.dataDictionary[n]["DataType"]){case"date":break;case"number":if(typeof u.valueToMatch!=="undefined"){var A=u.valueToMatch;if(B==A){l=true}}else{B=parseFloat(B.replace(/[^0-9.]/g,""));var i=u.lt;var z=true;if(jQuery.isNumeric(i)&&i!==0){if(i<B){z=false}}if(z){var y=u.gt;if(jQuery.isNumeric(y)&&y!==0){if(y>B){z=false}}}if(z){l=true}break}case"string":default:var A=u.valueToMatch;if(B===A){l=true}}if(l){if(d.debug){console.log("FILTER - MATCH: '"+A+"' in '"+n+"'")}return false}else{if(d.debug){console.log("FILTER - NO MATCH: '"+A+"' in '"+n+"'")}}})}}if(l){o=false}}}if(!l){j=false;f=false}}});if(j){k.addClass(d.matchClass).removeClass(d.notMatchClass)}else{k.addClass(d.notMatchClass).removeClass(d.matchClass)}});d.endRowManipulation();if(d.debug){console.debug(d.currentFilter);console.debug("==============")}},d.millisecondsBetweenActions)},gotoPage:function(f){d.showFromRow=f*d.visibleRowCount;d.startRowManipulation();d.endRowManipulation()},fixTableHeader:function(){var f=this;var g=false;if(f.hasFixedTableHeader){jQuery(window).bind("load resize scroll",function(i){if(f.myTableHolder.isOnScreen()||f.myTableHolder.hasClass(f.filterIsOpenClass)){f.myTableHolder.addClass(f.filterInUseClass);f.myTableHolder.removeClass(f.filterNotInUseClass)}else{f.myTableHolder.addClass(f.filterNotInUseClass);f.myTableHolder.removeClass(f.filterInUseClass)}if(i.type==="resize"){g=false}var h=f.myTableBody.offset().top;var j=jQuery(this).scrollTop();if(j>h){f.myTableHolder.addClass("fixed-header");f.myTableHead.css("top",f.myFilterFormHolder.outerHeight())}else{if(j<=h){f.myTableHolder.removeClass("fixed-header");if(!g){g=true;f.myFilterFormHolder.width(f.myTableHolder.width());f.myTable.width(f.myTableHolder.width());f.myTable.find("thead tr:first th, thead tr:first td").each(function(l,k){var k=jQuery(k);k.width(k.width())})}}}})}},startRowManipulation:function(){if(typeof d.startRowFX1==="function"){d.startRowFX1(d)}d.resetObjects();d.myTable.addClass(d.loadingClass).find(d.moreRowEntriesSelector).hide();d.myTable.hide();d.myRows.each(function(f,g){jQuery(g).addClass(d.hideClass).removeClass(d.showClass)});if(typeof d.startRowFX2==="function"){d.startRowFX2(d)}},endRowManipulation:function(){if(typeof d.endRowFX1==="function"){d.endRowFX1(d)}d.resetObjects();var p=d.showFromRow;var j=0;var t=0;var g=0;var u=d.myTableBody.find("tr."+d.notMatchClass).length===0?true:false;var m=false;d.myRows.each(function(w,x){x=jQuery(x);j++;m=false;if(u||x.hasClass(d.matchClass)){m=true;t++}if(m){if(t>p&&g<d.visibleRowCount){g++;x.removeClass(d.hideClass).addClass(d.showClass)}}});if(t>0){jQuery("."+d.noMatchMessageClass).hide()}else{jQuery("."+d.noMatchMessageClass).show()}var s=p+g;var h=Math.ceil(t/d.visibleRowCount);var n=Math.floor(d.showFromRow/d.visibleRowCount);var r="";if(h>1){var l=0;var f=0;var o=n-2;var k=n+2;for(l=0;l<h;l++){if(n===l){f=0;r+="<span>["+(l+1)+"]</span>"}else{test1=(l>o&&l<k);test2=(l>=(h-3));test3=(l<(0+3));if(test1||test2||test3){f=0;r+='<a href="#" data-page="'+l+'">'+(l+1)+"</a> "}else{if(f<3){f++;r+=" . "}}}r+=" "}d.myTableHolder.find(d.moreRowEntriesSelector).show()}else{d.myTableHolder.find(d.moreRowEntriesSelector).not(".alwaysShow").hide()}p++;d.myTableHolder.find(d.matchRowCountSelector).text(t);d.myTableHolder.find(d.minRowSelector).text(p);d.myTableHolder.find(d.maxRowSelector).text(s);d.myTableHolder.find(d.totalRowCountSelector).text(j);d.myTableHolder.find(d.visibleRowCountSelector).text(g);d.myTableHolder.find(d.paginationSelector).html(r);d.myTable.show();var q=[];if(d.hasFavourites){q.push(d.makeRetrieveButtons(d.favouritesStore.length>0,"favourites"))}if(d.hasFilterSaving){q.push(d.makeRetrieveButtons(d.currentFilter.length>0,"filters"))}if(q.length>0){var v="<ul>"+q.join("</li><li>")+"</ul>";d.myTableHolder.find(d.saveAndLoadSelector).html(v)}d.myTable.removeClass(d.loadingClass);if(!d.myTableHolder.hasClass(d.filterIsOpenClass)){window.setTimeout(function(){jQuery("html, body").animate({scrollTop:d.myTableHolder.position().top},200)},100)}if(d.useBackAndForwardButtons){history.pushState(null,null,d.currentURL())}d.resetObjects();if(typeof d.endRowFX2==="function"){d.endRowFX2(d)}},currentURL:function(){var g={};g.f=d.currentFilter;g.s=d.currentSorter;var f="tfs="+encodeURI(JSON.stringify(g));return d.baseURL+"?"+f},makeRetrieveButtons:function(f,h){var i=[];switch(h){case"favourites":var g=d.favouritesURL;var j=d.favouritesCategoryTitle;break;case"filters":var g=d.filtersURL;var j=d.filtersTitle;break}if(f){i.push('<a href="'+g+'save/" class="save '+h+'">Save '+j+"</a>")}i.push('<a href="'+g+'index/" class="load '+h+'">Load '+j+"</a>");return buttonHTML="<li>"+i.join(" | ")+"</li>"},workOutCurrentFilter:function(){var h="";var n;var g="";var i="";var f="";var j="";var m=[];d.currentFilter={};d.myFilterFormHolder.find(" ."+d.filterGroupClass).each(function(q,s){n=jQuery(s);g=n.attr("data-to-filter");var o=n.attr("field-type");if(o==="keyword"){var p="keyword"}else{if(o==="favourites"){var p="favourites"}else{var p=d.dataDictionary[g]["DataType"]}}var t=[];n.find("input").each(function(z,w){w=jQuery(w);var y=w.val();var x=y.toLowerCase().trim();switch(o){case"keyword":if(x.length>1){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}if(i==="keyword"){d.currentFilter[g].push({valueToMatch:x,inputVal:y});t.push(x)}else{var A=x.split(",");var z=0;var u=A.length;var v="";for(z=0;z<u;z++){innerInputVal=A[z].trim();innerValueToMatch=innerInputVal;if(innerValueToMatch.length>1){d.currentFilter[g].push({valueToMatch:innerValueToMatch,inputVal:innerInputVal});t.push(innerValueToMatch);if(d.debug){console.log("... adding '"+innerValueToMatch+"' to '"+g+"'")}}}}}break;case"tag":case"checkbox":if(w.is(":checked")){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}t.push(x);d.currentFilter[g].push({valueToMatch:x,inputVal:y});if(d.debug){console.log("... adding '"+g+"' to '"+x+"'")}}break;case"favourites":if(w.is(":checked")){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}d.currentFilter[g].push({valueToMatch:x,inputVal:y});t.push(x);if(d.debug){console.log("... adding '"+g+"' to '"+x+"'")}}break;case"number":var B=parseFloat(w.val());if(jQuery.isNumeric(B)&&B!==0){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]=[]}t.push(w.attr("data-label")+B+" ");if(typeof d.currentFilter[g][0]==="undefined"){d.currentFilter[g][0]={}}d.currentFilter[g][0][w.attr("data-dir")]=B}break;case"date":var B=w.val().trim();if(B!=="0"&&B!==""){if(typeof d.currentFilter[g]==="undefined"){if(d.debug){console.log("adding "+g)}d.currentFilter[g]={}}t.push(w.attr("data-label")+B);d.currentFilter[g][0][w.attr("data-dir")]=B}break}});if(typeof d.currentFilter[g]!=="undefined"){var r=n.find("label."+d.groupLabelClass).text();h+="<li><strong>"+r+":</strong> <span>"+t.join("</span><span>")+"</span></li>"}});if(h.length===0){h=d.noFilterSelectedText}var l=d.myTableHolder.find("."+d.currentSearchFilterClass);var k=l.attr("data-title");if(typeof k==="undefined"){k=d.currentFilterText}h="<div><h3>"+k+"</h3><ul>"+h+"</ul></div>";l.html(h);if(d.myTableHolder.hasClass(d.filterIsOpenClass)){l.hide()}else{l.show()}},retrieveCookieData:function(){d.myTableBody.find("tr."+d.favouriteClass).each(function(h,j){jQuery(j).removeClass(d.favouriteClass)});d.favouritesStore=Cookies.getJSON("favouritesStore");if(typeof d.favouritesStore==="undefined"){d.favouritesStore=[]}else{for(var f in d.favouritesStore){if(d.favouritesStore.hasOwnProperty(f)){var g=d.favouritesStore[f];d.myTableBody.find("#"+g).toggleClass(d.favouriteClass)}}}},findAndApplyGetVariables:function(){var g={};location.search.substr(1).split("&").forEach(function(l){var j=l.split("="),i=j[0],h=j[1]&&decodeURIComponent(j[1]);(g[i]=g[i]||[]).push(h)});if(typeof g.tfs!=="undefined"){var f=JSON.parse(g.tfs);d.currentFilter=f.f;d.currentSorter=f.s}},replaceAll:function(f,g,h){f.split(g).join(h);return f},objectSize:function(f){var h=0;var g;if(typeof f==="undefined"){return 0}for(g in f){if(f.hasOwnProperty(g)){h++}}return h},objectSort:function(h){var g=[];for(var f in h){if(h.hasOwnProperty(f)){g.push([f,h[f]])}}g.sort(function(l,i){l=l[1];i=i[1];return l<i?-1:(l>i?1:0)});var k={};var j=0;for(j=0;j<g.length;j++){if((typeof g[j][1])==="string"){k[g[j][0]]=g[j][1]}}return k},makeID:function(){var h="";var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var g=0;g<9;g++){h+=f.charAt(Math.floor(Math.random()*f.length))}return h},sortMultiDimensionalArray:function(h,g){var f=h[0];if(typeof f==="string"){f=f.toLowerCase()}var i=g[0];if(typeof i==="string"){i=i.toLowerCase()}if(f===i){return 0}else{return(f<i)?-1:1}}};TableFilterSort=jQuery.extend(d,c);this.each(function(f,g){d.init(e);e++});return{getVar:function(f){if(d.hasOwnProperty(f)){return d[f]}},setVar:function(g,f){d[g]=f;return this},gotoPage:function(f){d.gotoPage(f);return this}}}}(jQuery));String.prototype.raw2attr=function(){return(""+this).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"&#13;").replace(/[\r\n]/g,"&#13;")};String.prototype.attr2raw=function(){var a=(""+this);a=a.replace(/\r\n/g,"\n").replace(/[\r\n]/,"\n").replace(/&#13;&#10;/g,"\n").replace(/&#1[03];/g,"\n").replace(/&#9;/g,"\t").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'");var b=/&[^;]*;?/.match(a);if(b.length>0&&b[0]!=="&amp;"){throw"unsafe entity found in the attribute literal content"}a=a.replace(/&amp;/g,"&");return a};jQuery.fn.isOnScreen=function(){var a={};a.top=jQuery(window).scrollTop();a.bottom=a.top+jQuery(window).height();var b={};b.top=this.offset().top;b.bottom=b.top+this.outerHeight();return((b.top<=a.bottom)&&(b.bottom>=a.top))};
=======
jQuery(document).ready(function(){if("undefined"!=typeof TableFilterSortTableList){var e=0;for(e=0;e<TableFilterSortTableList.length;e++)TableFilterSortTableList[e]=jQuery(TableFilterSortTableList[e]).tableFilterSort()}}),function(e){e.fn.tableFilterSort=function(e){var t=0,r=this,a={debug:!1,baseURL:"",favouritesURL:"/tfs/favourites/",filtersURL:"/tfs/filters/",filtersParentPageID:"",favouritesParentPageID:"",useBackAndForwardButtons:!1,holderNumber:0,myTableHolder:r,myFilterFormHolder:null,myTable:null,myTableHead:null,myTableBody:null,myRows:null,dataDictionary:[],currentFilter:{},currentSorter:{},showFromRow:0,visibleRowCount:50,totalRowCount:0,maximumNumberOfFilterOptions:3,intervalForFilterCheck:1e3,hasFixedTableHeader:!0,hasKeywords:!0,hasFavourites:!1,hasFilterSaving:!1,millisecondsBetweenActions:10,validDataTypes:["number","string","date"],maxNumberOfValuesToCheck:500,favouritesStore:[],startRowFX1:null,startRowFX2:null,endRowFX1:null,endRowFX2:null,filterTitle:"Filter Table",noFilterSelectedText:"No filter selected",closeAndApplyFilterText:"Close and Apply Filter",currentFilterText:"Current Filter",greaterThanLabel:"&gt; ",lowerThanLabel:"&lt; ",keywordsCategoryTitle:"Keywords",favouritesCategoryTitle:"Favourites",filtersTitle:"Filter",tableSelector:"table.tableFilterSortTable",rowSelector:"tr.tfsRow",filterItemSelector:"span[data-filter]",showMoreDetailsSelector:".more",moreDetailsSelector:".hidden",filterFormHolderSelector:".tableFilterSortFilterFormHolder",sortLinkSelector:"a.sortable",favouriteLinkSelector:"a.addFav",moreRowEntriesSelector:".tableFilterSortMoreEntries",matchRowCountSelector:".match-row-number",minRowSelector:".min-row-number",maxRowSelector:".max-row-number",totalRowCountSelector:".total-row-number",visibleRowCountSelector:".total-showing-row-number",paginationSelector:".pagination",saveAndLoadSelector:".saveAndLoad",loadingClass:"loading",showClass:"show",hideClass:"hide",matchClass:"match",notMatchClass:"no-match",openedClass:"opened",filterIsOpenClass:"filterIsOpen",sectionFilterClassAppendix:"Filter",commonContentHolderClass:"tableFilterSortCommonContentHolder",currentSearchFilterClass:"tableFilterSortCurrentSearchHolder",openAndCloseFilterFormClass:"tableFilterSortOpenFilterForm",filterOptionsHolderClass:"tableFilterSortFilterFormOptions",filterGroupClass:"filterColumn",groupLabelClass:"groupLabel",applyFilterClass:"applyFilter",filterInUseClass:"tableFilterSortFilterInUse",filterNotInUseClass:"tableFilterSortFilterNotInUse",noMatchMessageClass:"no-matches-message",sortAscClass:"sort-asc",sortDescClass:"sort-desc",directLinkClass:"dl",favouriteClass:"fav",init:function(e){a.holderNumber=e,a.myTableHolder=r,a.myFilterFormHolder=a.myTableHolder.find(a.filterFormHolderSelector).first(),a.myTable=a.myTableHolder.find(a.tableSelector).first(),a.myTableHead=a.myTableHolder.find("table thead"),a.myTableBody=a.myTable.find(" > tbody"),a.favouritesParentPageID=a.myFilterFormHolder.attr("data-favourites-page-id"),"string"==typeof a.favouritesParentPageID&&a.favouritesParentPageID.length>0&&(a.hasFavourites=!0),a.filtersParentPageID=a.myFilterFormHolder.attr("data-filter-page-id"),"string"==typeof a.filtersParentPageID&&a.filtersParentPageID.length>0&&(a.hasFilterSaving=!0),a.baseURL=location.protocol+"//"+location.host+location.pathname,a.resetObjects(),a.myRows.length>1&&(a.myTableHolder.addClass(a.loadingClass),window.setTimeout(function(){a.debug&&(console.profileEnd(),console.profile("filterItemCollector")),a.filterItemCollector(),a.debug&&(console.profileEnd(),console.profile("tableHideColsWhichAreAllTheSame")),a.tableHideColsWhichAreAllTheSame(),a.debug&&(console.profileEnd(),console.profile("dataDictionaryCollector")),a.dataDictionaryCollector(),a.debug&&(console.profileEnd(),console.profile("setupFilterFormListeners")),a.setupFilterFormListeners(),a.debug&&(console.profileEnd(),console.profile("setupSortListeners")),a.setupSortListeners(),a.debug&&(console.profileEnd(),console.profile("paginationListeners")),a.paginationListeners(),a.debug&&console.profile("toggleSlideSetup"),a.toggleSlideSetup(),a.debug&&console.profile("addURLChangeListener"),a.addURLChangeListener(),a.debug&&(console.profileEnd(),console.profile("retrieveServerDataListener")),a.retrieveServerDataListener(),a.debug&&(console.profileEnd(),console.profile("favouriteLinkListener")),a.favouriteLinkListener(),a.debug&&(console.profileEnd(),console.profile("directFilterLinkListener")),a.directFilterLinkListener(),a.debug&&(console.profileEnd(),console.profile("createFilterForm")),a.createFilterForm(),a.debug&&console.profileEnd(),a.myTableHolder.removeClass(a.loadingClass),a.debug&&console.profile("runCurrentSort"),a.runCurrentSort(),a.debug&&(console.profileEnd(),console.profile("retrieveCookieData")),a.retrieveCookieData(),a.debug&&(console.profileEnd(),console.profile("fixTableHeader")),a.fixTableHeader(),a.debug&&console.profileEnd()},a.millisecondsBetweenActions))},resetObjects:function(){a.myRows=a.myTable.find(a.rowSelector)},filterItemCollector:function(){var e="",t="";a.myRows.each(function(r,o){jQuery(o).find(a.filterItemSelector).each(function(r,o){o=jQuery(o),e=o.text(),t=o.attr("data-filter"),e.trim().length>0&&(a.debug&&console.debug("adding "+e+" to "+t),"undefined"==typeof a.dataDictionary[t]&&(a.dataDictionary[t]={}),"undefined"==typeof a.dataDictionary[t].Options&&(a.dataDictionary[t].Options=[]),a.dataDictionary[t].Options.indexOf(e)===-1&&a.dataDictionary[t].Options.push(e))})})},tableHideColsWhichAreAllTheSame:function(){var e=a.myTableHolder.find("."+a.commonContentHolderClass).attr("data-title");e="undefined"!=typeof e?"<h3>"+e+"</h3>":"";var t='<div class="'+a.commonContentHolderClass+'-inner">'+e+"<ul>",r=!1;Object.keys(a.dataDictionary).forEach(function(e,o){if(1===a.dataDictionary[e].Options.length){delete a.dataDictionary[e],a.debug&&console.debug("tableHideColsWhichAreAllTheSame: checking category: "+e),r=!0;var l=!1;jQuery('span[data-filter="'+e+'"]').each(function(r,o){o=jQuery(o),l||""!==o.html()&&(t+="<li><strong>"+e+":</strong> <span>"+o.html()+"</span></li>",l=!0);var i=o.parent();if(o.remove(),i.is("li"))i.hide();else if(i.is("td")&&0===i.children().length){if(0===r){var n=i.parent("tr").children("td").index(i);a.myTable.find("th").eq(n).remove()}i.remove()}})}}),t+="</ul></div>",r?a.myTableHolder.find("."+a.commonContentHolderClass).html(t):a.myTableHolder.find("."+a.commonContentHolderClass).remove()},dataDictionaryCollector:function(){Object.keys(a.dataDictionary).forEach(function(e,t){"undefined"==typeof a.dataDictionary[e].Options&&(a.dataDictionary[e].Options=[]);var r=a.myTable.find(a.sortLinkSelector+'[data-sort-field="'+e+'"]').first();if("undefined"==typeof a.dataDictionary[e].CanFilter&&(r&&"true"==r.attr("data-sort-only")?a.dataDictionary[e].CanFilter=!1:a.dataDictionary[e].CanFilter=a.dataDictionary[e].Options.length>1),"undefined"==typeof a.dataDictionary[e].CanSort&&(a.dataDictionary[e].CanSort=r.length>0),"undefined"==typeof a.dataDictionary[e].DataType&&a.dataDictionary[e].CanSort){var o=r.attr("data-sort-type");a.dataDictionary[e].DataType=o}if("undefined"==typeof a.dataDictionary[e].DataType){var l="number",i=!1,n=0,s=a.dataDictionary[e].Options.length<a.maxNumberOfValuesToCheck?a.dataDictionary[e].Options.length:500;for(n=0;n<s;n++)if(i=jQuery.isNumeric(a.dataDictionary[e].Options[n]),i===!1){l="string";break}a.dataDictionary[e].DataType=l}switch(jQuery.inArray(a.dataDictionary[e].DataType,a.validDataTypes)===!1&&console.debug("ERROR: invalid DataType for"+e+": "+a.dataDictionary[e].DataType),a.dataDictionary[e].DataType){case"number":a.dataDictionary[e].Options.sort(function(e,t){return e=parseFloat(e.replace(/[^0-9.]/g,"")),t=parseFloat(t.replace(/[^0-9.]/g,"")),e-t});break;case"string":default:a.dataDictionary[e].Options.sort()}})},setupFilterFormListeners:function(){a.myTableHolder.on("click","."+a.openAndCloseFilterFormClass,function(e){return e.preventDefault(),a.myFilterFormHolder.find("."+a.filterOptionsHolderClass).toggleClass(a.openedClass).slideToggle("fast"),a.myTableHolder.toggleClass(a.filterIsOpenClass),a.myTableHolder.hasClass(a.filterIsOpenClass)||a.applyFilter(),!1})},setupSortListeners:function(){a.myTableHolder.on("click",a.sortLinkSelector,function(e){e.preventDefault();var t=jQuery(this);a.showFromRow=0,a.startRowManipulation(),a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass),window.setTimeout(function(){a.currentSorter.category=t.attr("data-sort-field"),a.currentSorter.direction=t.attr("data-sort-direction"),a.currentSorter.sortType=t.attr("data-sort-type"),"undefined"==typeof a.currentSorter.sortType&&(a.currentSorter.sortType=a.dataDictionary[a.currentSorter.category].DataType);var e=[];a.myRows.each(function(t,r){var o=jQuery(r),l=o.find('[data-filter="'+a.currentSorter.category+'"]').text();"number"===a.currentSorter.sortType&&(l=l.replace(/[^\d.-]/g,""),l=parseFloat(l));var i=new Array(l,t);e.push(i)}),a.myTableBody.empty(),e.sort(a.sortMultiDimensionalArray);var r=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.currentSorter.category+'"]');"desc"===a.currentSorter.direction?(e.reverse(),r.attr("data-sort-direction","asc").addClass(a.sortDescClass)):r.attr("data-sort-direction","desc").addClass(a.sortAscClass),e.forEach(function(e){a.myTableBody.append(a.myRows[e[1]])}),a.endRowManipulation()},a.millisecondsBetweenActions)})},paginationListeners:function(){a.myTableHolder.on("click",a.paginationSelector+" a",function(e){e.preventDefault();var t=jQuery(this).attr("data-page");return a.gotoPage(t),!1})},toggleSlideSetup:function(){a.myTableHolder.on("click",a.showMoreDetailsSelector,function(e){e.preventDefault();var t=jQuery(this),r=t.closest("tr");r.toggleClass(a.openedClass).find(a.moreDetailsSelector).each(function(e,t){t=jQuery(t),t.slideToggle(),t.toggleClass(a.openedClass)}),t.toggleClass(a.openedClass)})},addURLChangeListener:function(){a.useBackAndForwardButtons&&window.addEventListener("popstate",function(e){a.findAndApplyGetVariables()})},directFilterLinkListener:function(){a.myTableBody.on("click","span[data-filter]."+a.directLinkClass,function(e){e.preventDefault();var t=jQuery(this),r=t.attr("data-filter"),o=t.text().trim(),l=a.myFilterFormHolder.find("."+a.filterGroupClass+'[data-to-filter="'+r+'"]'),i=l.attr("field-type"),n=l.find('input[value="'+o+'"].checkbox').first();return n&&n.length>0?n.is(":checkbox")&&(n.prop("checked")===!0?n.prop("checked",!1).trigger("change"):n.prop("checked",!0).trigger("change")):"tag"===i&&a.makeCheckboxSection(l.find("input.awesomplete").first(),o),a.applyFilter(),!1})},favouriteLinkListener:function(){a.myTableBody.find(a.favouriteLinkSelector).length>0&&a.myTableHolder.on("click",a.favouriteLinkSelector,function(e){e.preventDefault();var t=jQuery(this).closest("tr");t.toggleClass(a.favouriteClass);var r=t.attr("id");if(r&&"undefined"!=typeof r&&""!==r){if(t.hasClass(a.favouriteClass))a.favouritesStore.push(r);else{var o=a.favouritesStore.indexOf(r);o>-1&&a.favouritesStore.splice(o,1)}Cookies.set("favouritesStore",a.favouritesStore,{path:a.baseURL,expires:180})}return!1})},retrieveServerDataListener:function(){a.myTableHolder.on("click",a.saveAndLoadSelector+" a",function(e){e.preventDefault();var t=jQuery(this),r=t.attr("href"),o=!1,l=!1,i=a.favouritesParentPageID,n={};if(t.hasClass("save")&&(l=!0),t.hasClass("filters")){o=!0;var i=a.filtersParentPageID}return l&&(n=o?{f:a.currentFilter,s:a.currentSorter}:{f:a.favouritesStore}),i=i.split("/").join("--"),dataAsString=JSON.stringify(n),fullURL=r+encodeURI(i)+"/?data="+encodeURI(dataAsString),jQuery.modal('<iframe src="'+fullURL+'" height="450" width="830" style="border:0">',{closeHTML:"",containerCss:{backgroundColor:"#fff",borderColor:"#fff",height:450,padding:0,width:830},overlayClose:!0}),t.modal(),!1})},createFilterForm:function(){if(a.myFilterFormHolder.length>0){var e="",t=a.myFilterFormHolder.attr("data-title");if("undefined"==typeof t&&(t=a.filterTitle),0===a.myTableHolder.find("."+a.currentSearchFilterClass).length)var e='<div class="'+a.currentSearchFilterClass+'"></div>';var r=1,o=[],l="<form>"+e+'<a href="#" class="'+a.openAndCloseFilterFormClass+' button closed">'+t+'</a><div style="display: none;" class="'+a.filterOptionsHolderClass+'">';a.hasKeywords&&(l+=a.makeSectionHeaderForForm("keyword",a.keywordsCategoryTitle),l+=a.makeFieldForForm("keyword",a.keywordsCategoryTitle,r,0),l+=a.makeSectionFooterForForm()),Object.keys(a.dataDictionary).forEach(function(e,t){if(a.dataDictionary[e].CanFilter){r++;var i=0,n=a.dataDictionary[e].Options.length;if(n>1&&n<=a.maximumNumberOfFilterOptions){for(l+=a.makeSectionHeaderForForm("checkbox",e),i=0,i=0;i<n;i++){var s=a.dataDictionary[e].Options[i];l+=a.makeFieldForForm("checkbox",e,r,s)}l+=a.makeSectionFooterForForm()}else if(n>a.maximumNumberOfFilterOptions){var d=a.dataDictionary[e].DataType;"string"===a.dataDictionary[e].DataType&&(o.push(e),d="tag"),l+=a.makeSectionHeaderForForm(d,e),l+=a.makeFieldForForm(d,e,r,0),l+=a.makeSectionFooterForForm()}}}),a.hasFavourites&&(l+=a.makeSectionHeaderForForm("favourites",a.favouritesCategoryTitle),l+=a.makeFieldForForm("favourites",a.favouritesCategoryTitle,r,0),l+=a.makeSectionFooterForForm(),r++);var i=a.myFilterFormHolder.attr("data-title-close-and-apply");"undefined"==typeof i&&(i=a.closeAndApplyFilterText),l+='<div class="'+a.applyFilterClass+'"><a href="#" class="'+a.openAndCloseFilterFormClass+' button closed">'+i+"</a></div></div></form>",a.myFilterFormHolder.html(l);var n,s=0;for(s=0;s<o.length;s++){category=o[s];var d=a.myFilterFormHolder.find('input[name="'+category+'"].awesomplete').first(),c=jQuery(d).attr("id"),n=document.getElementById(c);new Awesomplete(n,{list:a.dataDictionary[category].Options,autoFirst:!0,replace:function(e){a.makeCheckboxSection(this.input,e.value),this.input.value="";var t=this._list.indexOf(e.value);t>-1&&this._list.splice(t,1)}})}}},makeSectionHeaderForForm:function(e,t){var r=e+a.sectionFilterClassAppendix;t.replace(/\W/g,"");return'<div class="'+a.filterGroupClass+" "+r+'" field-type="'+e+'" data-to-filter="'+t.raw2attr()+'"><label class="'+a.groupLabelClass+'">'+a.replaceAll(t,"-"," ")+"</label><ul>"},makeFieldForForm:function(e,t,r,o){var l=t.replace(/\W/g,""),i=o.toString(),n=("TFS_"+l+"_"+i).replace(/[^a-zA-Z0-9]+/g,"_");if(0===a.myFilterFormHolder.find("input#"+n).length){var s='<li class="'+e+'Field">',d="</li>";switch(e){case"favourites":return s+'<input class="favourites" type="checkbox" name="'+t.raw2attr()+'" id="'+n+'" tabindex="'+r+'" /><label for="'+n+'">♥ ♥ ♥</label>'+d;case"keyword":case"tag":var c="";return"undefined"!=typeof a.currentFilter[t]&&"undefined"!=typeof a.currentFilter[t][0]&&(c=a.currentFilter[t][0],c=c.raw2attr()),"keyword"===e?extraClass="keyword":"tag"===e&&(extraClass="awesomplete"),s+'<input class="text '+extraClass+'" type="text" name="'+t.raw2attr()+'" id="'+n+'" tabindex="'+r+'" />'+d;case"checkbox":var u="";if("undefined"!=typeof a.currentFilter[t]){var f=jQuery.inArray(o,a.currentFilter[t]);f>-1&&(u='checked="checked"')}return s+'<input class="checkbox" type="checkbox" name="'+n+'" id="'+n+'" value="'+o.raw2attr()+'" '+u+' " tabindex="'+r+'" /><label for="'+n+'">'+o+"</label>"+d;case"number":case"date":var c=["",""];"undefined"!=typeof a.currentFilter[t]&&(c=a.currentFilter[t]);var p=s+'<span class="gt"> <label for="'+n+'_gt">'+a.greaterThanLabel+'</label> <input data-dir="gt" data-label="'+a.greaterThanLabel.raw2attr()+'" class="number" step="any" type="number" name="'+l+'[]" id="'+n+'" tabindex="'+r+'" value="'+c[0].raw2attr()+'" /> </span><span class="lt"> <label for="'+n+'_lt">'+a.lowerThanLabel+'</label> <input data-dir="lt" data-label="'+a.lowerThanLabel.raw2attr()+'"  class="number" step="any" type="number" name="'+l+'[]" id="'+n+'_lt" tabindex="'+r+'" value="'+c[1].raw2attr()+'" /> </span>'+d;return"date"===e&&(p=a.replaceAll(p,"number","datetime-local"),p=a.replaceAll(p,"step","86400")),p}}},makeSectionFooterForForm:function(){return"</ul></div>"},makeCheckboxSection:function(e,t){e=jQuery(e);var r=e.attr("name");tabIndex=e.attr("tabindex");var o=a.makeFieldForForm("checkbox",r,tabIndex,t);o.length>5&&(o=o.replace("<input ",'<input checked="checked" '),e.closest("ul").append(o))},runCurrentSort:function(){var e="."+a.sortDescClass+", ."+a.sortAscClass,t=a.myTableHolder.find(e).first();t&&t.length>0||(t=a.myTableHolder.find(a.sortLinkSelector+"[data-sort-default=true]").first()),t&&t.length>0||(t=a.myTableHolder.find(a.sortLinkSelector).first()),t&&t.length>0&&t.click()},applyFilter:function(){a.showFromRow=0,a.workOutCurrentFilter(),a.startRowManipulation(),window.setTimeout(function(){a.debug&&(console.debug("=============="),console.debug(a.currentFilter)),a.myRows.each(function(e,t){var r=jQuery(t);a.debug&&console.log("===");var o=!0,l=!0;Object.keys(a.currentFilter).forEach(function(e,t){if(l){for(var i=!1,n=!0,s=0;s<a.currentFilter[e].length;s++){var d=a.currentFilter[e][s];if(n){if(e===a.favouritesCategoryTitle){var c=r.attr("id");"undefined"!=typeof c&&c.length>0&&a.favouritesStore.indexOf(c)>-1&&(i=!0)}else if(e===a.keywordsCategoryTitle){for(var u=d.valueToMatch,f=r.text().toLowerCase(),p=u.split(" "),y=!0,m=0;m<p.length;m++){var h=p[m].trim();if(f.indexOf(h)===-1){y=!1;break}}y===!0&&(i=!0)}else r.find('span[data-filter="'+e+'"]').each(function(t,r){r=jQuery(r);var o=r.text().toLowerCase().trim();switch(a.dataDictionary[e].DataType){case"date":break;case"number":if("undefined"==typeof d.valueToMatch){o=parseFloat(o.replace(/[^0-9.]/g,""));var l=d.lt,n=!0;if(jQuery.isNumeric(l)&&0!==l&&l<o&&(n=!1),n){var s=d.gt;jQuery.isNumeric(s)&&0!==s&&s>o&&(n=!1)}n&&(i=!0);break}var c=d.valueToMatch;o==c&&(i=!0);case"string":default:var c=d.valueToMatch;o===c&&(i=!0)}return i?(a.debug&&console.log("FILTER - MATCH: '"+c+"' in '"+e+"'"),!1):void(a.debug&&console.log("FILTER - NO MATCH: '"+c+"' in '"+e+"'"))});i&&(n=!1)}}i||(o=!1,l=!1)}}),o?r.addClass(a.matchClass).removeClass(a.notMatchClass):r.addClass(a.notMatchClass).removeClass(a.matchClass)}),a.endRowManipulation(),a.debug&&(console.debug(a.currentFilter),console.debug("=============="))},a.millisecondsBetweenActions)},gotoPage:function(e){a.showFromRow=e*a.visibleRowCount,a.startRowManipulation(),a.endRowManipulation()},fixTableHeader:function(){var e=this,t=!1;e.hasFixedTableHeader&&jQuery(window).bind("load resize scroll",function(r){e.myTableHolder.isOnScreen()||e.myTableHolder.hasClass(e.filterIsOpenClass)?(e.myTableHolder.addClass(e.filterInUseClass),e.myTableHolder.removeClass(e.filterNotInUseClass)):(e.myTableHolder.addClass(e.filterNotInUseClass),e.myTableHolder.removeClass(e.filterInUseClass)),"resize"===r.type&&(t=!1);var a=e.myTableBody.offset().top,o=jQuery(this).scrollTop();if(o>a)e.myTableHolder.addClass("fixed-header"),e.myTableHead.css("top",e.myFilterFormHolder.outerHeight());else if(o<=a&&(e.myTableHolder.removeClass("fixed-header"),!t&&"load"!==r.type)){var l=e.myTableHolder.width();e.myFilterFormHolder.width(l),e.myTable.width(l),e.myTableHead.width(l),e.myTable.find("tbody tr:first td").each(function(e,t){var t=jQuery(t),r=t.width();t.width(r),jQuery("thead tr").each(function(t,a){jQuery(a).children().eq(e).width(r)})})}})},startRowManipulation:function(){"function"==typeof a.startRowFX1&&a.startRowFX1(a),a.resetObjects(),a.myTable.addClass(a.loadingClass).find(a.moreRowEntriesSelector).hide(),a.myTable.hide(),a.myRows.each(function(e,t){jQuery(t).addClass(a.hideClass).removeClass(a.showClass)}),"function"==typeof a.startRowFX2&&a.startRowFX2(a)},endRowManipulation:function(){"function"==typeof a.endRowFX1&&a.endRowFX1(a),a.resetObjects();var e=a.showFromRow,t=0,r=0,o=0,l=0===a.myTableBody.find("tr."+a.notMatchClass).length,i=!1;a.myRows.each(function(n,s){s=jQuery(s),t++,i=!1,(l||s.hasClass(a.matchClass))&&(i=!0,r++),i&&r>e&&o<a.visibleRowCount&&(o++,s.removeClass(a.hideClass).addClass(a.showClass))}),r>0?jQuery("."+a.noMatchMessageClass).hide():jQuery("."+a.noMatchMessageClass).show();var n=e+o,s=Math.ceil(r/a.visibleRowCount),d=Math.floor(a.showFromRow/a.visibleRowCount),c="";if(s>1){var u=0,f=0,p=d-2,y=d+2;for(u=0;u<s;u++)d===u?(f=0,c+="<span>["+(u+1)+"]</span>"):(test1=u>p&&u<y,test2=u>=s-3,test3=u<3,test1||test2||test3?(f=0,c+='<a href="#" data-page="'+u+'">'+(u+1)+"</a> "):f<3&&(f++,c+=" . ")),c+=" ";a.myTableHolder.find(a.moreRowEntriesSelector).show()}else a.myTableHolder.find(a.moreRowEntriesSelector).not(".alwaysShow").hide();e++,a.myTableHolder.find(a.matchRowCountSelector).text(r),a.myTableHolder.find(a.minRowSelector).text(e),a.myTableHolder.find(a.maxRowSelector).text(n),a.myTableHolder.find(a.totalRowCountSelector).text(t),a.myTableHolder.find(a.visibleRowCountSelector).text(o),a.myTableHolder.find(a.paginationSelector).html(c),a.myTable.show();var m=[];if(a.hasFavourites&&m.push(a.makeRetrieveButtons(a.favouritesStore.length>0,"favourites")),a.hasFilterSaving&&m.push(a.makeRetrieveButtons(a.currentFilter.length>0,"filters")),m.length>0){var h="<ul>"+m.join("</li><li>")+"</ul>";a.myTableHolder.find(a.saveAndLoadSelector).html(h)}a.myTable.removeClass(a.loadingClass),a.myTableHolder.hasClass(a.filterIsOpenClass)||window.setTimeout(function(){jQuery("html, body").animate({scrollTop:a.myTableHolder.position().top},200)},100),a.useBackAndForwardButtons&&history.pushState(null,null,a.currentURL()),a.resetObjects(),"function"==typeof a.endRowFX2&&a.endRowFX2(a)},currentURL:function(){var e={};e.f=a.currentFilter,e.s=a.currentSorter;var t="tfs="+encodeURI(JSON.stringify(e));return a.baseURL+"?"+t},makeRetrieveButtons:function(e,t){var r=[];switch(t){case"favourites":var o=a.favouritesURL,l=a.favouritesCategoryTitle;break;case"filters":var o=a.filtersURL,l=a.filtersTitle}return e&&r.push('<a href="'+o+'save/" class="save '+t+'">Save '+l+"</a>"),r.push('<a href="'+o+'index/" class="load '+t+'">Load '+l+"</a>"),buttonHTML="<li>"+r.join(" | ")+"</li>"},workOutCurrentFilter:function(){var e,t="",r="",o="";a.currentFilter={},a.myFilterFormHolder.find(" ."+a.filterGroupClass).each(function(l,i){e=jQuery(i),r=e.attr("data-to-filter");var n=e.attr("field-type");if("keyword"===n);else if("favourites"===n);else{a.dataDictionary[r].DataType}var s=[];if(e.find("input").each(function(e,t){t=jQuery(t);var l=t.val(),i=l.toLowerCase().trim();switch(n){case"keyword":if(i.length>1)if("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),"keyword"===o)a.currentFilter[r].push({valueToMatch:i,inputVal:l}),s.push(i);else{var d=i.split(","),e=0,c=d.length;for(e=0;e<c;e++)innerInputVal=d[e].trim(),innerValueToMatch=innerInputVal,innerValueToMatch.length>1&&(a.currentFilter[r].push({valueToMatch:innerValueToMatch,inputVal:innerInputVal}),s.push(innerValueToMatch),a.debug&&console.log("... adding '"+innerValueToMatch+"' to '"+r+"'"))}break;case"tag":case"checkbox":t.is(":checked")&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),s.push(i),a.currentFilter[r].push({valueToMatch:i,inputVal:l}),a.debug&&console.log("... adding '"+r+"' to '"+i+"'"));break;case"favourites":t.is(":checked")&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),a.currentFilter[r].push({valueToMatch:i,inputVal:l}),s.push(i),a.debug&&console.log("... adding '"+r+"' to '"+i+"'"));break;case"number":var u=parseFloat(t.val());jQuery.isNumeric(u)&&0!==u&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),s.push(t.attr("data-label")+u+" "),"undefined"==typeof a.currentFilter[r][0]&&(a.currentFilter[r][0]={}),a.currentFilter[r][0][t.attr("data-dir")]=u);break;case"date":var u=t.val().trim();"0"!==u&&""!==u&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]={}),s.push(t.attr("data-label")+u),a.currentFilter[r][0][t.attr("data-dir")]=u)}}),"undefined"!=typeof a.currentFilter[r]){var d=e.find("label."+a.groupLabelClass).text();t+="<li><strong>"+d+":</strong> <span>"+s.join("</span><span>")+"</span></li>"}}),0===t.length&&(t=a.noFilterSelectedText);var l=a.myTableHolder.find("."+a.currentSearchFilterClass),i=l.attr("data-title");"undefined"==typeof i&&(i=a.currentFilterText),t="<div><h3>"+i+"</h3><ul>"+t+"</ul></div>",l.html(t),a.myTableHolder.hasClass(a.filterIsOpenClass)?l.hide():l.show()},retrieveCookieData:function(){a.favouritesStore=Cookies.getJSON("favouritesStore"),"undefined"==typeof a.favouritesStore&&(a.favouritesStore=[]);for(var e in a.favouritesStore)if(a.favouritesStore.hasOwnProperty(e)){var t=a.favouritesStore[e];a.myTableBody.find("#"+t).toggleClass(a.favouriteClass)}},findAndApplyGetVariables:function(){var e={};if(location.search.substr(1).split("&").forEach(function(t){var r=t.split("="),a=r[0],o=r[1]&&decodeURIComponent(r[1]);(e[a]=e[a]||[]).push(o)}),"undefined"!=typeof e.tfs){var t=JSON.parse(e.tfs);a.currentFilter=t.f,a.currentSorter=t.s}},replaceAll:function(e,t,r){return e.split(t).join(r),e},objectSize:function(e){var t,r=0;if("undefined"==typeof e)return 0;for(t in e)e.hasOwnProperty(t)&&r++;return r},objectSort:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push([r,e[r]]);t.sort(function(e,t){return e=e[1],t=t[1],e<t?-1:e>t?1:0});var a={},o=0;for(o=0;o<t.length;o++)"string"==typeof t[o][1]&&(a[t[o][0]]=t[o][1]);return a},makeID:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=0;r<9;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},sortMultiDimensionalArray:function(e,t){var r=e[0];"string"==typeof r&&(r=r.toLowerCase());var a=t[0];return"string"==typeof a&&(a=a.toLowerCase()),r===a?0:r<a?-1:1}};return TableFilterSort=jQuery.extend(a,e),this.each(function(e,r){a.init(t),t++}),{getVar:function(e){if(a.hasOwnProperty(e))return a[e]},setVar:function(e,t){return a[e]=t,this},gotoPage:function(e){return a.gotoPage(e),this}}}}(jQuery),String.prototype.raw2attr=function(){return(""+this).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"&#13;").replace(/[\r\n]/g,"&#13;")},String.prototype.attr2raw=function(){var e=""+this;e=e.replace(/\r\n/g,"\n").replace(/[\r\n]/,"\n").replace(/&#13;&#10;/g,"\n").replace(/&#1[03];/g,"\n").replace(/&#9;/g,"\t").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'");var t=/&[^;]*;?/.match(e);if(t.length>0&&"&amp;"!==t[0])throw"unsafe entity found in the attribute literal content";return e=e.replace(/&amp;/g,"&")},jQuery.fn.isOnScreen=function(){var e={};e.top=jQuery(window).scrollTop(),e.bottom=e.top+jQuery(window).height();var t={};return t.top=this.offset().top,t.bottom=t.top+this.outerHeight(),t.top<=e.bottom&&t.bottom>=e.top};
>>>>>>> b4cd04096927ae0511dddbd1550c3e19c215dd8e
