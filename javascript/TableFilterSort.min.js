jQuery(document).ready(function(){if("undefined"!=typeof TableFilterSortTableList){var e=0;for(e=0;e<TableFilterSortTableList.length;e++)TableFilterSortTableList[e]=jQuery(TableFilterSortTableList[e]).tableFilterSort()}}),function(e){e.fn.tableFilterSort=function(e){var t=0,r=this,a={debug:!1,baseURL:"",favouritesURL:"/tfs/favourites/",filtersURL:"/tfs/filters/",filtersParentPageID:"",favouritesParentPageID:"",useBackAndForwardButtons:!1,holderNumber:0,myTableHolder:r,myFilterFormHolder:null,myTable:null,myTableHead:null,myTableBody:null,myRows:null,dataDictionary:[],currentFilter:{},currentSorter:{},showFromRow:0,visibleRowCount:50,totalRowCount:0,maximumNumberOfFilterOptions:3,intervalForFilterCheck:1e3,hasFixedTableHeader:!0,hasKeywords:!0,hasFavourites:!1,hasFilterSaving:!1,millisecondsBetweenActions:10,validDataTypes:["number","string","date"],maxNumberOfValuesToCheck:500,favouritesStore:[],startRowFX1:null,startRowFX2:null,endRowFX1:null,endRowFX2:null,filterTitle:"Filter Table",noFilterSelectedText:"No filter selected",closeAndApplyFilterText:"Close and Apply Filter",currentFilterText:"Current Filter",greaterThanLabel:"&gt; ",lowerThanLabel:"&lt; ",keywordsCategoryTitle:"Keywords",favouritesCategoryTitle:"Favourites",filtersTitle:"Filter",tableSelector:"table.tableFilterSortTable",rowSelector:"tr.tfsRow",filterItemSelector:"span[data-filter]",showMoreDetailsSelector:".more",moreDetailsSelector:".hidden",filterFormHolderSelector:".tableFilterSortFilterFormHolder",sortLinkSelector:"a.sortable",favouriteLinkSelector:"a.addFav",moreRowEntriesSelector:".tableFilterSortMoreEntries",matchRowCountSelector:".match-row-number",minRowSelector:".min-row-number",maxRowSelector:".max-row-number",totalRowCountSelector:".total-row-number",visibleRowCountSelector:".total-showing-row-number",paginationSelector:".pagination",saveAndLoadSelector:".saveAndLoad",loadingClass:"loading",showClass:"show",hideClass:"hide",matchClass:"match",notMatchClass:"no-match",openedClass:"opened",filterIsOpenClass:"filterIsOpen",sectionFilterClassAppendix:"Filter",commonContentHolderClass:"tableFilterSortCommonContentHolder",currentSearchFilterClass:"tableFilterSortCurrentSearchHolder",openAndCloseFilterFormClass:"tableFilterSortOpenFilterForm",filterOptionsHolderClass:"tableFilterSortFilterFormOptions",filterGroupClass:"filterColumn",groupLabelClass:"groupLabel",applyFilterClass:"applyFilter",filterInUseClass:"tableFilterSortFilterInUse",filterNotInUseClass:"tableFilterSortFilterNotInUse",noMatchMessageClass:"no-matches-message",sortAscClass:"sort-asc",sortDescClass:"sort-desc",directLinkClass:"dl",favouriteClass:"fav",init:function(e){a.holderNumber=e,a.myTableHolder=r,a.myFilterFormHolder=a.myTableHolder.find(a.filterFormHolderSelector).first(),a.myTable=a.myTableHolder.find(a.tableSelector).first(),a.myTableHead=a.myTableHolder.find("table thead"),a.myTableBody=a.myTable.find(" > tbody"),a.favouritesParentPageID=a.myFilterFormHolder.attr("data-favourites-page-id"),"string"==typeof a.favouritesParentPageID&&a.favouritesParentPageID.length>0&&(a.hasFavourites=!0),a.filtersParentPageID=a.myFilterFormHolder.attr("data-filter-page-id"),"string"==typeof a.filtersParentPageID&&a.filtersParentPageID.length>0&&(a.hasFilterSaving=!0),a.baseURL=location.protocol+"//"+location.host+location.pathname,a.resetObjects(),a.myRows.length>1&&(a.myTableHolder.addClass(a.loadingClass),window.setTimeout(function(){a.debug&&(console.profileEnd(),console.profile("filterItemCollector")),a.filterItemCollector(),a.debug&&(console.profileEnd(),console.profile("tableHideColsWhichAreAllTheSame")),a.tableHideColsWhichAreAllTheSame(),a.debug&&(console.profileEnd(),console.profile("dataDictionaryCollector")),a.dataDictionaryCollector(),a.debug&&(console.profileEnd(),console.profile("setupFilterFormListeners")),a.setupFilterFormListeners(),a.debug&&(console.profileEnd(),console.profile("setupSortListeners")),a.setupSortListeners(),a.debug&&(console.profileEnd(),console.profile("paginationListeners")),a.paginationListeners(),a.debug&&console.profile("setupMoreDetailsListener"),a.setupMoreDetailsListener(),a.debug&&console.profile("addURLChangeListener"),a.addURLChangeListener(),a.debug&&(console.profileEnd(),console.profile("retrieveServerDataListener")),a.retrieveServerDataListener(),a.debug&&(console.profileEnd(),console.profile("favouriteLinkListener")),a.favouriteLinkListener(),a.debug&&(console.profileEnd(),console.profile("directFilterLinkListener")),a.directFilterLinkListener(),a.debug&&(console.profileEnd(),console.profile("createFilterForm")),a.createFilterForm(),a.debug&&console.profileEnd(),a.myTableHolder.removeClass(a.loadingClass),a.debug&&console.profile("runCurrentSort"),a.runCurrentSort(),a.debug&&(console.profileEnd(),console.profile("retrieveCookieData")),a.retrieveCookieData(),a.debug&&(console.profileEnd(),console.profile("fixTableHeader")),a.fixTableHeader(),a.debug&&console.profileEnd()},a.millisecondsBetweenActions))},resetObjects:function(){a.myRows=a.myTable.find(a.rowSelector)},filterItemCollector:function(){var e="",t="";a.myRows.each(function(r,o){jQuery(o).find(a.filterItemSelector).each(function(r,o){o=jQuery(o),e=o.text(),t=o.attr("data-filter"),e.trim().length>0&&(a.debug&&console.debug("adding "+e+" to "+t),"undefined"==typeof a.dataDictionary[t]&&(a.dataDictionary[t]={}),"undefined"==typeof a.dataDictionary[t].Options&&(a.dataDictionary[t].Options=[]),a.dataDictionary[t].Options.indexOf(e)===-1&&a.dataDictionary[t].Options.push(e))})})},tableHideColsWhichAreAllTheSame:function(){var e=a.myTableHolder.find("."+a.commonContentHolderClass).attr("data-title");e="undefined"!=typeof e?"<h3>"+e+"</h3>":"";var t='<div class="'+a.commonContentHolderClass+'-inner">'+e+"<ul>",r=!1;Object.keys(a.dataDictionary).forEach(function(e,o){if(1===a.dataDictionary[e].Options.length){delete a.dataDictionary[e],a.debug&&console.debug("tableHideColsWhichAreAllTheSame: checking category: "+e),r=!0;var i=!1;jQuery('span[data-filter="'+e+'"]').each(function(r,o){o=jQuery(o),i||""!==o.html()&&(t+="<li><strong>"+e+":</strong> <span>"+o.html()+"</span></li>",i=!0);var l=o.parent();if(o.remove(),l.is("li"))l.hide();else if(l.is("td")&&0===l.children().length){if(0===r){var n=l.parent("tr").children("td").index(l);a.myTable.find("th").eq(n).remove()}l.remove()}})}}),t+="</ul></div>",r?a.myTableHolder.find("."+a.commonContentHolderClass).html(t):a.myTableHolder.find("."+a.commonContentHolderClass).remove()},dataDictionaryCollector:function(){Object.keys(a.dataDictionary).forEach(function(e,t){"undefined"==typeof a.dataDictionary[e].Options&&(a.dataDictionary[e].Options=[]);var r=a.myTable.find(a.sortLinkSelector+'[data-sort-field="'+e+'"]').first();if("undefined"==typeof a.dataDictionary[e].CanFilter&&(r&&"true"==r.attr("data-sort-only")?a.dataDictionary[e].CanFilter=!1:a.dataDictionary[e].CanFilter=a.dataDictionary[e].Options.length>1),"undefined"==typeof a.dataDictionary[e].CanSort&&(a.dataDictionary[e].CanSort=r.length>0),"undefined"==typeof a.dataDictionary[e].DataType&&a.dataDictionary[e].CanSort){var o=r.attr("data-sort-type");a.dataDictionary[e].DataType=o}if("undefined"==typeof a.dataDictionary[e].DataType){var i="number",l=!1,n=0,s=a.dataDictionary[e].Options.length<a.maxNumberOfValuesToCheck?a.dataDictionary[e].Options.length:500;for(n=0;n<s;n++)if(l=jQuery.isNumeric(a.dataDictionary[e].Options[n]),l===!1){i="string";break}a.dataDictionary[e].DataType=i}switch(jQuery.inArray(a.dataDictionary[e].DataType,a.validDataTypes)===!1&&console.debug("ERROR: invalid DataType for"+e+": "+a.dataDictionary[e].DataType),a.dataDictionary[e].DataType){case"number":a.dataDictionary[e].Options.sort(function(e,t){return e=parseFloat(e.replace(/[^0-9.]/g,"")),t=parseFloat(t.replace(/[^0-9.]/g,"")),e-t});break;case"string":default:a.dataDictionary[e].Options.sort()}})},setupFilterFormListeners:function(){a.myFilterFormHolder.on("click","."+a.openAndCloseFilterFormClass,function(e){return e.preventDefault(),a.myFilterFormHolder.find("."+a.filterOptionsHolderClass).toggleClass(a.openedClass).slideToggle("fast"),a.myTableHolder.toggleClass(a.filterIsOpenClass),a.myTableHolder.hasClass(a.filterIsOpenClass)||a.applyFilter(),!1}),a.myFilterFormHolder.on("change","input",function(e){a.applyFilter()})},setupSortListeners:function(){a.myTableHolder.on("click",a.sortLinkSelector,function(e){e.preventDefault();var t=jQuery(this);a.showFromRow=0,a.startRowManipulation(),a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass),window.setTimeout(function(){a.currentSorter.category=t.attr("data-sort-field"),a.currentSorter.direction=t.attr("data-sort-direction"),a.currentSorter.sortType=t.attr("data-sort-type"),"undefined"==typeof a.currentSorter.sortType&&(a.currentSorter.sortType=a.dataDictionary[a.currentSorter.category].DataType);var e=[];a.myRows.each(function(t,r){var o=jQuery(r),i=o.find('[data-filter="'+a.currentSorter.category+'"]').text();"number"===a.currentSorter.sortType&&(i=i.replace(/[^\d.-]/g,""),i=parseFloat(i));var l=new Array(i,t);e.push(l)}),a.myTableBody.empty(),e.sort(a.sortMultiDimensionalArray);var r=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.currentSorter.category+'"]');"desc"===a.currentSorter.direction?(e.reverse(),r.attr("data-sort-direction","asc").addClass(a.sortDescClass)):r.attr("data-sort-direction","desc").addClass(a.sortAscClass),e.forEach(function(e){a.myTableBody.append(a.myRows[e[1]])}),a.endRowManipulation()},a.millisecondsBetweenActions)})},paginationListeners:function(){a.myTableHolder.on("click",a.paginationSelector+" a",function(e){e.preventDefault();var t=jQuery(this).attr("data-page");return a.gotoPage(t),!1})},setupMoreDetailsListener:function(){a.myTableHolder.on("click",a.showMoreDetailsSelector,function(e){e.preventDefault();var t=jQuery(this),r=t.closest("tr");r.toggleClass(a.openedClass).find(a.moreDetailsSelector).each(function(e,t){t=jQuery(t),t.slideToggle(),t.toggleClass(a.openedClass)}),t.toggleClass(a.openedClass)})},addURLChangeListener:function(){a.useBackAndForwardButtons&&window.addEventListener("popstate",function(e){a.findAndApplyGetVariables()})},directFilterLinkListener:function(){a.myTableBody.on("click","span[data-filter]."+a.directLinkClass,function(e){e.preventDefault();var t=jQuery(this),r=t.attr("data-filter"),o=t.text().trim(),i=a.myFilterFormHolder.find("."+a.filterGroupClass+'[data-to-filter="'+r+'"]'),l=i.attr("field-type"),n=i.find('input[value="'+o+'"].checkbox').first();return n&&n.length>0?n.is(":checkbox")&&(n.prop("checked")===!0?n.prop("checked",!1).trigger("change"):n.prop("checked",!0).trigger("change")):"tag"===l&&a.makeCheckboxSection(i.find("input.awesomplete").first(),o),a.applyFilter(),!1})},favouriteLinkListener:function(){a.myTableBody.find(a.favouriteLinkSelector).length>0&&a.myTableHolder.on("click",a.favouriteLinkSelector,function(e){e.preventDefault();var t=jQuery(this).closest("tr");t.toggleClass(a.favouriteClass);var r=t.attr("id");if(r&&"undefined"!=typeof r&&""!==r){if(t.hasClass(a.favouriteClass))a.favouritesStore.push(r);else{var o=a.favouritesStore.indexOf(r);o>-1&&a.favouritesStore.splice(o,1)}Cookies.set("favouritesStore",a.favouritesStore,{path:a.baseURL,expires:180})}return!1})},retrieveServerDataListener:function(){a.myTableHolder.on("click",a.saveAndLoadSelector+" a",function(e){e.preventDefault();var t=jQuery(this),r=t.attr("href"),o=!1,i=!1,l=a.favouritesParentPageID,n={};if(t.hasClass("save")&&(i=!0),t.hasClass("filters")){o=!0;var l=a.filtersParentPageID}return i&&(n=o?{f:a.currentFilter,s:a.currentSorter}:{f:a.favouritesStore}),l=l.split("/").join("--"),dataAsString=JSON.stringify(n),fullURL=r+encodeURI(l)+"/?data="+encodeURI(dataAsString),jQuery.modal('<iframe src="'+fullURL+'" height="450" width="830" style="border:0">',{closeHTML:"",containerCss:{backgroundColor:"#fff",borderColor:"#fff",height:450,padding:0,width:830},overlayClose:!0}),t.modal(),!1})},createFilterForm:function(){if(a.myFilterFormHolder.length>0){var e="",t=a.myFilterFormHolder.attr("data-title");if("undefined"==typeof t&&(t=a.filterTitle),0===a.myTableHolder.find("."+a.currentSearchFilterClass).length)var e='<div class="'+a.currentSearchFilterClass+'"></div>';var r=1,o=[],i="<form>"+e+'<a href="#" class="'+a.openAndCloseFilterFormClass+' button closed">'+t+'</a><div style="display: none;" class="'+a.filterOptionsHolderClass+'">';a.hasKeywords&&(i+=a.makeSectionHeaderForForm("keyword",a.keywordsCategoryTitle),i+=a.makeFieldForForm("keyword",a.keywordsCategoryTitle,r,0),i+=a.makeSectionFooterForForm()),Object.keys(a.dataDictionary).forEach(function(e,t){if(a.dataDictionary[e].CanFilter){r++;var l=0,n=a.dataDictionary[e].Options.length;if(n>1&&n<=a.maximumNumberOfFilterOptions){for(i+=a.makeSectionHeaderForForm("checkbox",e),l=0,l=0;l<n;l++){var s=a.dataDictionary[e].Options[l];i+=a.makeFieldForForm("checkbox",e,r,s)}i+=a.makeSectionFooterForForm()}else if(n>a.maximumNumberOfFilterOptions){var d=a.dataDictionary[e].DataType;"string"===a.dataDictionary[e].DataType&&(o.push(e),d="tag"),i+=a.makeSectionHeaderForForm(d,e),i+=a.makeFieldForForm(d,e,r,0),i+=a.makeSectionFooterForForm()}}}),a.hasFavourites&&(i+=a.makeSectionHeaderForForm("favourites",a.favouritesCategoryTitle),i+=a.makeFieldForForm("favourites",a.favouritesCategoryTitle,r,0),i+=a.makeSectionFooterForForm(),r++);var l=a.myFilterFormHolder.attr("data-title-close-and-apply");"undefined"==typeof l&&(l=a.closeAndApplyFilterText),i+='<div class="'+a.applyFilterClass+'"><a href="#" class="'+a.openAndCloseFilterFormClass+' button closed">'+l+"</a></div></div></form>",a.myFilterFormHolder.html(i);var n,s=0;for(s=0;s<o.length;s++){category=o[s];var d=a.myFilterFormHolder.find('input[name="'+category+'"].awesomplete').first(),c=jQuery(d).attr("id"),n=document.getElementById(c);new Awesomplete(n,{list:a.dataDictionary[category].Options,autoFirst:!0,replace:function(e){a.makeCheckboxSection(this.input,e.value),this.input.value="";var t=this._list.indexOf(e.value);t>-1&&this._list.splice(t,1),a.applyFilter()}})}}},makeSectionHeaderForForm:function(e,t){var r=e+a.sectionFilterClassAppendix;t.replace(/\W/g,"");return'<div class="'+a.filterGroupClass+" "+r+'" field-type="'+e+'" data-to-filter="'+t.raw2attr()+'"><label class="'+a.groupLabelClass+'">'+a.replaceAll(t,"-"," ")+"</label><ul>"},makeFieldForForm:function(e,t,r,o){var i=t.replace(/\W/g,""),l=o.toString(),n=("TFS_"+i+"_"+l).replace(/[^a-zA-Z0-9]+/g,"_");if(0===a.myFilterFormHolder.find("input#"+n).length){var s='<li class="'+e+'Field">',d="</li>";switch(e){case"favourites":return s+'<input class="favourites" type="checkbox" name="'+t.raw2attr()+'" id="'+n+'" tabindex="'+r+'" /><label for="'+n+'">♥ ♥ ♥</label>'+d;case"keyword":case"tag":var c="";return"undefined"!=typeof a.currentFilter[t]&&"undefined"!=typeof a.currentFilter[t][0]&&(c=a.currentFilter[t][0],c=c.raw2attr()),"keyword"===e?extraClass="keyword":"tag"===e&&(extraClass="awesomplete"),s+'<input class="text '+extraClass+'" type="text" name="'+t.raw2attr()+'" id="'+n+'" tabindex="'+r+'" />'+d;case"checkbox":var u="";if("undefined"!=typeof a.currentFilter[t]){var f=jQuery.inArray(o,a.currentFilter[t]);f>-1&&(u='checked="checked"')}return s+'<input class="checkbox" type="checkbox" name="'+n+'" id="'+n+'" value="'+o.raw2attr()+'" '+u+' " tabindex="'+r+'" /><label for="'+n+'">'+o+"</label>"+d;case"number":case"date":var c=["",""];"undefined"!=typeof a.currentFilter[t]&&(c=a.currentFilter[t]);var p=s+'<span class="gt"> <label for="'+n+'_gt">'+a.greaterThanLabel+'</label> <input data-dir="gt" data-label="'+a.greaterThanLabel.raw2attr()+'" class="number" step="any" type="number" name="'+i+'[]" id="'+n+'" tabindex="'+r+'" value="'+c[0].raw2attr()+'" /> </span><span class="lt"> <label for="'+n+'_lt">'+a.lowerThanLabel+'</label> <input data-dir="lt" data-label="'+a.lowerThanLabel.raw2attr()+'"  class="number" step="any" type="number" name="'+i+'[]" id="'+n+'_lt" tabindex="'+r+'" value="'+c[1].raw2attr()+'" /> </span>'+d;return"date"===e&&(p=a.replaceAll(p,"number","datetime-local"),p=a.replaceAll(p,"step","86400")),p}}},makeSectionFooterForForm:function(){return"</ul></div>"},makeCheckboxSection:function(e,t){e=jQuery(e);var r=e.attr("name");tabIndex=e.attr("tabindex");var o=a.makeFieldForForm("checkbox",r,tabIndex,t);o.length>5&&(o=o.replace("<input ",'<input checked="checked" '),e.closest("ul").append(o))},runCurrentSort:function(){var e="."+a.sortDescClass+", ."+a.sortAscClass,t=a.myTableHolder.find(e).first();t&&t.length>0||(t=a.myTableHolder.find(a.sortLinkSelector+"[data-sort-default=true]").first()),t&&t.length>0||(t=a.myTableHolder.find(a.sortLinkSelector).first()),t&&t.length>0&&t.click()},applyFilter:function(){a.showFromRow=0,a.workOutCurrentFilter(),a.startRowManipulation(),window.setTimeout(function(){a.debug&&(console.debug("=============="),console.debug(a.currentFilter)),a.myRows.each(function(e,t){var r=jQuery(t);a.debug&&console.log("===");var o=!0,i=!0;Object.keys(a.currentFilter).forEach(function(e,t){if(i){for(var l=!1,n=!0,s=0;s<a.currentFilter[e].length;s++){var d=a.currentFilter[e][s];if(n){if(e===a.favouritesCategoryTitle){var c=r.attr("id");"undefined"!=typeof c&&c.length>0&&a.favouritesStore.indexOf(c)>-1&&(l=!0)}else if(e===a.keywordsCategoryTitle){for(var u=d.valueToMatch,f=r.text().toLowerCase(),p=u.split(" "),y=!0,m=0;m<p.length;m++){var h=p[m].trim();if(f.indexOf(h)===-1){y=!1;break}}y===!0&&(l=!0)}else r.find('span[data-filter="'+e+'"]').each(function(t,r){r=jQuery(r);var o=r.text().toLowerCase().trim();switch(a.dataDictionary[e].DataType){case"date":break;case"number":if("undefined"==typeof d.valueToMatch){o=parseFloat(o.replace(/[^0-9.]/g,""));var i=d.lt,n=!0;if(jQuery.isNumeric(i)&&0!==i&&i<o&&(n=!1),n){var s=d.gt;jQuery.isNumeric(s)&&0!==s&&s>o&&(n=!1)}n&&(l=!0);break}var c=d.valueToMatch;o==c&&(l=!0);case"string":default:var c=d.valueToMatch;o===c&&(l=!0)}return l?(a.debug&&console.log("FILTER - MATCH: '"+c+"' in '"+e+"'"),!1):void(a.debug&&console.log("FILTER - NO MATCH: '"+c+"' in '"+e+"'"))});l&&(n=!1)}}l||(o=!1,i=!1)}}),o?r.addClass(a.matchClass).removeClass(a.notMatchClass):r.addClass(a.notMatchClass).removeClass(a.matchClass)}),a.endRowManipulation(),a.debug&&(console.debug(a.currentFilter),console.debug("=============="))},a.millisecondsBetweenActions)},gotoPage:function(e){a.showFromRow=e*a.visibleRowCount,a.startRowManipulation(),a.endRowManipulation()},fixTableHeader:function(){var e=this,t=!1;e.hasFixedTableHeader&&jQuery(window).bind("load resize scroll",function(r){e.myTableHolder.isOnScreen()||e.myTableHolder.hasClass(e.filterIsOpenClass)?(e.myTableHolder.addClass(e.filterInUseClass),e.myTableHolder.removeClass(e.filterNotInUseClass)):(e.myTableHolder.addClass(e.filterNotInUseClass),e.myTableHolder.removeClass(e.filterInUseClass)),"resize"===r.type&&(t=!1);var a=e.myTableBody.offset().top,o=jQuery(this).scrollTop();if(o>a)e.myTableHolder.addClass("fixed-header"),e.myTableHead.css("top",e.myFilterFormHolder.outerHeight());else if(o<=a&&(e.myTableHolder.removeClass("fixed-header"),!t&&"load"!==r.type)){t=!0;var i=e.myTableHolder.width();e.myFilterFormHolder.width(i),e.myTable.find("tbody tr:first td").each(function(e,t){var t=jQuery(t),r=t.width();t.width(r),jQuery("thead tr").each(function(t,a){jQuery(a).children().eq(e).width(r)})})}})},startRowManipulation:function(){"function"==typeof a.startRowFX1&&a.startRowFX1(a),a.resetObjects(),a.myTable.addClass(a.loadingClass).find(a.moreRowEntriesSelector).hide(),a.myTable.hide(),a.myRows.each(function(e,t){jQuery(t).addClass(a.hideClass).removeClass(a.showClass)}),"function"==typeof a.startRowFX2&&a.startRowFX2(a)},endRowManipulation:function(){"function"==typeof a.endRowFX1&&a.endRowFX1(a),a.resetObjects();var e=a.showFromRow,t=0,r=0,o=0,i=0===a.myTableBody.find("tr."+a.notMatchClass).length,l=!1;a.myRows.each(function(n,s){s=jQuery(s),t++,l=!1,(i||s.hasClass(a.matchClass))&&(l=!0,r++),l&&r>e&&o<a.visibleRowCount&&(o++,s.removeClass(a.hideClass).addClass(a.showClass))}),r>0?jQuery("."+a.noMatchMessageClass).hide():jQuery("."+a.noMatchMessageClass).show();var n=e+o,s=Math.ceil(r/a.visibleRowCount),d=Math.floor(a.showFromRow/a.visibleRowCount),c="";if(s>1){var u=0,f=0,p=d-2,y=d+2;for(u=0;u<s;u++)d===u?(f=0,c+="<span>["+(u+1)+"]</span>"):(test1=u>p&&u<y,test2=u>=s-3,test3=u<3,test1||test2||test3?(f=0,c+='<a href="#" data-page="'+u+'">'+(u+1)+"</a> "):f<3&&(f++,c+=" . ")),c+=" ";a.myTableHolder.find(a.moreRowEntriesSelector).show()}else a.myTableHolder.find(a.moreRowEntriesSelector).not(".alwaysShow").hide();e++,a.myTableHolder.find(a.matchRowCountSelector).text(r),a.myTableHolder.find(a.minRowSelector).text(e),a.myTableHolder.find(a.maxRowSelector).text(n),a.myTableHolder.find(a.totalRowCountSelector).text(t),a.myTableHolder.find(a.visibleRowCountSelector).text(o),a.myTableHolder.find(a.paginationSelector).html(c),a.myTable.show();var m=[];if(a.hasFavourites&&m.push(a.makeRetrieveButtons(a.favouritesStore.length>0,"favourites")),a.hasFilterSaving&&m.push(a.makeRetrieveButtons(a.currentFilter.length>0,"filters")),m.length>0){var h="<ul>"+m.join("</li><li>")+"</ul>";a.myTableHolder.find(a.saveAndLoadSelector).html(h)}a.myTable.removeClass(a.loadingClass),a.myTableHolder.hasClass(a.filterIsOpenClass)||window.setTimeout(function(){jQuery("html, body").animate({scrollTop:a.myTableHolder.position().top},200)},100),a.useBackAndForwardButtons&&history.pushState(null,null,a.currentURL()),a.resetObjects(),"function"==typeof a.endRowFX2&&a.endRowFX2(a)},currentURL:function(){var e={};e.f=a.currentFilter,e.s=a.currentSorter;var t="tfs="+encodeURI(JSON.stringify(e));return a.baseURL+"?"+t},makeRetrieveButtons:function(e,t){var r=[];switch(t){case"favourites":var o=a.favouritesURL,i=a.favouritesCategoryTitle;break;case"filters":var o=a.filtersURL,i=a.filtersTitle}return e&&r.push('<a href="'+o+'save/" class="save '+t+'">Save '+i+"</a>"),r.push('<a href="'+o+'index/" class="load '+t+'">Load '+i+"</a>"),buttonHTML="<li>"+r.join(" | ")+"</li>"},workOutCurrentFilter:function(){var e,t="",r="",o="";a.currentFilter={},a.myFilterFormHolder.find(" ."+a.filterGroupClass).each(function(i,l){e=jQuery(l),r=e.attr("data-to-filter");var n=e.attr("field-type");if("keyword"===n);else if("favourites"===n);else{a.dataDictionary[r].DataType}var s=[];if(e.find("input").each(function(e,t){t=jQuery(t);var i=t.val(),l=i.toLowerCase().trim();switch(n){case"keyword":if(l.length>1)if("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),"keyword"===o)a.currentFilter[r].push({valueToMatch:l,inputVal:i}),s.push(l);else{var d=l.split(","),e=0,c=d.length;for(e=0;e<c;e++)innerInputVal=d[e].trim(),innerValueToMatch=innerInputVal,innerValueToMatch.length>1&&(a.currentFilter[r].push({valueToMatch:innerValueToMatch,inputVal:innerInputVal}),s.push(innerValueToMatch),a.debug&&console.log("... adding '"+innerValueToMatch+"' to '"+r+"'"))}break;case"tag":case"checkbox":t.is(":checked")&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),s.push(l),a.currentFilter[r].push({valueToMatch:l,inputVal:i}),a.debug&&console.log("... adding '"+r+"' to '"+l+"'"));break;case"favourites":t.is(":checked")&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),a.currentFilter[r].push({valueToMatch:l,inputVal:i}),s.push(l),a.debug&&console.log("... adding '"+r+"' to '"+l+"'"));break;case"number":var u=parseFloat(t.val());jQuery.isNumeric(u)&&0!==u&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]=[]),s.push(t.attr("data-label")+u+" "),"undefined"==typeof a.currentFilter[r][0]&&(a.currentFilter[r][0]={}),a.currentFilter[r][0][t.attr("data-dir")]=u);break;case"date":var u=t.val().trim();"0"!==u&&""!==u&&("undefined"==typeof a.currentFilter[r]&&(a.debug&&console.log("adding "+r),a.currentFilter[r]={}),s.push(t.attr("data-label")+u),a.currentFilter[r][0][t.attr("data-dir")]=u)}}),"undefined"!=typeof a.currentFilter[r]){var d=e.find("label."+a.groupLabelClass).text();t+="<li><strong>"+d+":</strong> <span>"+s.join("</span><span>")+"</span></li>"}}),0===t.length&&(t=a.noFilterSelectedText);var i=a.myTableHolder.find("."+a.currentSearchFilterClass),l=i.attr("data-title");"undefined"==typeof l&&(l=a.currentFilterText),t="<div><h3>"+l+"</h3><ul>"+t+"</ul></div>",i.html(t),a.myTableHolder.hasClass(a.filterIsOpenClass)?i.hide():i.show()},retrieveCookieData:function(){if(a.myTableBody.find("tr."+a.favouriteClass).each(function(e,t){jQuery(t).removeClass(a.favouriteClass)}),a.favouritesStore=Cookies.getJSON("favouritesStore"),"undefined"==typeof a.favouritesStore)a.favouritesStore=[];else for(var e in a.favouritesStore)if(a.favouritesStore.hasOwnProperty(e)){var t=a.favouritesStore[e];a.myTableBody.find("#"+t).toggleClass(a.favouriteClass)}},findAndApplyGetVariables:function(){var e={};if(location.search.substr(1).split("&").forEach(function(t){var r=t.split("="),a=r[0],o=r[1]&&decodeURIComponent(r[1]);(e[a]=e[a]||[]).push(o)}),"undefined"!=typeof e.tfs){var t=JSON.parse(e.tfs);a.currentFilter=t.f,a.currentSorter=t.s}},replaceAll:function(e,t,r){return e.split(t).join(r),e},objectSize:function(e){var t,r=0;if("undefined"==typeof e)return 0;for(t in e)e.hasOwnProperty(t)&&r++;return r},objectSort:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push([r,e[r]]);t.sort(function(e,t){return e=e[1],t=t[1],e<t?-1:e>t?1:0});var a={},o=0;for(o=0;o<t.length;o++)"string"==typeof t[o][1]&&(a[t[o][0]]=t[o][1]);return a},makeID:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=0;r<9;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},sortMultiDimensionalArray:function(e,t){var r=e[0];"string"==typeof r&&(r=r.toLowerCase());var a=t[0];return"string"==typeof a&&(a=a.toLowerCase()),r===a?0:r<a?-1:1}};return TableFilterSort=jQuery.extend(a,e),this.each(function(e,r){a.init(t),t++}),{getVar:function(e){if(a.hasOwnProperty(e))return a[e]},setVar:function(e,t){return a[e]=t,this},gotoPage:function(e){return a.gotoPage(e),this}}}}(jQuery),String.prototype.raw2attr=function(){return(""+this).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"&#13;").replace(/[\r\n]/g,"&#13;")},String.prototype.attr2raw=function(){var e=""+this;e=e.replace(/\r\n/g,"\n").replace(/[\r\n]/,"\n").replace(/&#13;&#10;/g,"\n").replace(/&#1[03];/g,"\n").replace(/&#9;/g,"\t").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'");var t=/&[^;]*;?/.match(e);if(t.length>0&&"&amp;"!==t[0])throw"unsafe entity found in the attribute literal content";return e=e.replace(/&amp;/g,"&")},jQuery.fn.isOnScreen=function(){var e={};e.top=jQuery(window).scrollTop(),e.bottom=e.top+jQuery(window).height();var t={};return t.top=this.offset().top,t.bottom=t.top+this.outerHeight(),t.top<=e.bottom&&t.bottom>=e.top};