(function(n){n.fn.tableFilterSort=function(n){var r=0,l=this,a={debug:!1,baseURL:"",serverConnectionURL:"/tfs/",urlToLoad:"",serverDataToApply:{cfi:!0,csr:!0,mfv:!0},filtersParentPageID:"",favouritesParentPageID:"",canPushState:!1,holderNumber:0,myTableHolder:l,myFilterFormHolder:null,myFilterFormInner:null,myTable:null,myTableHead:null,myTableBody:null,myRows:null,dataDictionary:[],filterAndSortVariables:["cfi","cfc","cfx","csr","pge"],favouritesVariables:["mfv"],cfi:{},cfc:[],cfx:{},csr:{},sfr:0,
pge:0,visibleRowCount:10,totalRowCount:0,maximumNumberOfFilterOptions:30,intervalForFilterCheck:1E3,hasFixedTableHeader:!0,hasKeywords:!0,hasFavourites:!1,hasFavouritesSaving:!1,hasFilterSaving:!1,millisecondsBetweenActions:10,windowTimeoutStore:{},scrollToTopAtPageOpening:!0,validDataTypes:["number","string","date","boolean"],maxNumberOfValuesToCheck:500,mfv:[],startRowFX1:null,startRowFX2:null,endRowFX1:null,endRowFX2:null,moreDetailsFX:null,greaterThanLabel:"&gt; ",lowerThanLabel:"&lt; ",keywordsCategoryTitle:"Keywords",
favouritesCategoryTitle:"Favourites",filtersTitle:"Filter",matchRowCountSelector:".match-row-number",minRowSelector:".min-row-number",maxRowSelector:".max-row-number",totalRowCountSelector:".total-row-number",visibleRowCountSelector:".total-showing-row-number input",paginationSelector:".pagination",filteredCountHolder:".tfs-match-count-holder",unfilteredCountHolder:".tfs-no-match-count-holder",loadingClass:"loading",fixedHeaderClass:"fixed-header",filterInUseClass:"tfs-filter-in-use",filterNotInUseClass:"tfs-filter-not-in-use",
filterIsOpenClass:"filter-is-open",filterIsClosedClass:"filter-is-closed",hasFilterClass:"tfs-has-filter",doesNotHaveFilterClass:"tfs-does-not-have-filter",hasFavouritesClass:"tfs-has-favourites",hasFavouritesInFilterClass:"tfs-has-favourites-in-filter",moreRowEntriesSelector:".tfs-more-entries",commonContentHolderClass:"tfs-common-content-holder",noMatchMessageClass:"no-matches-message",filterFormHolderSelector:".tfs-filter-form-holder",filterFormInnerSelector:".tfs-filter-form-inner",tableSelector:"table.tfs-table",
rowSelector:"tr.tfstr",filterItemSelector:"span[data-filter]",showMoreDetailsSelector:".more",moreDetailsSelector:".hidden",favouriteLinkSelector:"a.addFav",showClass:"show",hideClass:"hide",matchClass:"match",notMatchClass:"no-match",openedClass:"opened",closedClass:"closed",directLinkClass:"dl",favouriteClass:"fav",currentSearchFilterClass:"tfs-current-search-holder",openAndCloseFilterFormClass:"tfs-open-filter-form",saveAndLoadClass:"tfs-save-and-load",currentFilterClass:"tfs-current-filter",clearFilterClass:"tfs-clear",
showFavouritesSelector:".filter-for-favourites a",sectionFilterClassAppendix:"Filter",filterOptionsHolderClass:"tfs-filter-form-options",filterGroupClass:"tfs-filter-column",groupLabelClass:"tfs-group-label",quickKeywordFilterSelector:'input[name="QuickKeyword"]',sortLinkSelector:"a.sortable",sortAscClass:"sort-asc",sortDescClass:"sort-desc",init:function(b){a.holderNumber=b;a.myTableHolder=l;a.myFilterFormHolder=a.myTableHolder.find(a.filterFormHolderSelector).first();a.myFilterFormInner=a.myFilterFormHolder.find(a.filterFormInnerSelector).first();
a.myTable=a.myTableHolder.find(a.tableSelector).first();a.myTableHead=a.myTableHolder.find("table thead");a.myTableBody=a.myTable.find(" > tbody");a.resetObjects();a.favouritesParentPageID=a.myTableHolder.attr("data-favourites-parent-page-id");"string"===typeof a.favouritesParentPageID&&0<a.favouritesParentPageID.length&&(a.hasFavouritesSaving=!0);a.filtersParentPageID=a.myTableHolder.attr("data-filters-parent-page-id");"string"===typeof a.filtersParentPageID&&0<a.filtersParentPageID.length&&(a.hasFilterSaving=
!0);a.baseURL=location.protocol+"//"+location.host+location.pathname;0<a.myRows.length&&window.setTimeout(function(){a.myTableHolder.find(a.matchRowCountSelector).html("...");a.myTableHolder.find(a.totalRowCountSelector).html("...");a.myTableHolder.addClass(a.loadingClass);a.debug&&console.profile("filterItemCollector");a.filterItemCollector();a.debug&&(console.profileEnd(),console.profile("hideIdenticalCols"));a.hideIdenticalCols();a.debug&&console.profileEnd();window.setTimeout(function(){a.debug&&
(console.profileEnd(),console.profile("dataDictionaryCollector"));a.dataDictionaryCollector();a.debug&&(console.profileEnd(),console.profile("findDefaultSort"));a.findDefaultSort();a.debug&&(console.profileEnd(),console.profile("fixTableHeaderListener"));a.fixTableHeaderListener();a.debug&&(console.profileEnd(),console.profile("setupFilterFormListeners"));a.setupFilterFormListeners();a.debug&&(console.profileEnd(),console.profile("setupSortListeners"));a.setupSortListeners();a.debug&&(console.profileEnd(),
console.profile("paginationListeners"));a.paginationListeners();a.debug&&console.profile("setupMoreDetailsListener");a.setupMoreDetailsListener();a.debug&&(console.profileEnd(),console.profile("openServerModalWindowListener"));a.openServerModalWindowListener();a.debug&&(console.profileEnd(),console.profile("favouriteLinkListener"));a.favouriteLinkListener();a.debug&&(console.profileEnd(),console.profile("directFilterLinkListener"));a.directFilterLinkListener();a.debug&&(console.profileEnd(),console.profile("addURLChangeListener"));
a.addURLChangeListener();a.debug&&(console.profileEnd(),console.profile("retrieveLocalCookie"));a.retrieveLocalCookie();a.debug&&(console.profileEnd(),console.profile("retrieveDataFromFragment"));a.retrieveDataFromFragment();a.debug&&(console.profileEnd(),console.profile("retrieveDataFromGetVar"));a.retrieveDataFromGetVar();a.debug&&(console.profileEnd(),console.profile("processRetrievedData"));a.processRetrievedData();a.debug&&console.profileEnd();a.myTableHolder.removeClass(a.loadingClass);a.debug&&
console.profile("setTableWidth");a.setTableWidth();a.debug&&console.profileEnd();a.canPushState=!0},a.millisecondsBetweenActions)},a.millisecondsBetweenActions)},resetObjects:function(){a.myRows=a.myTable.find(a.rowSelector)},setTableWidth:function(){if(a.fixedHeaderClass){a.myTable.css("table-layout","fixed");a.myTableHead.width(a.myTable.width());var b="<colgroup>";a.myTableHead.find("tr:first th:visible").each(function(a,c){c=jQuery(c);var e=c.outerWidth();b+='<col width="'+e+'" style="width: '+
(e+"px")+'; " clas="col'+(a+1)+'" />'});b+="</colgroup>";a.myTable.prepend(b);a.myTableHead.find("tr:first th:visible").each(function(a,b){b=jQuery(b);var e=b.width()+1;b.css("width",e)});a.myTableHolder.find(".tfspushdowndiv").remove();jQuery('<div class="tfspushdowndiv"></div>').insertBefore(a.myTable)}},filterItemCollector:function(){var b="",d="";a.myRows.each(function(c,e){jQuery(e).find(a.filterItemSelector).each(function(c,e){e=jQuery(e);b=e.text();d=e.attr("data-filter");0<b.trim().length&&
("undefined"===typeof a.dataDictionary[d]&&(a.dataDictionary[d]={}),"undefined"===typeof a.dataDictionary[d].Options&&(a.dataDictionary[d].Options=[]),-1===a.dataDictionary[d].Options.indexOf(b)&&a.dataDictionary[d].Options.push(b))})})},hideIdenticalCols:function(){var b=a.myTableHolder.find("."+a.commonContentHolderClass).attr("data-title"),d='<div class="'+a.commonContentHolderClass+'-inner">'+("undefined"!==typeof b?"<h3>"+b+"</h3>":"")+"<ul>",c=!1;Object.keys(a.dataDictionary).forEach(function(b,
f){if(1===a.dataDictionary[b].Options.length){delete a.dataDictionary[b];c=!0;var k=!1;jQuery('span[data-filter="'+b+'"]').each(function(c,f){f=jQuery(f);k||""===f.html()||f.hasClass("ignore-content")||(d+="<li><strong>"+b+":</strong> <span>"+f.html()+"</span></li>",k=!0);var g=f.parent();f.remove();if(g.is("li"))g.hide();else if(g.is("td")&&0===g.children().length){if(0===c){var v=g.parent("tr").children("td").index(g);a.myTable.find("th").eq(v).remove()}g.remove()}})}});d+="</ul></div>";c?a.myTableHolder.find("."+
a.commonContentHolderClass).html(d):a.myTableHolder.find("."+a.commonContentHolderClass).remove()},dataDictionaryCollector:function(){Object.keys(a.dataDictionary).forEach(function(b,d){"undefined"===typeof a.dataDictionary[b].Options&&(a.dataDictionary[b].Options=[]);var c=a.myTable.find(a.sortLinkSelector+'[data-sort-field="'+b+'"]').first();"undefined"===typeof a.dataDictionary[b].CanFilter&&(c&&"true"==c.attr("data-sort-only")?a.dataDictionary[b].CanFilter=!1:a.dataDictionary[b].CanFilter=1<a.dataDictionary[b].Options.length);
"undefined"===typeof a.dataDictionary[b].CanSort&&(a.dataDictionary[b].CanSort=0<c.length);"undefined"===typeof a.dataDictionary[b].DataType&&a.dataDictionary[b].CanSort&&(c=c.attr("data-sort-type"),a.dataDictionary[b].DataType=c);if("undefined"===typeof a.dataDictionary[b].DataType){for(var c="number",e=!1,f=0,k=a.dataDictionary[b].Options.length<a.maxNumberOfValuesToCheck?a.dataDictionary[b].Options.length:500,f=0;f<k;f++)if(e=jQuery.isNumeric(a.dataDictionary[b].Options[f]),!1===e){c="string";
break}a.dataDictionary[b].DataType=c}!1===jQuery.inArray(a.dataDictionary[b].DataType,a.validDataTypes)&&console.debug("ERROR: invalid DataType for"+b+": "+a.dataDictionary[b].DataType);switch(a.dataDictionary[b].DataType){case "number":a.dataDictionary[b].Options.sort(function(a,b){a=parseFloat(a.replace(/[^0-9.]/g,""));b=parseFloat(b.replace(/[^0-9.]/g,""));return a-b});break;default:a.dataDictionary[b].Options.sort()}})},findDefaultSort:function(){var b=a.myTableHead.find("."+a.sortDescClass+", ."+
a.sortAscClass).first();b&&0<b.length||(b=a.myTableHead.find(a.sortLinkSelector+"[data-sort-default=true]").first())&&0<b.length||(b=a.myTableHead.find(a.sortLinkSelector).first());b&&0<b.length&&(a.csr.sdi=b.attr("data-sort-direction"),a.csr.sct=b.attr("data-sort-field"))},fixTableHeaderListener:function(){a.fixedHeaderClass&&(jQuery(window).delayedOn("load scroll",function(b){a.fixTableHeader()},a.millisecondsBetweenActions),jQuery(window).delayedOn("resize",function(b){a.myTableHolder.removeClass(a.fixedHeaderClass);
a.myTable.find("colgroup").remove();a.myFilterFormHolder.css("width","");a.myTable.find("thead tr:first th").css({width:"","min-width":"","max-width":""});"undefined"!==typeof a.windowTimeoutStore.setTableWidthInFuture&&window.clearTimeout(a.windowTimeoutStore.setTableWidthInFuture);a.windowTimeoutStore.setTableWidthInFuture=window.setTimeout(function(){a.setTableWidth();a.fixTableHeader()},a.millisecondsBetweenActions)},a.millisecondsBetweenActions))},setupFilterFormListeners:function(){a.myFilterFormInner.hide();
a.myFilterFormHolder.on("click","."+a.openAndCloseFilterFormClass,function(b){b.preventDefault();a.myFilterFormInner.slideToggle("fast",function(){a.hasFixedTableHeader&&a.myTableHead.css("top",a.myFilterFormHolder.outerHeight()+"px");a.myTableHolder.toggleClass(a.filterIsOpenClass);a.myTableHolder.hasClass(a.filterIsOpenClass)&&a.scrollToTopOfHolder()});return!1});a.myFilterFormHolder.on("click","."+a.clearFilterClass+" a",function(b){b.preventDefault();a.cfi={};a.createFilterForm();a.runCurrentFilter();
return!1});a.myFilterFormInner.on("change","input",function(b){a.runCurrentFilter()});a.myFilterFormHolder.delayedOn("input paste change",a.quickKeywordFilterSelector,function(b){b=jQuery(this).val();a.myFilterFormInner.find('input[name="Keywords"]').val(b).change()},400);a.myFilterFormInner.on("input paste change",'input[name="Keywords"]',function(b){b=jQuery(this).val();a.myFilterFormHolder.find(a.quickKeywordFilterSelector).val(b)})},setupSortListeners:function(){a.myTableHolder.on("click",a.sortLinkSelector,
function(b){b.preventDefault();b=jQuery(this);a.csr.sdi=b.attr("data-sort-direction");a.csr.sct=b.attr("data-sort-field");a.runCurrentSort()})},paginationListeners:function(){a.myTableHolder.on("click",a.paginationSelector+" a",function(b){b.preventDefault();b=jQuery(this).attr("data-page");a.gotoPage(b);return!1});a.myTableHolder.on("input paste change",a.visibleRowCountSelector,function(){"undefined"!==typeof a.windowTimeoutStore.visibleRowCount&&window.clearTimeout(a.windowTimeoutStore.visibleRowCount);
a.windowTimeoutStore.visibleRowCount=window.setTimeout(function(){var b=a.myTableHolder.find(a.visibleRowCountSelector).val(),b=a.visibleRowCountValidator(b);!1!==b&&a.visibleRowCount!==b&&(a.visibleRowCount=b,"undefined"!==typeof Cookies&&Cookies.set("visibleRowCount",a.visibleRowCount,{path:a.baseURL,expires:180}),a.gotoPage(0,!0))},1200)})},setupMoreDetailsListener:function(){a.myTableHolder.on("click",a.showMoreDetailsSelector,function(b){b.preventDefault();b=jQuery(this);b.toggleClass(a.openedClass);
b.closest("tr").toggleClass(a.openedClass).find(a.moreDetailsSelector).each(function(b,c){c=jQuery(c);c.slideToggle();c.toggleClass(a.openedClass)});"function"===typeof a.moreDetailsFX&&a.moreDetailsFX(a)})},addURLChangeListener:function(){window.addEventListener("popstate",function(b){a.canPushState=!1;a.retrieveDataFromFragment();a.retrieveDataFromGetVar();a.processRetrievedData();a.canPushState=!0})},directFilterLinkListener:function(){a.myTableBody.on("click",a.filterItemSelector+"."+a.directLinkClass,
function(b){b.preventDefault();var d=jQuery(this);b=d.attr("data-filter");var c=d.text().trim(),d=a.myFilterFormInner.find("."+a.filterGroupClass+'[data-to-filter="'+b+'"]'),e=d.attr("field-type"),f=d.find('input[value="'+c+'"].checkbox').first(),k=!0;f&&0<f.length?f.is(":checkbox")&&(!0===f.prop("checked")?(f.prop("checked",!1).trigger("change"),k=!1):f.prop("checked",!0).trigger("change")):"tag"===e&&a.makeCheckboxSection(d.find("input.awesomplete").first(),c);var q=a.directLinkClass+"-on";a.myRows.find('span[data-filter="'+
b+'"].'+a.directLinkClass).each(function(a,b){var d=jQuery(b);d.text().trim()===c&&(k?d.addClass(q):d.removeClass(q))});a.runCurrentFilter();return!1})},favouriteLinkListener:function(){a.hasFavourites=0<a.myTableBody.find(a.favouriteLinkSelector).length;a.hasFavourites&&(a.myTableBody.on("click",a.favouriteLinkSelector,function(b){b.preventDefault();b=jQuery(this).closest("td, th").closest("tr");b.toggleClass(a.favouriteClass);var d=b.attr("id");d&&"undefined"!==typeof d&&""!==d&&(b.hasClass(a.favouriteClass)?
a.mfv.push(d):(b=a.mfv.indexOf(d),-1<b&&a.mfv.splice(b,1)),"undefined"!==typeof Cookies&&Cookies.set("mfv",a.mfv,{path:a.baseURL,expires:180}));0<a.mfv.length?a.myTableHolder.addClass(a.hasFavouritesClass):a.myTableHolder.removeClass(a.hasFavouritesClass);return!1}),a.myTableHolder.on("click",a.showFavouritesSelector,function(b){b.preventDefault();b=a.myFilterFormInner.find('input[name="Favourites"]').first();!0===b.prop("checked")?b.prop("checked",!1).trigger("change"):(a.myFilterFormHolder.find("."+
a.clearFilterClass+" a").click(),b=a.myFilterFormInner.find('input[name="Favourites"]').first(),b.prop("checked",!0).trigger("change"))}))},openServerModalWindowListener:function(){a.myTableHolder.on("click","."+a.saveAndLoadClass+" a",function(b){b.preventDefault();var d=jQuery(this).closest("."+a.saveAndLoadClass);b=a.serverConnectionURL;var c=!1,e=a.filtersParentPageID,f=a.filterAndSortVariables;!d.hasClass("filters")&&d.hasClass("favourites")&&(e=a.favouritesParentPageID,f=a.favouritesVariables);
d.hasClass("save")?(c=!0,b+="start/"):b+="index/";d={};if(!0===c)for(c=0;c<f.length;c++)d[f[c]]=a[f[c]];d.ParentPageID=e;jQuery.post(b,d,function(b){var c=Math.round(.85*jQuery(window).width()),d=Math.round(.85*jQuery(window).height());jQuery.modal('<iframe src="'+b+'" width="'+c+'"height="'+d+'" style="border:0" id="tfs-pop-up-i-frame" name="tfs-pop-up-i-frame">',{closeHTML:"close",containerCss:{backgroundColor:"#fff",borderColor:"#fff",padding:0,width:c,height:d},opacity:75,overlayClose:!0,onClose:function(){jQuery.modal.close();
a.retrieveDataFromGetVar();a.processRetrievedData()}});return!1}).fail(function(){alert("ERROR!")});return!1})},createFilterForm:function(){if(0<a.myFilterFormInner.length){a.myFilterFormInner.html("");var b=1,d=[],c='<form class="'+a.filterOptionsHolderClass+'">';Object.keys(a.dataDictionary).forEach(function(e,f){if(a.dataDictionary[e].CanFilter){b++;var h=0,g=a.dataDictionary[e].Options.length;if(1<g&&g<=a.maximumNumberOfFilterOptions){c+=a.makeSectionHeaderForForm("checkbox",e);for(h=0;h<g;h++)c+=
a.makeFieldForForm("checkbox",e,b,a.dataDictionary[e].Options[h]);c+=a.makeSectionFooterForForm()}else g>a.maximumNumberOfFilterOptions&&(h=a.dataDictionary[e].DataType,"string"===a.dataDictionary[e].DataType&&(d.push(e),h="tag"),c+=a.makeSectionHeaderForForm(h,e),c+=a.makeFieldForForm(h,e,b,0),c+=a.makeSectionFooterForForm())}});a.hasFavourites&&(c+=a.makeSectionHeaderForForm("favourites",a.favouritesCategoryTitle),c+=a.makeFieldForForm("favourites",a.favouritesCategoryTitle,b,0),c+=a.makeSectionFooterForForm(),
b++);a.hasKeywords&&(c+=a.makeSectionHeaderForForm("keyword",a.keywordsCategoryTitle),c+=a.makeFieldForForm("keyword",a.keywordsCategoryTitle,b,0),c+=a.makeSectionFooterForForm());c+="</form>";a.myFilterFormInner.html(c);if(a.hasKeywords){var e=a.myFilterFormInner.find('input[name="Keywords"]').val();a.myFilterFormHolder.find(a.quickKeywordFilterSelector).val(e)}for(var e=0,f,e=0;e<d.length;e++)category=d[e],f=a.myFilterFormInner.find('input[name="'+category+'"].awesomplete').first(),f=jQuery(f).attr("id"),
f=document.getElementById(f),new Awesomplete(f,{list:a.dataDictionary[category].Options,autoFirst:!0,filter:function(a,b){return Awesomplete.FILTER_CONTAINS(a,b)&&-1===Awesomplete.blackList.indexOf(a.value)},replace:function(b){a.makeCheckboxSection(this.input,b.value);this.input.value="";Awesomplete.blackList.push(b.value);a.runCurrentFilter()}}),Awesomplete.blackList=[]}},makeSectionHeaderForForm:function(b,d){var c=b+a.sectionFilterClassAppendix;d.replace(/\W/g,"");return'<div class="'+a.filterGroupClass+
" "+c+'" field-type="'+b+'" data-to-filter="'+d.raw2attr()+'"><label class="'+a.groupLabelClass+'">'+a.replaceAll(d,"-"," ")+"</label><ul>"},makeFieldForForm:function(b,d,c,e){var f=d.replace(/\W/g,""),k=e.toString().toLowerCase(),q=("TFS_"+f+"_"+k).replace(/[^a-zA-Z0-9]+/g,"_");if(0===a.myFilterFormInner.find("input#"+q).length){var h='<li class="'+b+'Field">';switch(b){case "favourites":var g="";"undefined"!==typeof a.cfi[d]&&(g=' checked="checked"');return h+'<input class="favourites" type="checkbox" name="'+
d.raw2attr()+'" id="'+q+'" tabindex="'+c+'" '+g+' /><label for="'+q+'">\u2764 \u2764 \u2764</label></li>';case "keyword":case "tag":f=k="";if("keyword"===b){if(g="keyword","undefined"!==typeof a.cfi[d]&&"undefined"!==typeof a.cfi[d][0])for(b=0;b<a.cfi[d].length;b++)k=a.cfi[d][b].vtm,k=k.raw2attr()}else if("tag"===b){if("undefined"!==typeof a.cfi[d])for(b=0;b<a.cfi[d].length;b++)e=a.cfi[d][b].vtm,e=a.makeFieldForForm("checkbox",d,c,e),5<e.length&&(e=e.replace("<input ",'<input checked="checked" ')),
f+=e;g="awesomplete"}return h+'<input class="text '+g+'" type="text" name="'+d.raw2attr()+'" id="'+q+'" tabindex="'+c+'" value="'+k+'" />'+f+"</li>";case "checkbox":g="";if("undefined"!==typeof a.cfi[d])for(b=0;b<a.cfi[d].length;b++)if(k.trim()===a.cfi[d][b].vtm.trim()){g='checked="checked"';break}return h+'<input class="checkbox" type="checkbox" name="'+q+'" id="'+q+'" value="'+e.raw2attr()+'" '+g+' tabindex="'+c+'" /><label for="'+q+'">'+e+"</label></li>";case "number":case "date":return k={gt:"",
lt:""},"undefined"!==typeof a.cfi[d]&&(k=a.cfi[d][0]),d=h+'<span class="gt"> <label for="'+q+'_gt">'+a.greaterThanLabel+'</label> <input data-dir="gt" data-label="'+a.greaterThanLabel.raw2attr()+'" class="number" step="any" type="number" name="'+f+'[]" id="'+q+'" tabindex="'+c+'" value="'+k.gt+'" /> </span><span class="lt"> <label for="'+q+'_lt">'+a.lowerThanLabel+'</label> <input data-dir="lt" data-label="'+a.lowerThanLabel.raw2attr()+'"  class="number" step="any" type="number" name="'+f+'[]" id="'+
q+'_lt" tabindex="'+c+'" value="'+k.lt+'" /> </span></li>',"date"===b&&(d=a.replaceAll(d,"number","datetime-local"),d=a.replaceAll(d,"step","86400")),d}}},makeSectionFooterForForm:function(){return"</ul></div>"},makeCheckboxSection:function(b,d){b=jQuery(b);var c=b.attr("name");tabIndex=b.attr("tabindex");c=a.makeFieldForForm("checkbox",c,tabIndex,d);5<c.length&&(c=c.replace("<input ",'<input checked="checked" '),b.closest("ul").append(c))},runCurrentSort:function(){a.sfr=0;a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass);
var b=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.csr.sct+'"]').first();if(b&&0<b.length){a.startRowManipulation();var d=b.attr("data-sort-type");"undefined"===typeof d&&(d=a.dataDictionary[a.csr.sct].DataType);var c=[];a.myRows.each(function(b,f){var k=jQuery(f).find('[data-filter="'+a.csr.sct+'"]').text();"undefined"!==k?(k=k.trim(),"number"===d&&(k=k.replace(/[^\d.-]/g,""),k=parseFloat(k))):k="zzzzzzzzzzzzzzzzzz";c.push([k,b])});a.myTableBody.empty();c.sort(a.sortMultiDimensionalArray);
b=a.myTableHead.find(a.sortLinkSelector+'[data-sort-field="'+a.csr.sct+'"]');"desc"===a.csr.sdi?(c.reverse(),b.attr("data-sort-direction","asc").addClass(a.sortDescClass).removeClass(a.sortAscClass)):b.attr("data-sort-direction","desc").addClass(a.sortAscClass).removeClass(a.sortDescClass);c.forEach(function(b){a.myTableBody.append(a.myRows[b[1]])});a.endRowManipulation()}},runCurrentFilter:function(){a.sfr=0;a.workOutCurrentFilter();a.startRowManipulation();a.myRows.each(function(b,d){var c=jQuery(d),
e=!0,f=!0;Object.keys(a.cfi).forEach(function(b,d){if(f){for(var h=!1,g=!0,v=0;v<a.cfi[b].length;v++){var m=a.cfi[b][v];if(g){if(b===a.favouritesCategoryTitle){var t=c.attr("id");"undefined"!==typeof t&&0<t.length&&-1<a.mfv.indexOf(t)&&(h=!0)}else if(b===a.keywordsCategoryTitle){for(var u=m.vtm,t=c.text().toLowerCase(),u=u.split(" "),n=!0,l=0;l<u.length;l++){var r=u[l].trim().toLowerCase();if(-1===t.indexOf(r)){n=!1;break}}!0===n&&(h=!0)}else c.find('span[data-filter="'+b+'"]').each(function(c,d){d=
jQuery(d);var e=d.text().toLowerCase().trim();switch(a.dataDictionary[b].DataType){case "date":break;case "number":if("undefined"!==typeof m.vtm){var f=m.vtm;e==f&&(h=!0)}else{var e=parseFloat(e.replace(/[^0-9.]/g,"")),g=m.lt,f=!0;jQuery.isNumeric(g)&&0!==g&&g<e&&(f=!1);f&&(g=m.gt,jQuery.isNumeric(g)&&0!==g&&g>e&&(f=!1));f&&(h=!0);break}default:f=m.vtm,e===f&&(h=!0)}if(h)return!1});h&&(g=!1)}}h||(f=e=!1)}});e?c.addClass(a.matchClass).removeClass(a.notMatchClass):c.addClass(a.notMatchClass).removeClass(a.matchClass)});
a.endRowManipulation()},gotoPage:function(b,d){var c=b*a.visibleRowCount;a.pge=b;if(c!==a.sfr||d)a.sfr=c,a.startRowManipulation(),a.endRowManipulation()},scrollToTopOfHolder:function(){a.canPushState||a.scrollToTopAtPageOpening?jQuery("html, body").animate({scrollTop:a.myTableHolder.position().top},200):window.scrollTo(window.scrollX,window.scrollY)},fixTableHeader:function(){if(a.myTableHolder.isOnScreen()){if(a.myTableHolder.addClass(a.filterInUseClass),a.myTableHolder.removeClass(a.filterNotInUseClass),
a.hasFixedTableHeader){var b=a.myTableHolder.hasClass(a.filterIsOpenClass)?!1:!0,d=a.myTableHead.outerHeight();b&&(d+=a.myFilterFormHolder.outerHeight());a.myTableHolder.find(".tfspushdowndiv").height(d);d=a.myTableBody.offset().top;!0===(jQuery(window).scrollTop()>d?!0:!1)?(d=a.myTableHolder.width(),b&&a.myFilterFormHolder.width(d),window.setTimeout(function(){a.myTableHolder.addClass(a.fixedHeaderClass);var c=0;b&&(c=a.myFilterFormHolder.outerHeight());a.myTableHead.css("top",c)},a.millisecondsBetweenActions)):
a.myTableHolder.removeClass(a.fixedHeaderClass)}}else a.myTableHolder.addClass(a.filterNotInUseClass),a.myTableHolder.removeClass(a.filterInUseClass)},startRowManipulation:function(){"function"===typeof a.startRowFX1&&a.startRowFX1(a);a.resetObjects();a.myTable.addClass(a.hideClass);a.myTableHolder.find(a.moreRowEntriesSelector).hide();a.myRows.each(function(b,d){jQuery(d).addClass(a.hideClass).removeClass(a.showClass)});"function"===typeof a.startRowFX2&&a.startRowFX2(a)},endRowManipulation:function(){"function"===
typeof a.endRowFX1&&a.endRowFX1(a);a.resetObjects();var b=a.sfr,d=0,c=0,e=0,f=0===a.myTableBody.find("tr."+a.notMatchClass).length?!0:!1,k=!1;a.myRows.each(function(g,h){h=jQuery(h);d++;k=!1;if(f||h.hasClass(a.matchClass))k=!0,c++;k&&c>b&&e<a.visibleRowCount&&(e++,h.removeClass(a.hideClass).addClass(a.showClass))});0<c?jQuery("."+a.noMatchMessageClass).hide():jQuery("."+a.noMatchMessageClass).show();var n=b+e,h=Math.ceil(c/a.visibleRowCount),g=Math.floor(a.sfr/a.visibleRowCount),l="";if(1<h){for(var m=
0,t=0,u=g-2,r=g+2,p=[],m=0;m<h;m++)g===m?(t=0,l+="<span>["+(m+1)+"]</span>"):(test1=m>u&&m<r,test2=m>=h-1,test3=1>m,test1||test2||test3?(p=[],t=0,0===m&&p.push("first"),m===h-1&&p.push("last"),m===g-1&&p.push("prev"),m===g+1&&p.push("next"),l+='<a href="#" class="'+p.join(" ")+'"data-page="'+m+'">'+(m+1)+"</a> "):3>t&&(t++,l+=" . ")),l+=" ";a.myTableHolder.find(a.moreRowEntriesSelector).show()}b++;d===c?(a.myTableHolder.find(a.filteredCountHolder).hide(),a.myTableHolder.find(a.unfilteredCountHolder).show()):
(a.myTableHolder.find(a.unfilteredCountHolder).hide(),a.myTableHolder.find(a.filteredCountHolder).show());a.myTableHolder.find(a.minRowSelector).text(b);a.myTableHolder.find(a.maxRowSelector).text(n);a.myTableHolder.find(a.matchRowCountSelector).text(c);a.myTableHolder.find(a.totalRowCountSelector).text(d);a.myTableHolder.find(a.visibleRowCountSelector).val(a.visibleRowCount);a.myTableHolder.find(a.paginationSelector).html(l);a.myTable.show();a.myTable.removeClass(a.hideClass);a.myTableHolder.hasClass(a.filterIsOpenClass)||
window.setTimeout(a.scrollToTopOfHolder(),a.millisecondsBetweenActions);a.resetObjects();a.pushState();"function"===typeof a.endRowFX2&&a.endRowFX2(a)},pushState:function(){!0===a.canPushState&&history.replaceState(null,null,a.currentURL())},currentURL:function(){for(var b={},d=0;d<a.filterAndSortVariables.length;d++){var c=a.filterAndSortVariables[d],e=typeof a[c];if("number"===e&&0!==a[c]||"string"===e&&0<a[c].length||"boolean"===e||"object"===e&&0<Object.keys(a[c]).length)b[c]=a[c]}b="undefined"!==
typeof JSURL?JSURL.stringify(b):"tfs="+encodeURI(JSON.stringify(b));return a.baseURL+"#"+b},workOutCurrentFilter:function(){var b="",d,c="";a.cfi={};a.myFilterFormHolder.find(" ."+a.filterGroupClass).each(function(e,f){d=jQuery(f);c=d.attr("data-to-filter");var h=d.attr("field-type"),g=[];d.find("input").each(function(b,d){d=jQuery(d);var e=d.val(),f=e.toLowerCase().trim();switch(h){case "keyword":if(1<f.length)for("undefined"===typeof a.cfi[c]&&(a.cfi[c]=[]),e=f.split(","),f=e.length,b=0;b<f;b++)innerValueToMatch=
innerInputVal=e[b].trim(),1<innerValueToMatch.length&&(a.cfi[c].push({vtm:innerValueToMatch,ivl:innerInputVal}),g.push(innerValueToMatch));break;case "tag":case "checkbox":d.is(":checked")&&("undefined"===typeof a.cfi[c]&&(a.cfi[c]=[]),g.push(f),a.cfi[c].push({vtm:f,ivl:e}));break;case "favourites":d.is(":checked")?("undefined"===typeof a.cfi[c]&&(a.cfi[c]=[]),a.cfi[c].push({vtm:f,ivl:e}),g.push(f),a.myTableHolder.addClass(a.hasFavouritesInFilterClass)):a.myTableHolder.removeClass(a.hasFavouritesInFilterClass);
break;case "number":e=parseFloat(d.val());jQuery.isNumeric(e)&&0!==e&&("undefined"===typeof a.cfi[c]&&(a.cfi[c]=[]),g.push(d.attr("data-label")+e+" "),"undefined"===typeof a.cfi[c][0]&&(a.cfi[c][0]={}),a.cfi[c][0][d.attr("data-dir")]=e);break;case "date":e=d.val().trim(),"0"!==e&&""!==e&&("undefined"===typeof a.cfi[c]&&(a.cfi[c]={}),g.push(d.attr("data-label")+e),a.cfi[c][0][d.attr("data-dir")]=e)}});if("undefined"!==typeof a.cfi[c]){var l=d.find("label."+a.groupLabelClass).text();b+='<li class="category"><strong>'+
l+":</strong> <span>"+g.join("</span><span>")+"</span></li>"}});var e=a.myTableHolder.find("."+a.currentSearchFilterClass);if(!0===(0<Object.keys(a.cfi).length?!0:!1)){var b="<ul>"+b+"</ul>",f=e.attr("data-title");"string"===typeof f&&0<f.length&&(b="<h3>"+f+"</h3>"+b);a.myTableHolder.addClass(a.hasFilterClass).removeClass(a.doesNotHaveFilterClass)}else b=e.attr("data-no-filter-text"),a.myTableHolder.removeClass(a.hasFilterClass).addClass(a.doesNotHaveFilterClass);e.html(b)},retrieveLocalCookie:function(){if("undefined"!==
typeof Cookies){a.mfv=Cookies.getJSON("mfv");"undefined"===typeof a.mfv?a.mfv=[]:a.serverDataToApply.mfv=!0;var b=Cookies.getJSON("visibleRowCount");visibleRowCount=a.visibleRowCountValidator(b);!1!==visibleRowCount&&(a.visibleRowCount=b)}},retrieveDataFromFragment:function(){if("undefined"!==typeof JSURL&&"undefined"!==typeof location.hash&&location.hash&&0<location.hash.length){var b=window.location.hash.substr(1);data=JSURL.tryParse(b,{});for(var d in data)data.hasOwnProperty(d)&&("pge"===d&&(data[d]=
parseInt(data[d])),a[d]=data[d],a.serverDataToApply[d]=!0)}},retrieveDataFromGetVar:function(){var b={};"undefined"!==typeof location.search&&location.search&&0<location.search.length&&location.search.substr(1).split("&").forEach(function(a){var c=a.split("=");a=c[0];c=c[1]&&decodeURIComponent(c[1]);(b[a]=b[a]||[]).push(c)});"undefined"!==typeof b.load&&"undefined"!==typeof b.load[0]&&"string"===typeof b.load[0]&&0<b.load.length&&(a.urlToLoad=b.load)},processRetrievedData:function(b){if(""!==a.urlToLoad)b=
a.serverConnectionURL+"load/"+a.urlToLoad+"/",a.urlToLoad="",jQuery.getJSON(b,function(b){var c=!1;b=b.Data;b=JSON.parse(b);for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d],a.serverDataToApply[d]=!0,"mfv"===d&&(c=!0));a.processRetrievedData(c)}).fail(function(){a.processRetrievedData(!1)});else{if("undefined"!==typeof a.serverDataToApply.mfv&&!0===a.serverDataToApply.mfv){a.myTableBody.find("tr."+a.favouriteClass).removeClass(a.favouriteClass);for(var d=0;d<a.mfv.length;d++){var c=a.myTableBody.find("#"+
a.mfv[d]);0<c.length?c.addClass(a.favouriteClass):(a.mfv.splice(d,1),"undefined"!==typeof Cookies&&Cookies.set("mfv",a.mfv,{path:a.baseURL,expires:180}))}0<a.mfv.length?a.myTableHolder.addClass(a.hasFavouritesClass):a.myTableHolder.removeClass(a.hasFavouritesClass);!0===b&&(a.myTableHolder.hasClass(a.hasFavouritesInFilterClass)&&a.myTableHolder.find(a.showFavouritesSelector).click(),a.myTableHolder.find(a.showFavouritesSelector).click());delete a.serverDataToApply.mfv}"undefined"!==typeof a.serverDataToApply.cfi&&
!0===a.serverDataToApply.cfi&&(a.createFilterForm(),a.runCurrentFilter(),delete a.serverDataToApply.cfi);"undefined"!==typeof a.serverDataToApply.csr&&!0===a.serverDataToApply.csr&&(b=a.csr.sct,d=a.csr.sdi,a.myTableHead.find(a.sortLinkSelector).removeClass(a.sortAscClass).removeClass(a.sortDescClass),a.myTableHead.find(a.sortLinkSelector+"[data-sort-field='"+b+"']").attr("data-sort-direction",d).click(),delete a.serverDataToApply.csr);"undefined"!==typeof a.serverDataToApply.pge&&!0===a.serverDataToApply.pge&&
(a.gotoPage(a.pge),delete a.serverDataToApply.pge)}},replaceAll:function(a,d,c){a.split(d).join(c);return a},objectSize:function(a){var d=0,c;if("undefined"===typeof a)return 0;for(c in a)a.hasOwnProperty(c)&&d++;return d},objectSort:function(a){var d=[],c;for(c in a)a.hasOwnProperty(c)&&d.push([c,a[c]]);d.sort(function(a,b){a=a[1];b=b[1];return a<b?-1:a>b?1:0});a={};for(c=c=0;c<d.length;c++)"string"===typeof d[c][1]&&(a[d[c][0]]=d[c][1]);return a},visibleRowCountValidator:function(a){a=parseInt(a);
return!isNaN(a)&&(a|0)===a&&0<a&&1E4>a?a:!1},makeID:function(){for(var a="",d=0;9>d;d++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(Math.floor(52*Math.random()));return a},sortMultiDimensionalArray:function(a,d){var c=a[0];"string"===typeof c&&(c=c.toLowerCase());var e=d[0];"string"===typeof e&&(e=e.toLowerCase());return c===e?0:c<e?-1:1}},a=jQuery.extend(a,n);this.each(function(b,d){a.init(r);r++});return{getVar:function(b){if(a.hasOwnProperty(b))return a[b]},setVar:function(b,
d){a[b]=d;return this},gotoPage:function(b){a.gotoPage(b);return this}}}})(jQuery);String.prototype.raw2attr=function(){return(""+this).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"&#13;").replace(/[\r\n]/g,"&#13;")};
String.prototype.attr2raw=function(){var n;n=(""+this).replace(/\r\n/g,"\n").replace(/[\r\n]/,"\n").replace(/&#13;&#10;/g,"\n").replace(/&#1[03];/g,"\n").replace(/&#9;/g,"\t").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&apos;/g,"'");var p=/&[^;]*;?/.match(n);if(0<p.length&&"&amp;"!==p[0])throw"unsafe entity found in the attribute literal content";return n=n.replace(/&amp;/g,"&")};
jQuery.fn.isOnScreen=function(){var n,p;n=jQuery(window).scrollTop();p=n+jQuery(window).height();var r,l;r=this.offset().top;l=r+this.outerHeight();return r<=p&&l>=n};(function(n){var p=n.fn.on,r;n.fn.delayedOn=function(){var l=Array.apply(null,arguments),a=l[l.length-1];if(isNaN(a)||1===a&&l.pop())return p.apply(this,l);var b=l.pop(),d=l.pop();l.push(function(){var a=this,e=arguments;clearTimeout(r);r=setTimeout(function(){d.apply(a,e)},b)});return p.apply(this,l)}})(jQuery);
